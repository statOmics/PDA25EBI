<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lieven Clement" />


<title>Statistical Methods for Quantitative MS-based Proteomics: Part II. Differential Abundance Analysis</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>

<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PDA25EBI</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-chalkboard-teacher"></span>
     
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pda_quantification_preprocessing.html">Quantification - Preprocessing</a>
    </li>
    <li>
      <a href="pda_robustSummarisation_peptideModels.html">Wrap-up Preprocessing - Peptide-Level-Models</a>
    </li>
    <li>
      <a href="pda_quantification_inference.html">Quantification - Differential Abundance Analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pda_tutorialPreprocessing.html">Quantification - Preprocessing</a>
    </li>
    <li>
      <a href="pda_tutorialDesign.html">Quantification - Design</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/statOmics/PDA25EBI">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://statomics.github.io/">statOmics</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Statistical Methods for Quantitative
MS-based Proteomics: Part II. Differential Abundance Analysis</h1>
<h4 class="author">Lieven Clement</h4>
<h4 class="date"><a href="https://statomics.github.io">statOmics</a>,
Ghent University</h4>

</div>


<p><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a></p>
<p>This is part of the online course <a
href="https://statomics.github.io/PDA/">Proteomics Data Analysis
(PDA)</a></p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/1mhg3BCuEm8" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<ul>
<li><a
href="https://www.youtube.com/watch?v=1mhg3BCuEm8&amp;list=PLZH1hP8_LbJKqnPSS4hxTkn-tQolSCGjP">Playlist
PDA Preprocessing</a></li>
</ul>
<div id="outline" class="section level1 unnumbered">
<h1 class="unnumbered">Outline</h1>
<ul>
<li>Francisella tularensis Example</li>
<li>Hypothesis testing</li>
<li>Multiple testing</li>
<li>Moderated statistics</li>
<li>Experimental design</li>
</ul>
<p>Note, that the R-code is included for learners who are aiming to
develop R/markdown scripts to automate their quantitative proteomics
data analyses. According to the target audience of the course we either
work with a graphical user interface (GUI) in a R/shiny App msqrob2gui
(e.g. Proteomics Bioinformatics course of the EBI and the Proteomics
Data Analysis course at the Gulbenkian institute) or with R/markdowns
scripts (e.g. Bioinformatics Summer School at UCLouvain or the
Statistical Genomics Course at Ghent University).</p>
<hr />
</div>
<div id="francisella-tularensis-experiment" class="section level1"
number="1">
<h1><span class="header-section-number">1</span> Francisella tularensis
experiment</h1>
<iframe width="560" height="315" src="https://www.youtube.com/embed/TW5rk1y7aOc" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<p><img src="figures/francisella.jpg" width="50%" /></p>
<p><img src="figures/tularemia_lesion.jpg" width="350" /></p>
<ul>
<li>Pathogen: causes tularemia</li>
<li>Metabolic adaptation key for intracellular life cycle of pathogenic
microorganisms.</li>
<li>Upon entry into host cells quick phasomal escape and active
multiplication in cytosolic compartment.</li>
<li>Franciscella is auxotroph for several amino acids, including
arginine.</li>
<li>Inactivation of arginine transporter delayed bacterial phagosomal
escape and intracellular multiplication.</li>
<li>Experiment to assess difference in proteome using 3 WT vs 3 ArgP KO
mutants</li>
</ul>
<div id="import-the-data-in-r" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Import the data in
R</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/2Ljd95IE_AY" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<details>
<summary>
Click to see code
</summary>
<p>
<ol style="list-style-type: decimal">
<li>Load libraries</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(limma)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(QFeatures)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(msqrob2)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>We use a peptides.txt file from MS-data quantified with maxquant
that contains MS1 intensities summarized at the peptide level.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>peptidesTable <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;https://raw.githubusercontent.com/statOmics/PDA/data/quantification/francisella/peptides.txt&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>int64 <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(peptidesTable,class) <span class="sc">==</span> <span class="st">&quot;integer64&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> int64) peptidesTable[[j]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(peptidesTable[[j]])                      </span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Maxquant stores the intensity data for the different samples in
columnns that start with Intensity. We can retreive the column names
with the intensity data with the code below:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>quantCols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;Intensity &quot;</span>, <span class="fu">names</span>(peptidesTable))</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Read the data and store it in QFeatures object</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="at">assayData =</span> peptidesTable,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="at">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="at">quantCols =</span>  quantCols,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;peptideRaw&quot;</span>)</span></code></pre></div>
<pre><code>## Checking arguments.</code></pre>
<pre><code>## Loading data as a &#39;SummarizedExperiment&#39; object.</code></pre>
<pre><code>## Formatting sample annotations (colData).</code></pre>
<pre><code>## Formatting data as a &#39;QFeatures&#39; object.</code></pre>
<pre><code>## Setting assay rownames.</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">rm</span>(peptidesTable)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8795485 469.8   15504024 828.1         NA 15504024 828.1
## Vcells 34574466 263.8   81347764 620.7      16384 81347764 620.7</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8795334 469.8   15504024 828.1         NA 15504024 828.1
## Vcells 34567828 263.8   81347764 620.7      16384 81347764 620.7</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Update data with information on design</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">colData</span>(pe)<span class="sc">$</span>genotype <span class="ot">&lt;-</span> pe[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">colnames</span>() <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="fu">substr</span>(<span class="dv">12</span>,<span class="dv">13</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">as.factor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="fu">relevel</span>(<span class="st">&quot;WT&quot;</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>pe <span class="sc">|&gt;</span> <span class="fu">colData</span>()</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 1 column
##                          genotype
##                          &lt;factor&gt;
## Intensity 1WT_20_2h_n3_3       WT
## Intensity 1WT_20_2h_n4_3       WT
## Intensity 1WT_20_2h_n5_3       WT
## Intensity 3D8_20_2h_n3_3       D8
## Intensity 3D8_20_2h_n4_3       D8
## Intensity 3D8_20_2h_n5_3       D8</code></pre>
</p>
</details>
</div>
<div id="preprocessing" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Preprocessing</h2>
<details>
<summary>
Click to see code to log-transfrom the data
</summary>
<p>
<ol style="list-style-type: decimal">
<li>Log transform</li>
</ol>
<ul>
<li>Peptides with zero intensities are missing peptides and should be
represent with a <code>NA</code> value rather than <code>0</code>.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">zeroIsNA</span>(pe, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span></code></pre></div>
<ul>
<li>Logtransform data with base 2</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">logTransform</span>(pe, <span class="at">base =</span> <span class="dv">2</span>, <span class="at">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="at">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Filtering</li>
</ol>
<ul>
<li>We remove peptides that could not be mapped to a protein or that map
to multiple proteins (the protein identifier contains multiple
identifiers separated by a <code>;</code>).</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>    pe, <span class="sc">~</span> Proteins <span class="sc">!=</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> <span class="do">## Remove failed protein inference</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;;&quot;</span>, Proteins)) <span class="do">## Remove protein groups</span></span></code></pre></div>
<pre><code>## &#39;Proteins&#39; found in 2 out of 2 assay(s).</code></pre>
<ul>
<li>Remove reverse sequences (decoys) and contaminants. Note that this
is indicated by the column names Reverse and depending on the version of
maxQuant with Potential.contaminants or Contaminants.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe,<span class="sc">~</span>Reverse <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Reverse&#39; found in 2 out of 2 assay(s).</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe,<span class="sc">~</span> Contaminant <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Contaminant&#39; found in 2 out of 2 assay(s).</code></pre>
<ul>
<li>Drop peptides that were identified in less than three sample. We
tolerate the following proportion of NAs: pNA = (n-3)/n. </li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>pNA <span class="ot">&lt;-</span> (n<span class="sc">-</span>nObs)<span class="sc">/</span>n</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(pe, <span class="at">pNA =</span> pNA, <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>)</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="fu">nrow</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 5740</code></pre>
<p>We keep 5740 peptides upon filtering.</p>
<ol start="3" style="list-style-type: decimal">
<li>Normalization by median centering</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">normalize</span>(pe, </span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>                <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>                <span class="at">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;center.median&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Summarization. We use the standard sumarisation in
aggregateFeatures, which is a robust summarisation method.</li>
</ol>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">aggregateFeatures</span>(pe,</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>    <span class="at">i =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>    <span class="at">fcol =</span> <span class="st">&quot;Proteins&quot;</span>, </span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
<pre><code>## Your quantitative and row data contain missing values. Please read the
## relevant section(s) in the aggregateFeatures manual page regarding the
## effects of missing values on data aggregation.</code></pre>
<pre><code>## Aggregated: 1/1</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Filter proteins that contain many missing values</li>
</ol>
<p>We want to have at least 4 observed proteins so that most proteins
have at least 2 observations in each group.<br />
So we tolerate a proportion of (n-4)/n NAs.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pe[[<span class="st">&quot;protein&quot;</span>]])</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>pNA <span class="ot">&lt;-</span> (n<span class="sc">-</span>nObs)<span class="sc">/</span>n</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(pe, <span class="at">pNA =</span> pNA, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
<p>Plot of preprocessed data</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>pe[[<span class="st">&quot;peptideNorm&quot;</span>]] <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  <span class="fu">assay</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="fu">gather</span>(sample, intensity) <span class="sc">|&gt;</span> </span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">genotype =</span> <span class="fu">colData</span>(pe)[sample,<span class="st">&quot;genotype&quot;</span>]) <span class="sc">|&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> intensity,<span class="at">group =</span> sample,<span class="at">color =</span> genotype)) <span class="sc">+</span> </span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>    <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Peptide-level&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 4421 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>pe[[<span class="st">&quot;protein&quot;</span>]] <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="fu">assay</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>  <span class="fu">gather</span>(sample, intensity) <span class="sc">|&gt;</span> </span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">genotype =</span> <span class="fu">colData</span>(pe)[sample,<span class="st">&quot;genotype&quot;</span>]) <span class="sc">|&gt;</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> intensity,<span class="at">group =</span> sample,<span class="at">color =</span> genotype)) <span class="sc">+</span> </span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>    <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Protein-level&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 149 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<img src="pda_quantification_inference_files/figure-html/unnamed-chunk-16-2.png" width="672" />
</p>
</details>
</div>
<div id="summarized-data-structure" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Summarized data
structure</h2>
<div id="design" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Design</h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>pe <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>  <span class="fu">colData</span>() <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">genotype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Intensity 1WT_20_2h_n3_3</td>
<td align="left">WT</td>
</tr>
<tr class="even">
<td align="left">Intensity 1WT_20_2h_n4_3</td>
<td align="left">WT</td>
</tr>
<tr class="odd">
<td align="left">Intensity 1WT_20_2h_n5_3</td>
<td align="left">WT</td>
</tr>
<tr class="even">
<td align="left">Intensity 3D8_20_2h_n3_3</td>
<td align="left">D8</td>
</tr>
<tr class="odd">
<td align="left">Intensity 3D8_20_2h_n4_3</td>
<td align="left">D8</td>
</tr>
<tr class="even">
<td align="left">Intensity 3D8_20_2h_n5_3</td>
<td align="left">D8</td>
</tr>
</tbody>
</table>
<ul>
<li>WT vs KO</li>
<li>3 vs 3 repeats</li>
</ul>
</div>
<div id="summarized-intensity-matrix" class="section level3"
number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Summarized
intensity matrix</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>pe[[<span class="st">&quot;protein&quot;</span>]] <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="fu">assay</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="7%" />
<col width="15%" />
<col width="15%" />
<col width="15%" />
<col width="15%" />
<col width="15%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Intensity 1WT_20_2h_n3_3</th>
<th align="right">Intensity 1WT_20_2h_n4_3</th>
<th align="right">Intensity 1WT_20_2h_n5_3</th>
<th align="right">Intensity 3D8_20_2h_n3_3</th>
<th align="right">Intensity 3D8_20_2h_n4_3</th>
<th align="right">Intensity 3D8_20_2h_n5_3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">WP_003013731</td>
<td align="right">-0.2277864</td>
<td align="right">-0.0333727</td>
<td align="right">0.1810282</td>
<td align="right">-0.1946484</td>
<td align="right">0.1347441</td>
<td align="right">0.0522102</td>
</tr>
<tr class="even">
<td align="left">WP_003013909</td>
<td align="right">-0.7603080</td>
<td align="right">-0.8862012</td>
<td align="right">-0.8565867</td>
<td align="right">-0.4951824</td>
<td align="right">-0.6100506</td>
<td align="right">-0.5490239</td>
</tr>
<tr class="odd">
<td align="left">WP_003014068</td>
<td align="right">0.5743424</td>
<td align="right">0.7821886</td>
<td align="right">1.0336891</td>
<td align="right">0.5098828</td>
<td align="right">0.8536632</td>
<td align="right">0.5446984</td>
</tr>
<tr class="even">
<td align="left">WP_003014122</td>
<td align="right">-0.8382825</td>
<td align="right">-1.1131095</td>
<td align="right">-0.9099676</td>
<td align="right">-1.2104299</td>
<td align="right">-1.2575807</td>
<td align="right">-1.3093650</td>
</tr>
<tr class="odd">
<td align="left">WP_003014123</td>
<td align="right">-0.2803634</td>
<td align="right">-0.4062057</td>
<td align="right">-0.3159891</td>
<td align="right">-0.4216095</td>
<td align="right">-0.3453093</td>
<td align="right">-0.6329528</td>
</tr>
<tr class="even">
<td align="left">WP_003014302</td>
<td align="right">1.5696671</td>
<td align="right">1.7486922</td>
<td align="right">1.5869110</td>
<td align="right">1.6919901</td>
<td align="right">1.8142693</td>
<td align="right">1.5398097</td>
</tr>
</tbody>
</table>
<ul>
<li>1025 proteins</li>
</ul>
</div>
<div id="hypothesis-testing-a-single-protein" class="section level3"
number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Hypothesis testing:
a single protein</h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/myP6SUlSwsM" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div id="t-test" class="section level4" number="1.3.3.1">
<h4><span class="header-section-number">1.3.3.1</span> T-test</h4>
<iframe width="560" height="315" src="https://www.youtube.com/embed/cVw5kdSRZCE" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<p><span class="math display">\[
\log_2 \text{FC} = \bar{y}_{p1}-\bar{y}_{p2}
\]</span></p>
<p><span class="math display">\[
T_g=\frac{\log_2 \text{FC}}{\text{se}_{\log_2 \text{FC}}}
\]</span></p>
<p><span class="math display">\[
T_g=\frac{\widehat{\text{signal}}}{\widehat{\text{Noise}}}
\]</span></p>
<p>If we can assume equal variance in both treatment groups:</p>
<p><span class="math display">\[
\text{se}_{\log_2 \text{FC}}=\text{SD}\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}
\]</span></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>WP_003023392 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>    <span class="at">intensity =</span> <span class="fu">assay</span>(pe[[<span class="st">&quot;protein&quot;</span>]][<span class="st">&quot;WP_003023392&quot;</span>,]) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>      <span class="fu">c</span>(), </span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>    <span class="at">genotype =</span> <span class="fu">colData</span>(pe)[,<span class="dv">1</span>]) </span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>WP_003023392 <span class="sc">|&gt;</span> </span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>genotype,<span class="at">y=</span>intensity)) <span class="sc">+</span> </span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Protein WP_003023392&quot;</span>)</span></code></pre></div>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p><span class="math display">\[
t=\frac{\log_2\widehat{\text{FC}}}{\text{se}_{\log_2\widehat{\text{FC}}}}=\frac{-1.4}{0.0541}=-25.8
\]</span></p>
<ul>
<li><p>Is t = -25.8 indicating that there is an effect?</p></li>
<li><p>How likely is it to observe t = -25.8 when there is no effect of
the argP KO on the protein expression?</p></li>
</ul>
</div>
<div id="null-hypothesis-h_0-and-alternative-hypothesis-h_1"
class="section level4" number="1.3.3.2">
<h4><span class="header-section-number">1.3.3.2</span> Null hypothesis
(<span class="math inline">\(H_0\)</span>) and alternative hypothesis
(<span class="math inline">\(H_1\)</span>)</h4>
<ul>
<li><p>With data we can never prove a hypothesis (falsification
principle of Popper)</p></li>
<li><p>With data we can only reject a hypothesis</p></li>
<li><p>In general we start from <em>alternative hypothese</em> <span
class="math inline">\(H_1\)</span>: we want to show an effect of the KO
on a protein</p></li>
</ul>
<center>
<span class="math inline">\(H_1\)</span>: On average the protein
abundance in WT is different from that in KO
</center>
<ul>
<li>But, we will assess this by falsifying the opposite:
<center>
<span class="math inline">\(H_0\)</span>: On average the protein
abundance in WT is equal to that in KO&lt;-
</center></li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">t.test</span>(intensity <span class="sc">~</span> genotype, <span class="at">data =</span> WP_003023392, <span class="at">var.equal=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  intensity by genotype
## t = 25.828, df = 4, p-value = 1.335e-05
## alternative hypothesis: true difference in means between group WT and group D8 is not equal to 0
## 95 percent confidence interval:
##  1.246966 1.547353
## sample estimates:
## mean in group WT mean in group D8 
##       -0.2641239       -1.6612832</code></pre>
<ul>
<li><p>How likely is it to observe an equal or more extreme effect than
the one observed in the sample when the null hypothesis is
true?</p></li>
<li><p>When we make assumptions about the distribution of our test
statistic we can quantify this probability: <em>p-value</em>. The
p-value will only be calculated correctly if the underlying assumptions
hold!</p></li>
<li><p>When we repeat the experiment, the probability to observe a fold
change for this gene that is more extreme than a 2.63 fold (<span
class="math inline">\(\log_2 FC=-1.4\)</span>) down or up regulation by
random change (if <span class="math inline">\(H_0\)</span> is true) is
13 out of 1 000 000.<br />
</p></li>
<li><p>If the p-value is below a significance threshold <span
class="math inline">\(\alpha\)</span> we reject the null hypothesis.
<em>We control the probability on a false positive result at the <span
class="math inline">\(\alpha\)</span>-level (type I error)</em></p></li>
<li><p>Note, that the p-values are uniform under the null hypothesis,
i.e. when <span class="math inline">\(H_0\)</span> is true all p-values
are equally likely.</p></li>
</ul>
</div>
</div>
</div>
<div id="multiple-hypothesis-testing" class="section level2"
number="1.4">
<h2><span class="header-section-number">1.4</span> Multiple hypothesis
testing</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/cLn-CFyA6ps" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<ul>
<li><p>Consider testing DA for all <span
class="math inline">\(m=1066\)</span> proteins simultaneously</p></li>
<li><p>What if we assess each individual test at level <span
class="math inline">\(\alpha\)</span>? <span
class="math inline">\(\rightarrow\)</span> Probability to have a false
positive (FP) among all m simultatenous test <span
class="math inline">\(&gt;&gt;&gt;  \alpha= 0.05\)</span></p></li>
<li><p>Indeed for each non DA protein we have a probability of 5% to
return a FP.</p></li>
<li><p>In a typical experiment the majority of the proteins are non
DA.</p></li>
<li><p>So an upperbound of the expected FP is <span
class="math inline">\(m \times \alpha\)</span> or <span
class="math inline">\(1066 \times 0.05=53\)</span>.</p></li>
</ul>
<p><span class="math inline">\(\rightarrow\)</span> Hence, we are bound
to call many false positive proteins each time we run the
experiment.</p>
<div id="multiple-testing" class="section level3" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Multiple
testing</h3>
<div id="family-wise-error-rate" class="section level4"
number="1.4.1.1">
<h4><span class="header-section-number">1.4.1.1</span> Family-wise error
rate</h4>
<iframe width="560" height="315" src="https://www.youtube.com/embed/IL_eUSyRDRA" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<p>The family-wise error rate (FWER) addresses the multiple testing
issue by no longer controlling the individual type I error for each
protein, instead it controls:</p>
<p><span class="math display">\[
   \text{FWER} =
   \text{P}\left[FP \geq 1 \right].
\]</span></p>
<p>The Bonferroni method is widely used to control the type I error:</p>
<ul>
<li>assess each test at <span
class="math display">\[\alpha_\text{adj}=\frac{\alpha}{m}\]</span></li>
<li>or use adjusted p-values and compare them to <span
class="math inline">\(\alpha\)</span>: <span
class="math display">\[p_\text{adj}=\text{min}\left(p \times
m,1\right)\]</span></li>
</ul>
<p>Problem, the method is very conservative!</p>
</div>
<div id="false-discovery-rate" class="section level4" number="1.4.1.2">
<h4><span class="header-section-number">1.4.1.2</span> False discovery
rate</h4>
<iframe width="560" height="315" src="https://www.youtube.com/embed/envDqvEwRcc" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<ul>
<li>FDR: Expected proportion of false positives on the total number of
positives you return.</li>
<li>An FDR of 1% means that on average we expect 1% false positive
proteins in the list of proteins that are called significant.</li>
<li>Defined by Benjamini and Hochberg in their seminal paper Benjamini,
Y. and Hochberg, Y. (1995). “Controlling the false discovery rate: a
practical and powerful approach to multiple testing”. Journal of the
Royal Statistical Society Series B, 57 (1): 289–300.</li>
</ul>
<p>The <strong>False Discovery Proportion (FDP)</strong> is the fraction
of false positives that are returned, i.e. </p>
<p><span class="math display">\[
FDP = \frac{FP}{R}
\]</span></p>
<ul>
<li>However, this quantity cannot be observed because in practice we
only know the number of proteins for which we rejected <span
class="math inline">\(H_0\)</span>, <span
class="math inline">\(R\)</span>.</li>
<li>But, we do not know the number of false positives, <span
class="math inline">\(FP\)</span>.</li>
</ul>
<p>Therefore, Benjamini and Hochberg, 1995, defined The <strong>False
Discovery Rate (FDR)</strong> as <span class="math display">\[
   \text{FDR} = \text{E}\left[\frac{FP}{R}\right]
=\text{E}\left[\text{FDP}\right]
\]</span> the expected FDP.</p>
<ul>
<li>Controlling the FDR allows for more discoveries (i.e. longer lists
with significant results), while the fraction of false discoveries among
the significant results in well controlled on average. As a consequence,
more of the true positive hypotheses will be detected.</li>
</ul>
</div>
<div id="intuition-of-bh-fdr-procedure" class="section level4"
number="1.4.1.3">
<h4><span class="header-section-number">1.4.1.3</span> Intuition of
BH-FDR procedure</h4>
<p>Consider <span class="math inline">\(m = 1000\)</span> tests</p>
<ul>
<li><p>Suppose that a researcher rejects all null hypotheses for which
<span class="math inline">\(p &lt; 0.01\)</span>.</p></li>
<li><p>If we use <span class="math inline">\(p &lt; 0.01\)</span>, we
expect <span class="math inline">\(0.01 \times m_0\)</span> tests to
return false positives.</p></li>
<li><p>A conservative estimate of the number of false positives that we
can expect can be obtained by considering that the null hypotheses are
true for all features, <span class="math inline">\(m_0 = m
=  1000\)</span>.</p></li>
<li><p>We then would expect <span class="math inline">\(0.01 \times 1000
= 10\)</span> false positives (<span
class="math inline">\(FP=10\)</span>).</p></li>
<li><p>Suppose that the researcher found 200 genes with <span
class="math inline">\(p&lt;0.01\)</span> (<span
class="math inline">\(R=200\)</span>).</p></li>
<li><p>The proportion of false positive results (FDP = false positive
proportion) among the list of <span class="math inline">\(R=200\)</span>
genes can then be estimated as <span class="math display">\[
\widehat{\text{FDP}}=\frac{FP}{R}=\frac{10}{200}=\frac{0.01 \times
1000}{200} = 0.05.
\]</span></p></li>
</ul>
</div>
<div
id="benjamini-and-hochberg-1995-procedure-for-controlling-the-fdr-at-alpha"
class="section level4" number="1.4.1.4">
<h4><span class="header-section-number">1.4.1.4</span> Benjamini and
Hochberg (1995) procedure for controlling the FDR at <span
class="math inline">\(\alpha\)</span></h4>
<ol style="list-style-type: decimal">
<li><p>Let <span class="math inline">\(p_{(1)}\leq \ldots \leq
p_{(m)}\)</span> denote the ordered <span
class="math inline">\(p\)</span>-values.</p></li>
<li><p>Find the largest integer <span class="math inline">\(k\)</span>
so that <span class="math display">\[
\frac{p_{(k)} \times m}{k} \leq \alpha
\]</span> <span class="math display">\[\text{or}\]</span> <span
class="math display">\[
p_{(k)} \leq k \times \alpha/m
\]</span></p></li>
<li><p>If such a <span class="math inline">\(k\)</span> exists, reject
the <span class="math inline">\(k\)</span> null hypotheses associated
with <span class="math inline">\(p_{(1)}, \ldots, p_{(k)}\)</span>.
Otherwise none of the null hypotheses is rejected.</p></li>
</ol>
<p>The adjusted <span class="math inline">\(p\)</span>-value (also known
as the <span class="math inline">\(q\)</span>-value in FDR literature):
<span class="math display">\[
   q_{(i)}=\tilde{p}_{(i)} = \min\left[\min_{j=i,\ldots, m}\left(m
p_{(j)}/j\right), 1 \right].
\]</span> In the hypothetical example above: <span
class="math inline">\(k=200\)</span>, <span
class="math inline">\(p_{(k)}=0.01\)</span>, <span
class="math inline">\(m=1000\)</span> and <span
class="math inline">\(\alpha=0.05\)</span>.</p>
</div>
<div id="francisella-example" class="section level4" number="1.4.1.5">
<h4><span class="header-section-number">1.4.1.5</span> Francisella
Example</h4>
<iframe width="560" height="315" src="https://www.youtube.com/embed/B3BmnOLkYg4" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<details>
<summary>
Click to see code
</summary>
<p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>ttestMx <span class="ot">&lt;-</span> <span class="cf">function</span>(y,group) {</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>    test <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">t.test</span>(y[group],y[<span class="sc">!</span>group],<span class="at">var.equal=</span><span class="cn">TRUE</span>),<span class="at">silent=</span><span class="cn">TRUE</span>)</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is</span>(test,<span class="st">&quot;try-error&quot;</span>)) {</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">log2FC=</span><span class="cn">NA</span>,<span class="at">se=</span><span class="cn">NA</span>,<span class="at">tstat=</span><span class="cn">NA</span>,<span class="at">p=</span><span class="cn">NA</span>))</span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">log2FC=</span> (test<span class="sc">$</span>estimate<span class="sc">%*%</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>)),<span class="at">se=</span>test<span class="sc">$</span>stderr,<span class="at">tstat=</span>test<span class="sc">$</span>statistic,<span class="at">pval=</span>test<span class="sc">$</span>p.value))</span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>      }</span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a> }</span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a> </span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a> res <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a>    <span class="fu">assay</span>(pe[[<span class="st">&quot;protein&quot;</span>]]), </span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a>    <span class="dv">1</span>, </span>
<span id="cb40-13"><a href="#cb40-13" tabindex="-1"></a>    ttestMx,</span>
<span id="cb40-14"><a href="#cb40-14" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">colData</span>(pe)<span class="sc">$</span>genotype<span class="sc">==</span><span class="st">&quot;D8&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-15"><a href="#cb40-15" tabindex="-1"></a>  <span class="fu">t</span>() </span>
<span id="cb40-16"><a href="#cb40-16" tabindex="-1"></a> </span>
<span id="cb40-17"><a href="#cb40-17" tabindex="-1"></a> <span class="fu">colnames</span>(res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;logFC&quot;</span>,<span class="st">&quot;se&quot;</span>,<span class="st">&quot;tstat&quot;</span>,<span class="st">&quot;pval&quot;</span>)</span>
<span id="cb40-18"><a href="#cb40-18" tabindex="-1"></a> </span>
<span id="cb40-19"><a href="#cb40-19" tabindex="-1"></a> res <span class="ot">&lt;-</span> res <span class="sc">|&gt;</span> </span>
<span id="cb40-20"><a href="#cb40-20" tabindex="-1"></a>   <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-21"><a href="#cb40-21" tabindex="-1"></a>   <span class="fu">na.exclude</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-22"><a href="#cb40-22" tabindex="-1"></a>   <span class="fu">arrange</span>(pval)</span>
<span id="cb40-23"><a href="#cb40-23" tabindex="-1"></a> </span>
<span id="cb40-24"><a href="#cb40-24" tabindex="-1"></a> res<span class="sc">$</span>adjPval <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(res<span class="sc">$</span>pval, <span class="st">&quot;fdr&quot;</span>)</span>
<span id="cb40-25"><a href="#cb40-25" tabindex="-1"></a> </span>
<span id="cb40-26"><a href="#cb40-26" tabindex="-1"></a> alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb40-27"><a href="#cb40-27" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" tabindex="-1"></a> res<span class="sc">$</span>adjAlphaForm <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(res),<span class="st">&quot; x &quot;</span>,alpha,<span class="st">&quot;/&quot;</span>,<span class="fu">nrow</span>(res))</span>
<span id="cb40-29"><a href="#cb40-29" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" tabindex="-1"></a> res<span class="sc">$</span>adjAlpha <span class="ot">&lt;-</span> alpha <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(res))<span class="sc">/</span><span class="fu">nrow</span>(res) </span>
<span id="cb40-31"><a href="#cb40-31" tabindex="-1"></a></span>
<span id="cb40-32"><a href="#cb40-32" tabindex="-1"></a> res<span class="sc">$</span><span class="st">&quot;pval &lt; adjAlpha&quot;</span> <span class="ot">&lt;-</span> res<span class="sc">$</span>pval <span class="sc">&lt;</span> res<span class="sc">$</span>adjAlpha </span>
<span id="cb40-33"><a href="#cb40-33" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" tabindex="-1"></a> res<span class="sc">$</span><span class="st">&quot;adjPval &lt; alpha&quot;</span> <span class="ot">&lt;-</span> res<span class="sc">$</span>adjPval <span class="sc">&lt;</span> alpha </span></code></pre></div>
</p>
</details>
<p>FWER: Bonferroni method:<span class="math inline">\(\alpha_\text{adj}
= \alpha/m = 0.05 / 1025= 5\times 10^{-5}\)</span></p>
<table>
<colgroup>
<col width="13%" />
<col width="11%" />
<col width="10%" />
<col width="10%" />
<col width="14%" />
<col width="10%" />
<col width="16%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">logFC</th>
<th align="right">pval</th>
<th align="right">adjPval</th>
<th align="left">adjAlphaForm</th>
<th align="right">adjAlpha</th>
<th align="left">pval &lt; adjAlpha</th>
<th align="left">adjPval &lt; alpha</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">WP_003023392</td>
<td align="right">-1.3971592</td>
<td align="right">0.0000134</td>
<td align="right">0.0136840</td>
<td align="left">1 x 0.05/1025</td>
<td align="right">0.0000488</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">WP_011733588</td>
<td align="right">-0.4018518</td>
<td align="right">0.0000418</td>
<td align="right">0.0214166</td>
<td align="left">2 x 0.05/1025</td>
<td align="right">0.0000976</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">WP_003038430</td>
<td align="right">-0.4024957</td>
<td align="right">0.0001814</td>
<td align="right">0.0408656</td>
<td align="left">3 x 0.05/1025</td>
<td align="right">0.0001463</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">WP_003026016</td>
<td align="right">-1.0493276</td>
<td align="right">0.0001834</td>
<td align="right">0.0408656</td>
<td align="left">4 x 0.05/1025</td>
<td align="right">0.0001951</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">WP_003014552</td>
<td align="right">-0.9536835</td>
<td align="right">0.0001993</td>
<td align="right">0.0408656</td>
<td align="left">5 x 0.05/1025</td>
<td align="right">0.0002439</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">WP_011733645</td>
<td align="right">0.3838435</td>
<td align="right">0.0002817</td>
<td align="right">0.0481190</td>
<td align="left">6 x 0.05/1025</td>
<td align="right">0.0002927</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">WP_003040849</td>
<td align="right">-1.2473865</td>
<td align="right">0.0004301</td>
<td align="right">0.0629754</td>
<td align="left">7 x 0.05/1025</td>
<td align="right">0.0003415</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">WP_003038940</td>
<td align="right">-0.2386737</td>
<td align="right">0.0005609</td>
<td align="right">0.0718619</td>
<td align="left">8 x 0.05/1025</td>
<td align="right">0.0003902</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">…</td>
<td align="right">…</td>
<td align="right">…</td>
<td align="right">…</td>
<td align="left">…</td>
<td align="right">…</td>
<td align="left">…</td>
<td align="left">…</td>
</tr>
<tr class="even">
<td align="left">WP_003040562</td>
<td align="right">0.0039480</td>
<td align="right">0.9976429</td>
<td align="right">0.9985797</td>
<td align="left">1065 x 0.05/1066</td>
<td align="right">0.0499531</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">WP_003041130</td>
<td align="right">0.0002941</td>
<td align="right">0.9992812</td>
<td align="right">0.9992812</td>
<td align="left">1066 x 0.05/1066</td>
<td align="right">0.05</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
</div>
<div id="results" class="section level4" number="1.4.1.6">
<h4><span class="header-section-number">1.4.1.6</span> Results</h4>
<details>
<summary>
Click to see code
</summary>
<p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>volcanoT <span class="ot">&lt;-</span> res <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(pval), <span class="at">color =</span> adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">cex =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() </span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>volcanoT</span></code></pre></div>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="moderated-statistics" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Moderated
Statistics</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/_Q11LXDy0xU" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<p>Problems with ordinary t-test</p>
<details>
<summary>
Click to see code
</summary>
<p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>problemPlots <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>problemPlots[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> res <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> se, <span class="at">color =</span> adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">cex =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() </span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>{</span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a>problemPlots[[i]] <span class="ot">&lt;-</span> <span class="fu">colData</span>(pe) <span class="sc">|&gt;</span> </span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">intensity =</span> pe[[<span class="st">&quot;protein&quot;</span>]][<span class="fu">rownames</span>(res)[i],] <span class="sc">|&gt;</span> </span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a>             <span class="fu">assay</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a>             <span class="fu">c</span>()</span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a>           ) <span class="sc">|&gt;</span> </span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>genotype,<span class="at">y=</span>intensity)) <span class="sc">+</span></span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb43-18"><a href="#cb43-18" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb43-19"><a href="#cb43-19" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">rownames</span>(res)[i])</span>
<span id="cb43-20"><a href="#cb43-20" tabindex="-1"></a>}</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>problemPlots</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<pre><code>## Warning: Removed 6 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-28-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-28-3.png" width="672" /></p>
<p>A general class of moderated test statistics is given by <span
class="math display">\[
   T_g^{mod} = \frac{\bar{Y}_{g1} - \bar{Y}_{g2}}{C \quad \tilde{S}_g} ,
\]</span> where <span class="math inline">\(\tilde{S}_g\)</span> is a
moderated standard deviation estimate.</p>
<ul>
<li><span class="math inline">\(C\)</span> is a constant depending on
the design e.g. <span
class="math inline">\(\sqrt{1/{n_1}+1/n_2}\)</span> for a t-test and of
another form for linear models.</li>
<li><span class="math inline">\(\tilde{S}_g=S_g+S_0\)</span>: add small
positive constant to denominator of t-statistic.</li>
<li>This can be adopted in Perseus.</li>
</ul>
<details>
<summary>
Click to see code
</summary>
<p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>simI<span class="ot">&lt;-</span><span class="fu">sapply</span>(res<span class="sc">$</span>se<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>),<span class="cf">function</span>(n,mean,sd) <span class="fu">rnorm</span>(n,mean,sd),<span class="at">n=</span><span class="dv">6</span>,<span class="at">mean=</span><span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a>resSim <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a>    simI, </span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a>    <span class="dv">1</span>, </span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a>    ttestMx,</span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">colData</span>(pe)<span class="sc">$</span>genotype<span class="sc">==</span><span class="st">&quot;D8&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a>  <span class="fu">t</span>() </span>
<span id="cb49-10"><a href="#cb49-10" tabindex="-1"></a> <span class="fu">colnames</span>(resSim) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;logFC&quot;</span>,<span class="st">&quot;se&quot;</span>,<span class="st">&quot;tstat&quot;</span>,<span class="st">&quot;pval&quot;</span>)</span>
<span id="cb49-11"><a href="#cb49-11" tabindex="-1"></a> resSim <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resSim)</span>
<span id="cb49-12"><a href="#cb49-12" tabindex="-1"></a> tstatSimPlot <span class="ot">&lt;-</span> resSim <span class="sc">|&gt;</span> </span>
<span id="cb49-13"><a href="#cb49-13" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>tstat)) <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14" tabindex="-1"></a>     <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density.., <span class="at">fill=</span>..count..),<span class="at">bins=</span><span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb49-15"><a href="#cb49-15" tabindex="-1"></a>     <span class="fu">stat_function</span>(<span class="at">fun=</span>dt,</span>
<span id="cb49-16"><a href="#cb49-16" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;red&quot;</span>,</span>
<span id="cb49-17"><a href="#cb49-17" tabindex="-1"></a>    <span class="at">args=</span><span class="fu">list</span>(<span class="at">df=</span><span class="dv">4</span>)) <span class="sc">+</span> </span>
<span id="cb49-18"><a href="#cb49-18" tabindex="-1"></a>   <span class="fu">ylim</span>(<span class="dv">0</span>,.<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb49-19"><a href="#cb49-19" tabindex="-1"></a>   <span class="fu">ggtitle</span>(<span class="st">&quot;t-statistic&quot;</span>)</span>
<span id="cb49-20"><a href="#cb49-20" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" tabindex="-1"></a> </span>
<span id="cb49-22"><a href="#cb49-22" tabindex="-1"></a> resSim<span class="sc">$</span>C <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) </span>
<span id="cb49-23"><a href="#cb49-23" tabindex="-1"></a> resSim<span class="sc">$</span>sd <span class="ot">&lt;-</span> resSim<span class="sc">$</span>se<span class="sc">/</span>resSim<span class="sc">$</span>C </span>
<span id="cb49-24"><a href="#cb49-24" tabindex="-1"></a> tstatSimPerseus <span class="ot">&lt;-</span> resSim <span class="sc">|&gt;</span> </span>
<span id="cb49-25"><a href="#cb49-25" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logFC<span class="sc">/</span>((sd<span class="fl">+.1</span>)<span class="sc">*</span>C))) <span class="sc">+</span></span>
<span id="cb49-26"><a href="#cb49-26" tabindex="-1"></a>     <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density.., <span class="at">fill=</span>..count..),<span class="at">bins=</span><span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb49-27"><a href="#cb49-27" tabindex="-1"></a>     <span class="fu">stat_function</span>(<span class="at">fun=</span>dt,</span>
<span id="cb49-28"><a href="#cb49-28" tabindex="-1"></a>                   <span class="at">color=</span><span class="st">&quot;red&quot;</span>,</span>
<span id="cb49-29"><a href="#cb49-29" tabindex="-1"></a>                  <span class="at">args=</span><span class="fu">list</span>(<span class="at">df=</span><span class="dv">4</span>)) <span class="sc">+</span> </span>
<span id="cb49-30"><a href="#cb49-30" tabindex="-1"></a>     <span class="fu">ylim</span>(<span class="dv">0</span>,.<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb49-31"><a href="#cb49-31" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Perseus&quot;</span>)</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(tstatSimPlot,tstatSimPerseus,<span class="at">nrow=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range
## (`geom_bar()`).</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<ul>
<li>The choice of <span class="math inline">\(S_0\)</span> in Perseus is
ad hoc and the t-statistic is no-longer t-distributed.</li>
<li>Permutation test, but is difficult for more complex designs.</li>
<li>Allows for Data Dredging because user can choose <span
class="math inline">\(S_0\)</span></li>
</ul>
<div id="empirical-bayes" class="section level3" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> Empirical
Bayes</h3>
<p><img src="figures/limmaShrinkage.png" width="50%" /></p>
<p>Figure courtesy to Rafael Irizarry</p>
<p><span class="math display">\[
   T_g^{mod} = \frac{\bar{Y}_{g1} - \bar{Y}_{g2}}{C \quad \tilde{S}_g} ,
\]</span></p>
<ul>
<li><strong>empirical Bayes</strong> theory provides formal framework
for borrowing strength across proteins,</li>
<li>Implemented in popular bioconductor package <strong>limma</strong>
and <strong>msqrob2</strong></li>
</ul>
<p><span class="math display">\[
  \tilde{S}_g=\sqrt{\frac{d_gS_g^2+d_0S_0^2}{d_g+d_0}},
\]</span></p>
<ul>
<li><span class="math inline">\(S_0^2\)</span>: common variance (over
all proteins)</li>
<li>Moderated t-statistic is t-distributed with <span
class="math inline">\(d_0+d_g\)</span> degrees of freedom.</li>
<li>Note that the degrees of freedom increase by borrowing strength
across proteins!</li>
</ul>
<details>
<summary>
Click to see the code
</summary>
<p>
<ol style="list-style-type: decimal">
<li>We model the protein level expression values using the
<code>msqrob</code> function. By default <code>msqrob2</code> estimates
the model parameters using robust regression.</li>
</ol>
<p>We will model the data with a different group mean for every
genotype. The group is incoded in the variable <code>genotype</code> of
the colData. We can specify this model by using a formula with the
factor <code>genotype</code> as its predictor:
<code>formula = ~genotype</code>.</p>
<p>Note, that a formula always starts with a symbol ‘~’.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">msqrob</span>(<span class="at">object =</span> pe, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="at">formula =</span> <span class="sc">~</span>genotype)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Inference</li>
</ol>
<p>We first explore the design of the model that we specified using the
the package <code>ExploreModelMatrix</code></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">library</span>(ExploreModelMatrix)</span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a><span class="fu">VisualizeDesign</span>(<span class="fu">colData</span>(pe),<span class="sc">~</span>genotype)<span class="sc">$</span>plotlist</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>We have two model parameters, the (Intercept) and genotypeD8. This
results in a model with two group means:</p>
<ol style="list-style-type: decimal">
<li>For the wild type (WT) the expected value (mean) of the log2
transformed intensity y for a protein will be modelled using</li>
</ol>
<p><span class="math display">\[\text{E}[Y\vert
\text{genotype}=\text{WT}] = \text{(Intercept)}\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>For the knockout genotype D8 the expected value (mean) of the log2
transformed intensity y for a protein will be modelled using</li>
</ol>
<p><span class="math display">\[\text{E}[Y\vert
\text{genotype}=\text{D8}] = \text{(Intercept)} +
\text{genotypeD8}\]</span></p>
<p>The average log2FC between D8 and WT is thus <span
class="math display">\[\log_2\text{FC}_{D8-WT}= \text{E}[Y\vert
\text{genotype}=\text{D8}] - \text{E}[Y\vert \text{genotype}=\text{WT}]
= \text{genotypeD8}
\]</span></p>
<p>Hence, assessing the null hypothesis that there is no differential
abundance between D8 and WT can be reformulated as</p>
<p><span class="math display">\[H_0:  \text{genotypeD8}=0\]</span> We
can implement a hypothesis test for each protein in msqrob2 using the
code below:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(<span class="st">&quot;genotypeD8 = 0&quot;</span>, <span class="at">parameterNames =</span> <span class="fu">c</span>(<span class="st">&quot;genotypeD8&quot;</span>))</span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(<span class="at">object =</span> pe, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="at">contrast =</span> L)</span></code></pre></div>
<p>We can show the list with all significant DE proteins at the 5% FDR
using</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>genotypeD8 <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>  <span class="fu">arrange</span>(pval) <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a>  <span class="fu">filter</span>(adjPval<span class="sc">&lt;</span><span class="fl">0.05</span>)</span></code></pre></div>
<pre><code>##                   logFC         se       df          t         pval     adjPval
## WP_003023392 -1.3971592 0.09349966 6.397042 -14.942933 3.254588e-06 0.003244824
## WP_003040849 -1.2473865 0.12404946 6.397042 -10.055557 3.736229e-05 0.015936958
## WP_003014552 -0.9536835 0.10126476 6.397042  -9.417724 5.550408e-05 0.015936958
## WP_003026016 -1.0283106 0.10528137 6.034774  -9.767261 6.393965e-05 0.015936958
## WP_003033719 -1.1740374 0.13543520 6.186857  -8.668628 1.098307e-04 0.021900233</code></pre>
<p>We can also visualise the results using a volcanoplot</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>volcano <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>    <span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>genotypeD8,</span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(pval), <span class="at">color =</span> adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb58-4"><a href="#cb58-4" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">cex =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;msqrob2&quot;</span>)</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>  volcanoT <span class="sc">+</span>    </span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;ordinary t-test&quot;</span>),</span>
<span id="cb59-5"><a href="#cb59-5" tabindex="-1"></a>  volcano <span class="sc">+</span>     </span>
<span id="cb59-6"><a href="#cb59-6" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb59-7"><a href="#cb59-7" tabindex="-1"></a>,<span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 28 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<ul>
<li><p>The volcano plot opens up when using the EB variance
estimator</p></li>
<li><p>Borrowing strength to estimate the variance using empirical Bayes
solves the issue of returning proteins with a low fold change as
significant due to a low variance.</p></li>
</ul>
</div>
<div id="shrinkage-of-the-variance-and-moderated-t-statistics"
class="section level3" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Shrinkage of the
variance and moderated t-statistics</h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="fu">qplot</span>(</span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>msqrobModels,getSigma),</span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>msqrobModels,getSigmaPosterior)) <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;SD&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;moderated SD&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>,<span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-7"><a href="#cb61-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> ) </span></code></pre></div>
<pre><code>## Warning: Removed 28 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<ul>
<li>Small variances are shrunken towards the common variance resulting
in large EB variance estimates</li>
<li>Large variances are shrunken towards the common variance resulting
in smaller EB variance estimates</li>
<li>Pooled degrees of freedom of the EB variance estimator are larger
because information is borrowed across proteins to estimate the
variance</li>
</ul>
</div>
</div>
<div id="plots" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Plots</h2>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>sigNames <span class="ot">&lt;-</span> <span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>genotypeD8 <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">&quot;protein&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a>    <span class="fu">filter</span>(adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a>    <span class="fu">pull</span>(protein)</span>
<span id="cb63-5"><a href="#cb63-5" tabindex="-1"></a><span class="fu">heatmap</span>(<span class="fu">assay</span>(pe[[<span class="st">&quot;protein&quot;</span>]])[sigNames, ])</span></code></pre></div>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="cf">for</span> (protName <span class="cf">in</span> sigNames)</span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>    {</span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>        pePlot <span class="ot">&lt;-</span> pe[protName, , <span class="fu">c</span>(<span class="st">&quot;peptideNorm&quot;</span>, <span class="st">&quot;protein&quot;</span>)]</span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>        pePlotDf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">longForm</span>(pePlot))</span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a>        pePlotDf<span class="sc">$</span>assay <span class="ot">&lt;-</span> <span class="fu">factor</span>(pePlotDf<span class="sc">$</span>assay,</span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a>            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;peptideNorm&quot;</span>, <span class="st">&quot;protein&quot;</span>)</span>
<span id="cb64-7"><a href="#cb64-7" tabindex="-1"></a>        )</span>
<span id="cb64-8"><a href="#cb64-8" tabindex="-1"></a>        pePlotDf<span class="sc">$</span>genotype <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">colData</span>(pePlot)[pePlotDf<span class="sc">$</span>colname, <span class="st">&quot;genotype&quot;</span>])</span>
<span id="cb64-9"><a href="#cb64-9" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" tabindex="-1"></a>        <span class="co"># plotting</span></span>
<span id="cb64-11"><a href="#cb64-11" tabindex="-1"></a>        p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb64-12"><a href="#cb64-12" tabindex="-1"></a>            <span class="at">data =</span> pePlotDf,</span>
<span id="cb64-13"><a href="#cb64-13" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> colname, <span class="at">y =</span> value, <span class="at">group =</span> rowname)</span>
<span id="cb64-14"><a href="#cb64-14" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb64-15"><a href="#cb64-15" tabindex="-1"></a>            <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb64-16"><a href="#cb64-16" tabindex="-1"></a>            <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb64-17"><a href="#cb64-17" tabindex="-1"></a>            <span class="fu">facet_grid</span>(<span class="sc">~</span>assay) <span class="sc">+</span></span>
<span id="cb64-18"><a href="#cb64-18" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">70</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb64-19"><a href="#cb64-19" tabindex="-1"></a>            <span class="fu">ggtitle</span>(protName)</span>
<span id="cb64-20"><a href="#cb64-20" tabindex="-1"></a>        <span class="fu">print</span>(p1)</span>
<span id="cb64-21"><a href="#cb64-21" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" tabindex="-1"></a>        <span class="co"># plotting 2</span></span>
<span id="cb64-23"><a href="#cb64-23" tabindex="-1"></a>        p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pePlotDf, <span class="fu">aes</span>(<span class="at">x =</span> colname, <span class="at">y =</span> value, <span class="at">fill =</span> genotype)) <span class="sc">+</span></span>
<span id="cb64-24"><a href="#cb64-24" tabindex="-1"></a>            <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb64-25"><a href="#cb64-25" tabindex="-1"></a>            <span class="fu">geom_point</span>(</span>
<span id="cb64-26"><a href="#cb64-26" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">1</span>),</span>
<span id="cb64-27"><a href="#cb64-27" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">shape =</span> rowname)</span>
<span id="cb64-28"><a href="#cb64-28" tabindex="-1"></a>            ) <span class="sc">+</span></span>
<span id="cb64-29"><a href="#cb64-29" tabindex="-1"></a>            <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pePlotDf)) <span class="sc">+</span></span>
<span id="cb64-30"><a href="#cb64-30" tabindex="-1"></a>            <span class="fu">labs</span>(<span class="at">title =</span> protName, <span class="at">x =</span> <span class="st">&quot;sample&quot;</span>, <span class="at">y =</span> <span class="st">&quot;peptide intensity (log2)&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-31"><a href="#cb64-31" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">70</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb64-32"><a href="#cb64-32" tabindex="-1"></a>            <span class="fu">facet_grid</span>(<span class="sc">~</span>assay)</span>
<span id="cb64-33"><a href="#cb64-33" tabindex="-1"></a>        <span class="fu">print</span>(p2)</span>
<span id="cb64-34"><a href="#cb64-34" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-1.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-2.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-3.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-4.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-5.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-6.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-7.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-8.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-9.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-40-10.png" width="672" /></p>
</div>
</div>
<div id="experimental-design" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Experimental
Design</h1>
<div id="sample-size" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Sample size</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/uELgkzDjVRY" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<p><span class="math display">\[
\log_2 \text{FC} = \bar{y}_{p1}-\bar{y}_{p2}
\]</span></p>
<p><span class="math display">\[
T_g=\frac{\log_2 \text{FC}}{\text{se}_{\log_2 \text{FC}}}
\]</span></p>
<p><span class="math display">\[
T_g=\frac{\widehat{\text{signal}}}{\widehat{\text{Noise}}}
\]</span></p>
<p>If we can assume equal variance in both treatment groups:</p>
<p><span class="math display">\[
\text{se}_{\log_2 \text{FC}}=\text{SD}\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}
\]</span></p>
<p><span class="math inline">\(\rightarrow\)</span> if number of
bio-repeats increases we have a higher power!</p>
<ul>
<li>cfr. Study of tamoxifen treated Estrogen Recepter (ER) positive
breast cancer patients</li>
</ul>
</div>
<div id="randomized-complete-block-designs" class="section level2"
number="2.2">
<h2><span class="header-section-number">2.2</span> Randomized complete
block designs</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HE4KWfIOVp0" frameborder="0" style="display: block; margin: auto;" allow="autoplay; encrypted-media" allowfullscreen>
</iframe>
<p><span class="math display">\[\sigma^2=
\sigma^2_{bio}+\sigma^2_\text{lab} +\sigma^2_\text{extraction} +
\sigma^2_\text{run} + \ldots\]</span></p>
<ul>
<li>Biological: fluctuations in protein level between mice, fluctations
in protein level between cells, …</li>
<li>Technical: cage effect, lab effect, week effect, plasma extraction,
MS-run, …</li>
</ul>
<div id="nature-methods-points-of-significance---blocking"
class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Nature methods:
Points of significance - Blocking</h3>
<p><a
href="https://www.nature.com/articles/nmeth.3005.pdf">https://www.nature.com/articles/nmeth.3005.pdf</a></p>
</div>
<div id="mouse-example" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Mouse example</h3>
<p><img src="figures/mouseTcell_RCB_design.png" width="50%" /></p>
<p>Duguet et al. (2017) MCP 16(8):1416-1432. doi:
10.1074/mcp.m116.062745</p>
<ul>
<li>All treatments of interest are present within block!</li>
<li>We can estimate the effect of the treatment within block!</li>
</ul>
<p>To illustrate the power of blocking we have subsetted the data of
Duguet et al. in a</p>
<ul>
<li><p>completely randomized design with</p>
<ul>
<li>four mice for which we only have measurements on the ordinary
T-cells</li>
<li>four mice for which we only have measurements on the regulatory
T-cells</li>
</ul></li>
<li><p>randomized complete block design with four mice for which we both
have</p>
<ul>
<li>measurements on ordinary T-cells as well as</li>
<li>measurements on regulatory T-cells</li>
</ul></li>
</ul>
</div>
<div id="data" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Data</h3>
<details>
<summary>
Click to see code
</summary>
<p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>peptidesTable <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;https://raw.githubusercontent.com/statOmics/PDA21/data/quantification/mouseTcell/peptidesRCB.txt&quot;</span>)</span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>int64 <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(peptidesTable,class) <span class="sc">==</span> <span class="st">&quot;integer64&quot;</span>)</span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> int64) peptidesTable[[j]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(peptidesTable[[j]]) </span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" tabindex="-1"></a>peptidesTable2 <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;https://raw.githubusercontent.com/statOmics/PDA21/data/quantification/mouseTcell/peptidesCRD.txt&quot;</span>)</span>
<span id="cb65-6"><a href="#cb65-6" tabindex="-1"></a>int64 <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(peptidesTable2,class) <span class="sc">==</span> <span class="st">&quot;integer64&quot;</span>)</span>
<span id="cb65-7"><a href="#cb65-7" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> int64) peptidesTable2[[j]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(peptidesTable2[[j]]) </span>
<span id="cb65-8"><a href="#cb65-8" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" tabindex="-1"></a>peptidesTable3 <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;https://raw.githubusercontent.com/statOmics/PDA21/data/quantification/mouseTcell/peptides.txt&quot;</span>)</span>
<span id="cb65-10"><a href="#cb65-10" tabindex="-1"></a>int64 <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(peptidesTable3,class) <span class="sc">==</span> <span class="st">&quot;integer64&quot;</span>)</span>
<span id="cb65-11"><a href="#cb65-11" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> int64) peptidesTable3[[j]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(peptidesTable3[[j]]) </span>
<span id="cb65-12"><a href="#cb65-12" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" tabindex="-1"></a>quantCols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;Intensity &quot;</span>, <span class="fu">names</span>(peptidesTable))</span>
<span id="cb65-14"><a href="#cb65-14" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(</span>
<span id="cb65-15"><a href="#cb65-15" tabindex="-1"></a>  <span class="at">assayData =</span> peptidesTable,</span>
<span id="cb65-16"><a href="#cb65-16" tabindex="-1"></a>  <span class="at">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb65-17"><a href="#cb65-17" tabindex="-1"></a>  <span class="at">quantCols =</span>  quantCols,</span>
<span id="cb65-18"><a href="#cb65-18" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;peptideRaw&quot;</span>)</span>
<span id="cb65-19"><a href="#cb65-19" tabindex="-1"></a><span class="fu">rm</span>(peptidesTable)</span>
<span id="cb65-20"><a href="#cb65-20" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8800234 470.0   15504024 828.1         NA 15504024 828.1
## Vcells 45274003 345.5   81347764 620.7      16384 81347764 620.7</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8800228 470.0   15504024 828.1         NA 15504024 828.1
## Vcells 45271872 345.4   81347764 620.7      16384 81347764 620.7</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>quantCols2 <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;Intensity &quot;</span>, <span class="fu">names</span>(peptidesTable2))</span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(</span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a>  <span class="at">assayData =</span> peptidesTable2,</span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a>  <span class="at">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a>  <span class="at">quantCols =</span>  quantCols2,</span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;peptideRaw&quot;</span>)</span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a><span class="fu">rm</span>(peptidesTable2)</span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8712110 465.3   15504024 828.1         NA 15504024 828.1
## Vcells 38667053 295.1   81347764 620.7      16384 81347764 620.7</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8712109 465.3   15504024 828.1         NA 15504024 828.1
## Vcells 38662770 295.0   81347764 620.7      16384 81347764 620.7</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a>quantCols3 <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;Intensity &quot;</span>, <span class="fu">names</span>(peptidesTable3))</span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>  <span class="at">assayData =</span> peptidesTable3,</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a>  <span class="at">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a>  <span class="at">quantCols =</span>  quantCols3,</span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;peptideRaw&quot;</span>)</span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a><span class="fu">rm</span>(peptidesTable3)</span>
<span id="cb73-8"><a href="#cb73-8" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8711698 465.3   15504024 828.1         NA 15504024 828.1
## Vcells 29978673 228.8   81347764 620.7      16384 81347764 620.7</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8711623 465.3   15504024 828.1         NA 15504024 828.1
## Vcells 29974115 228.7   81347764 620.7      16384 81347764 620.7</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="do">### Design</span></span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a><span class="fu">colData</span>(pe)<span class="sc">$</span>celltype <span class="ot">&lt;-</span> <span class="fu">substr</span>(</span>
<span id="cb77-3"><a href="#cb77-3" tabindex="-1"></a>  <span class="fu">colnames</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]]),</span>
<span id="cb77-4"><a href="#cb77-4" tabindex="-1"></a>  <span class="dv">11</span>,</span>
<span id="cb77-5"><a href="#cb77-5" tabindex="-1"></a>  <span class="dv">14</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-6"><a href="#cb77-6" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb77-7"><a href="#cb77-7" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb77-8"><a href="#cb77-8" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" tabindex="-1"></a><span class="fu">colData</span>(pe)<span class="sc">$</span>mouse <span class="ot">&lt;-</span> pe[[<span class="dv">1</span>]] <span class="sc">|&gt;</span></span>
<span id="cb77-10"><a href="#cb77-10" tabindex="-1"></a>  <span class="fu">colnames</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-11"><a href="#cb77-11" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="at">split=</span><span class="st">&quot;[ ]&quot;</span>)  <span class="sc">|&gt;</span></span>
<span id="cb77-12"><a href="#cb77-12" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="cf">function</span>(x) x[<span class="dv">3</span>]) <span class="sc">|&gt;</span></span>
<span id="cb77-13"><a href="#cb77-13" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb77-14"><a href="#cb77-14" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" tabindex="-1"></a><span class="fu">colData</span>(pe2)<span class="sc">$</span>celltype <span class="ot">&lt;-</span> <span class="fu">substr</span>(</span>
<span id="cb77-16"><a href="#cb77-16" tabindex="-1"></a>  <span class="fu">colnames</span>(pe2[[<span class="st">&quot;peptideRaw&quot;</span>]]),</span>
<span id="cb77-17"><a href="#cb77-17" tabindex="-1"></a>  <span class="dv">11</span>,</span>
<span id="cb77-18"><a href="#cb77-18" tabindex="-1"></a>  <span class="dv">14</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-19"><a href="#cb77-19" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb77-20"><a href="#cb77-20" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb77-21"><a href="#cb77-21" tabindex="-1"></a></span>
<span id="cb77-22"><a href="#cb77-22" tabindex="-1"></a><span class="fu">colData</span>(pe2)<span class="sc">$</span>mouse <span class="ot">&lt;-</span> pe2[[<span class="dv">1</span>]] <span class="sc">|&gt;</span></span>
<span id="cb77-23"><a href="#cb77-23" tabindex="-1"></a>  <span class="fu">colnames</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-24"><a href="#cb77-24" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="at">split=</span><span class="st">&quot;[ ]&quot;</span>)  <span class="sc">|&gt;</span></span>
<span id="cb77-25"><a href="#cb77-25" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="cf">function</span>(x) x[<span class="dv">3</span>]) <span class="sc">|&gt;</span></span>
<span id="cb77-26"><a href="#cb77-26" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb77-27"><a href="#cb77-27" tabindex="-1"></a></span>
<span id="cb77-28"><a href="#cb77-28" tabindex="-1"></a><span class="fu">colData</span>(pe3)<span class="sc">$</span>celltype <span class="ot">&lt;-</span> <span class="fu">substr</span>(</span>
<span id="cb77-29"><a href="#cb77-29" tabindex="-1"></a>  <span class="fu">colnames</span>(pe3[[<span class="st">&quot;peptideRaw&quot;</span>]]),</span>
<span id="cb77-30"><a href="#cb77-30" tabindex="-1"></a>  <span class="dv">11</span>,</span>
<span id="cb77-31"><a href="#cb77-31" tabindex="-1"></a>  <span class="dv">14</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-32"><a href="#cb77-32" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb77-33"><a href="#cb77-33" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb77-34"><a href="#cb77-34" tabindex="-1"></a></span>
<span id="cb77-35"><a href="#cb77-35" tabindex="-1"></a><span class="fu">colData</span>(pe3)<span class="sc">$</span>mouse <span class="ot">&lt;-</span> pe3[[<span class="dv">1</span>]] <span class="sc">|&gt;</span></span>
<span id="cb77-36"><a href="#cb77-36" tabindex="-1"></a>  <span class="fu">colnames</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-37"><a href="#cb77-37" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="at">split=</span><span class="st">&quot;[ ]&quot;</span>)  <span class="sc">|&gt;</span></span>
<span id="cb77-38"><a href="#cb77-38" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="cf">function</span>(x) x[<span class="dv">3</span>]) <span class="sc">|&gt;</span></span>
<span id="cb77-39"><a href="#cb77-39" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span></code></pre></div>
</p>
<p></design></p>
</div>
<div id="preprocessing-1" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Preprocessing</h3>
<div id="log-transform" class="section level4" number="2.2.4.1">
<h4><span class="header-section-number">2.2.4.1</span>
Log-transform</h4>
<details>
<summary>
Click to see code to log-transfrom the data
</summary>
<p>
<ul>
<li>Peptides with zero intensities are missing peptides and should be
represent with a <code>NA</code> value rather than <code>0</code>.</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">zeroIsNA</span>(pe, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">zeroIsNA</span>(pe2, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span>
<span id="cb78-4"><a href="#cb78-4" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">zeroIsNA</span>(pe3, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span></code></pre></div>
<ul>
<li>Logtransform data with base 2</li>
</ul>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">logTransform</span>(pe, <span class="at">base =</span> <span class="dv">2</span>, <span class="at">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="at">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">logTransform</span>(pe2, <span class="at">base =</span> <span class="dv">2</span>, <span class="at">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="at">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span>
<span id="cb79-4"><a href="#cb79-4" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">logTransform</span>(pe3, <span class="at">base =</span> <span class="dv">2</span>, <span class="at">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="at">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
<div id="filtering" class="section level4" number="2.2.4.2">
<h4><span class="header-section-number">2.2.4.2</span> Filtering</h4>
<details>
<summary>
Click to see details on filtering
</summary>
<p>
<ol style="list-style-type: decimal">
<li>Remove peptides that map to multiple proteins</li>
</ol>
<p>We remove PSMs that could not be mapped to a protein or that map to
multiple proteins (the protein identifier contains multiple identifiers
separated by a <code>;</code>).</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(</span>
<span id="cb80-2"><a href="#cb80-2" tabindex="-1"></a>    pe, <span class="sc">~</span> Proteins <span class="sc">!=</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> <span class="do">## Remove failed protein inference</span></span>
<span id="cb80-3"><a href="#cb80-3" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;;&quot;</span>, Proteins)) <span class="do">## Remove protein groups</span></span></code></pre></div>
<pre><code>## &#39;Proteins&#39; found in 2 out of 2 assay(s).</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(</span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a>    pe2, <span class="sc">~</span> Proteins <span class="sc">!=</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> <span class="do">## Remove failed protein inference</span></span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;;&quot;</span>, Proteins)) <span class="do">## Remove protein groups</span></span></code></pre></div>
<pre><code>## &#39;Proteins&#39; found in 2 out of 2 assay(s).</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(</span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a>    pe3, <span class="sc">~</span> Proteins <span class="sc">!=</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> <span class="do">## Remove failed protein inference</span></span>
<span id="cb84-3"><a href="#cb84-3" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;;&quot;</span>, Proteins)) <span class="do">## Remove protein groups</span></span></code></pre></div>
<pre><code>## &#39;Proteins&#39; found in 2 out of 2 assay(s).</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Remove reverse sequences (decoys) and contaminants</li>
</ol>
<p>We now remove the contaminants, peptides that map to decoy sequences,
and proteins which were only identified by peptides with
modifications.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe,<span class="sc">~</span>Reverse <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Reverse&#39; found in 2 out of 2 assay(s).</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe,<span class="sc">~</span> Potential.contaminant <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Potential.contaminant&#39; found in 2 out of 2 assay(s).</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe2,<span class="sc">~</span>Reverse <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Reverse&#39; found in 2 out of 2 assay(s).</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe2,<span class="sc">~</span> Potential.contaminant <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Potential.contaminant&#39; found in 2 out of 2 assay(s).</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe3,<span class="sc">~</span>Reverse <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Reverse&#39; found in 2 out of 2 assay(s).</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe3,<span class="sc">~</span> Potential.contaminant <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Potential.contaminant&#39; found in 2 out of 2 assay(s).</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Drop peptides that were identified in less than three sample</li>
</ol>
<p>We keep peptides that were observed at least three times.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a>pNA <span class="ot">&lt;-</span> (n<span class="sc">-</span>nObs)<span class="sc">/</span>n</span>
<span id="cb98-4"><a href="#cb98-4" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(pe, <span class="at">pNA =</span> pNA, <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>)</span>
<span id="cb98-5"><a href="#cb98-5" tabindex="-1"></a><span class="fu">nrow</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 38782</code></pre>
<div class="sourceCode" id="cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pe2[[<span class="st">&quot;peptideLog&quot;</span>]])</span>
<span id="cb100-2"><a href="#cb100-2" tabindex="-1"></a>pNA <span class="ot">&lt;-</span> (n<span class="sc">-</span>nObs)<span class="sc">/</span>n</span>
<span id="cb100-3"><a href="#cb100-3" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(pe2, <span class="at">pNA =</span> pNA, <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>)</span>
<span id="cb100-4"><a href="#cb100-4" tabindex="-1"></a><span class="fu">nrow</span>(pe2[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 37898</code></pre>
<div class="sourceCode" id="cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pe3[[<span class="st">&quot;peptideLog&quot;</span>]])</span>
<span id="cb102-2"><a href="#cb102-2" tabindex="-1"></a>pNA <span class="ot">&lt;-</span> (n<span class="sc">-</span>nObs)<span class="sc">/</span>n</span>
<span id="cb102-3"><a href="#cb102-3" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(pe3, <span class="at">pNA =</span> pNA, <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>)</span>
<span id="cb102-4"><a href="#cb102-4" tabindex="-1"></a><span class="fu">nrow</span>(pe3[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 43984</code></pre>
</p>
</details>
</div>
<div id="normalization" class="section level4" number="2.2.4.3">
<h4><span class="header-section-number">2.2.4.3</span>
Normalization</h4>
<details>
<summary>
Click to see code to normalize the data
</summary>
<p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">normalize</span>(pe, </span>
<span id="cb104-2"><a href="#cb104-2" tabindex="-1"></a>                <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb104-3"><a href="#cb104-3" tabindex="-1"></a>                <span class="at">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb104-4"><a href="#cb104-4" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;center.median&quot;</span>)</span>
<span id="cb104-5"><a href="#cb104-5" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">normalize</span>(pe2, </span>
<span id="cb104-7"><a href="#cb104-7" tabindex="-1"></a>                <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb104-8"><a href="#cb104-8" tabindex="-1"></a>                <span class="at">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb104-9"><a href="#cb104-9" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;center.median&quot;</span>)</span>
<span id="cb104-10"><a href="#cb104-10" tabindex="-1"></a></span>
<span id="cb104-11"><a href="#cb104-11" tabindex="-1"></a></span>
<span id="cb104-12"><a href="#cb104-12" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">normalize</span>(pe3, </span>
<span id="cb104-13"><a href="#cb104-13" tabindex="-1"></a>                <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb104-14"><a href="#cb104-14" tabindex="-1"></a>                <span class="at">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb104-15"><a href="#cb104-15" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;center.median&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
<div id="summarization" class="section level4" number="2.2.4.4">
<h4><span class="header-section-number">2.2.4.4</span>
Summarization</h4>
<details>
<summary>
Click to see code to summarize the data
</summary>
<p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">aggregateFeatures</span>(pe,</span>
<span id="cb105-2"><a href="#cb105-2" tabindex="-1"></a> <span class="at">i =</span> <span class="st">&quot;peptideNorm&quot;</span>,</span>
<span id="cb105-3"><a href="#cb105-3" tabindex="-1"></a> <span class="at">fcol =</span> <span class="st">&quot;Proteins&quot;</span>,</span>
<span id="cb105-4"><a href="#cb105-4" tabindex="-1"></a> <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-5"><a href="#cb105-5" tabindex="-1"></a> <span class="at">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
<pre><code>## Your quantitative and row data contain missing values. Please read the
## relevant section(s) in the aggregateFeatures manual page regarding the
## effects of missing values on data aggregation.</code></pre>
<pre><code>## Aggregated: 1/1</code></pre>
<div class="sourceCode" id="cb108"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">aggregateFeatures</span>(pe2,</span>
<span id="cb108-2"><a href="#cb108-2" tabindex="-1"></a> <span class="at">i =</span> <span class="st">&quot;peptideNorm&quot;</span>,</span>
<span id="cb108-3"><a href="#cb108-3" tabindex="-1"></a> <span class="at">fcol =</span> <span class="st">&quot;Proteins&quot;</span>,</span>
<span id="cb108-4"><a href="#cb108-4" tabindex="-1"></a> <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb108-5"><a href="#cb108-5" tabindex="-1"></a> <span class="at">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
<pre><code>## Your quantitative and row data contain missing values. Please read the
## relevant section(s) in the aggregateFeatures manual page regarding the
## effects of missing values on data aggregation.
## Aggregated: 1/1</code></pre>
<div class="sourceCode" id="cb110"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">aggregateFeatures</span>(pe3,</span>
<span id="cb110-2"><a href="#cb110-2" tabindex="-1"></a> <span class="at">i =</span> <span class="st">&quot;peptideNorm&quot;</span>,</span>
<span id="cb110-3"><a href="#cb110-3" tabindex="-1"></a> <span class="at">fcol =</span> <span class="st">&quot;Proteins&quot;</span>,</span>
<span id="cb110-4"><a href="#cb110-4" tabindex="-1"></a> <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb110-5"><a href="#cb110-5" tabindex="-1"></a> <span class="at">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
<pre><code>## Your quantitative and row data contain missing values. Please read the
## relevant section(s) in the aggregateFeatures manual page regarding the
## effects of missing values on data aggregation.
## Aggregated: 1/1</code></pre>
</div>
<div id="filtering-proteins-with-too-many-missing-values"
class="section level4" number="2.2.4.5">
<h4><span class="header-section-number">2.2.4.5</span> Filtering
proteins with too many missing values</h4>
<p>We want to have at least two observed protein intensities for each
group so we set the minimum number of observed values at 4. We still
have to check for the observed proteins if that is the case.</p>
<p>For block design more clever filtering can be used. E.g. we could
imply that we have both cell types in at least two animals…</p>
<div class="sourceCode" id="cb112"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb112-2"><a href="#cb112-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pe[[<span class="st">&quot;protein&quot;</span>]])</span>
<span id="cb112-3"><a href="#cb112-3" tabindex="-1"></a>pNA <span class="ot">&lt;-</span> (n<span class="sc">-</span>nObs)<span class="sc">/</span>n</span>
<span id="cb112-4"><a href="#cb112-4" tabindex="-1"></a>pe<span class="ot">&lt;-</span> <span class="fu">filterNA</span>(pe, <span class="at">pNA =</span> pNA, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>)</span>
<span id="cb112-5"><a href="#cb112-5" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pe2[[<span class="st">&quot;protein&quot;</span>]])</span>
<span id="cb112-7"><a href="#cb112-7" tabindex="-1"></a>pNA <span class="ot">&lt;-</span> (n<span class="sc">-</span>nObs)<span class="sc">/</span>n</span>
<span id="cb112-8"><a href="#cb112-8" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(pe2, <span class="at">pNA =</span> pNA, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>)</span>
<span id="cb112-9"><a href="#cb112-9" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pe3[[<span class="st">&quot;protein&quot;</span>]])</span>
<span id="cb112-11"><a href="#cb112-11" tabindex="-1"></a>pNA <span class="ot">&lt;-</span> (n<span class="sc">-</span>nObs)<span class="sc">/</span>n</span>
<span id="cb112-12"><a href="#cb112-12" tabindex="-1"></a>pe3 <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(pe3, <span class="at">pNA =</span> pNA, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
</div>
<div id="data-exploration-what-is-impact-of-blocking"
class="section level3" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Data Exploration:
what is impact of blocking?</h3>
<details>
<summary>
Click to see code
</summary>
<p>
<div class="sourceCode" id="cb113"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">colData</span>(pe3)<span class="sc">$</span>mouse) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;m&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb113-2"><a href="#cb113-2" tabindex="-1"></a>mdsObj3 <span class="ot">&lt;-</span> <span class="fu">plotMDS</span>(<span class="fu">assay</span>(pe3[[<span class="st">&quot;protein&quot;</span>]]), <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb113-3"><a href="#cb113-3" tabindex="-1"></a>mdsOrig <span class="ot">&lt;-</span> <span class="fu">colData</span>(pe3) <span class="sc">|&gt;</span></span>
<span id="cb113-4"><a href="#cb113-4" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb113-5"><a href="#cb113-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mds1 =</span> mdsObj3<span class="sc">$</span>x,</span>
<span id="cb113-6"><a href="#cb113-6" tabindex="-1"></a>         <span class="at">mds2 =</span> mdsObj3<span class="sc">$</span>y,</span>
<span id="cb113-7"><a href="#cb113-7" tabindex="-1"></a>         <span class="at">lab =</span> <span class="fu">paste</span>(mouse,celltype,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb113-8"><a href="#cb113-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mds1, <span class="at">y =</span> mds2, <span class="at">label =</span> lab, <span class="at">color =</span> celltype, <span class="at">group =</span> mouse)) <span class="sc">+</span></span>
<span id="cb113-9"><a href="#cb113-9" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb113-10"><a href="#cb113-10" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb113-11"><a href="#cb113-11" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb113-12"><a href="#cb113-12" tabindex="-1"></a>  <span class="fu">xlab</span>(</span>
<span id="cb113-13"><a href="#cb113-13" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb113-14"><a href="#cb113-14" tabindex="-1"></a>      mdsObj3<span class="sc">$</span>axislabel,</span>
<span id="cb113-15"><a href="#cb113-15" tabindex="-1"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb113-16"><a href="#cb113-16" tabindex="-1"></a>      <span class="dv">1</span>, </span>
<span id="cb113-17"><a href="#cb113-17" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb113-18"><a href="#cb113-18" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb113-19"><a href="#cb113-19" tabindex="-1"></a>        <span class="fu">round</span>(mdsObj3<span class="sc">$</span>var.explained[<span class="dv">1</span>] <span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb113-20"><a href="#cb113-20" tabindex="-1"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb113-21"><a href="#cb113-21" tabindex="-1"></a>        ),</span>
<span id="cb113-22"><a href="#cb113-22" tabindex="-1"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb113-23"><a href="#cb113-23" tabindex="-1"></a>      )</span>
<span id="cb113-24"><a href="#cb113-24" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb113-25"><a href="#cb113-25" tabindex="-1"></a>  <span class="fu">ylab</span>(</span>
<span id="cb113-26"><a href="#cb113-26" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb113-27"><a href="#cb113-27" tabindex="-1"></a>      mdsObj3<span class="sc">$</span>axislabel,</span>
<span id="cb113-28"><a href="#cb113-28" tabindex="-1"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb113-29"><a href="#cb113-29" tabindex="-1"></a>      <span class="dv">2</span>, </span>
<span id="cb113-30"><a href="#cb113-30" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb113-31"><a href="#cb113-31" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb113-32"><a href="#cb113-32" tabindex="-1"></a>        <span class="fu">round</span>(mdsObj3<span class="sc">$</span>var.explained[<span class="dv">2</span>] <span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb113-33"><a href="#cb113-33" tabindex="-1"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb113-34"><a href="#cb113-34" tabindex="-1"></a>        ),</span>
<span id="cb113-35"><a href="#cb113-35" tabindex="-1"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb113-36"><a href="#cb113-36" tabindex="-1"></a>      )</span>
<span id="cb113-37"><a href="#cb113-37" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb113-38"><a href="#cb113-38" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Original (RCB)&quot;</span>)</span>
<span id="cb113-39"><a href="#cb113-39" tabindex="-1"></a></span>
<span id="cb113-40"><a href="#cb113-40" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">colData</span>(pe)<span class="sc">$</span>mouse) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;m&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb113-41"><a href="#cb113-41" tabindex="-1"></a>mdsObj <span class="ot">&lt;-</span> <span class="fu">plotMDS</span>(<span class="fu">assay</span>(pe[[<span class="st">&quot;protein&quot;</span>]]), <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb113-42"><a href="#cb113-42" tabindex="-1"></a>mdsRCB <span class="ot">&lt;-</span> <span class="fu">colData</span>(pe) <span class="sc">|&gt;</span></span>
<span id="cb113-43"><a href="#cb113-43" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb113-44"><a href="#cb113-44" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mds1 =</span> mdsObj<span class="sc">$</span>x,</span>
<span id="cb113-45"><a href="#cb113-45" tabindex="-1"></a>         <span class="at">mds2 =</span> mdsObj<span class="sc">$</span>y,</span>
<span id="cb113-46"><a href="#cb113-46" tabindex="-1"></a>         <span class="at">lab =</span> <span class="fu">paste</span>(mouse,celltype,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb113-47"><a href="#cb113-47" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mds1, <span class="at">y =</span> mds2, <span class="at">label =</span> lab, <span class="at">color =</span> celltype, <span class="at">group =</span> mouse)) <span class="sc">+</span></span>
<span id="cb113-48"><a href="#cb113-48" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb113-49"><a href="#cb113-49" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb113-50"><a href="#cb113-50" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb113-51"><a href="#cb113-51" tabindex="-1"></a>  <span class="fu">xlab</span>(</span>
<span id="cb113-52"><a href="#cb113-52" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb113-53"><a href="#cb113-53" tabindex="-1"></a>      mdsObj<span class="sc">$</span>axislabel,</span>
<span id="cb113-54"><a href="#cb113-54" tabindex="-1"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb113-55"><a href="#cb113-55" tabindex="-1"></a>      <span class="dv">1</span>, </span>
<span id="cb113-56"><a href="#cb113-56" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb113-57"><a href="#cb113-57" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb113-58"><a href="#cb113-58" tabindex="-1"></a>        <span class="fu">round</span>(mdsObj<span class="sc">$</span>var.explained[<span class="dv">1</span>] <span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb113-59"><a href="#cb113-59" tabindex="-1"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb113-60"><a href="#cb113-60" tabindex="-1"></a>        ),</span>
<span id="cb113-61"><a href="#cb113-61" tabindex="-1"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb113-62"><a href="#cb113-62" tabindex="-1"></a>      )</span>
<span id="cb113-63"><a href="#cb113-63" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb113-64"><a href="#cb113-64" tabindex="-1"></a>  <span class="fu">ylab</span>(</span>
<span id="cb113-65"><a href="#cb113-65" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb113-66"><a href="#cb113-66" tabindex="-1"></a>      mdsObj<span class="sc">$</span>axislabel,</span>
<span id="cb113-67"><a href="#cb113-67" tabindex="-1"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb113-68"><a href="#cb113-68" tabindex="-1"></a>      <span class="dv">2</span>, </span>
<span id="cb113-69"><a href="#cb113-69" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb113-70"><a href="#cb113-70" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb113-71"><a href="#cb113-71" tabindex="-1"></a>        <span class="fu">round</span>(mdsObj<span class="sc">$</span>var.explained[<span class="dv">2</span>] <span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb113-72"><a href="#cb113-72" tabindex="-1"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb113-73"><a href="#cb113-73" tabindex="-1"></a>        ),</span>
<span id="cb113-74"><a href="#cb113-74" tabindex="-1"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb113-75"><a href="#cb113-75" tabindex="-1"></a>      )</span>
<span id="cb113-76"><a href="#cb113-76" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb113-77"><a href="#cb113-77" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Randomized Complete Block (RCB)&quot;</span>)</span>
<span id="cb113-78"><a href="#cb113-78" tabindex="-1"></a></span>
<span id="cb113-79"><a href="#cb113-79" tabindex="-1"></a></span>
<span id="cb113-80"><a href="#cb113-80" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">colData</span>(pe2)<span class="sc">$</span>mouse) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;m&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb113-81"><a href="#cb113-81" tabindex="-1"></a>mdsObj2 <span class="ot">&lt;-</span> <span class="fu">plotMDS</span>(<span class="fu">assay</span>(pe2[[<span class="st">&quot;protein&quot;</span>]]), <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb113-82"><a href="#cb113-82" tabindex="-1"></a>mdsCRD <span class="ot">&lt;-</span> <span class="fu">colData</span>(pe2) <span class="sc">|&gt;</span></span>
<span id="cb113-83"><a href="#cb113-83" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb113-84"><a href="#cb113-84" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mds1 =</span> mdsObj2<span class="sc">$</span>x,</span>
<span id="cb113-85"><a href="#cb113-85" tabindex="-1"></a>         <span class="at">mds2 =</span> mdsObj2<span class="sc">$</span>y,</span>
<span id="cb113-86"><a href="#cb113-86" tabindex="-1"></a>         <span class="at">lab =</span> <span class="fu">paste</span>(mouse,celltype,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb113-87"><a href="#cb113-87" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mds1, <span class="at">y =</span> mds2, <span class="at">label =</span> lab, <span class="at">color =</span> celltype, <span class="at">group =</span> mouse)) <span class="sc">+</span></span>
<span id="cb113-88"><a href="#cb113-88" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb113-89"><a href="#cb113-89" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb113-90"><a href="#cb113-90" tabindex="-1"></a>  <span class="fu">xlab</span>(</span>
<span id="cb113-91"><a href="#cb113-91" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb113-92"><a href="#cb113-92" tabindex="-1"></a>      mdsObj<span class="sc">$</span>axislabel,</span>
<span id="cb113-93"><a href="#cb113-93" tabindex="-1"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb113-94"><a href="#cb113-94" tabindex="-1"></a>      <span class="dv">1</span>, </span>
<span id="cb113-95"><a href="#cb113-95" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb113-96"><a href="#cb113-96" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb113-97"><a href="#cb113-97" tabindex="-1"></a>        <span class="fu">round</span>(mdsObj2<span class="sc">$</span>var.explained[<span class="dv">1</span>] <span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb113-98"><a href="#cb113-98" tabindex="-1"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb113-99"><a href="#cb113-99" tabindex="-1"></a>        ),</span>
<span id="cb113-100"><a href="#cb113-100" tabindex="-1"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb113-101"><a href="#cb113-101" tabindex="-1"></a>      )</span>
<span id="cb113-102"><a href="#cb113-102" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb113-103"><a href="#cb113-103" tabindex="-1"></a>  <span class="fu">ylab</span>(</span>
<span id="cb113-104"><a href="#cb113-104" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb113-105"><a href="#cb113-105" tabindex="-1"></a>      mdsObj<span class="sc">$</span>axislabel,</span>
<span id="cb113-106"><a href="#cb113-106" tabindex="-1"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb113-107"><a href="#cb113-107" tabindex="-1"></a>      <span class="dv">2</span>, </span>
<span id="cb113-108"><a href="#cb113-108" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb113-109"><a href="#cb113-109" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb113-110"><a href="#cb113-110" tabindex="-1"></a>        <span class="fu">round</span>(mdsObj2<span class="sc">$</span>var.explained[<span class="dv">2</span>] <span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb113-111"><a href="#cb113-111" tabindex="-1"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb113-112"><a href="#cb113-112" tabindex="-1"></a>        ),</span>
<span id="cb113-113"><a href="#cb113-113" tabindex="-1"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb113-114"><a href="#cb113-114" tabindex="-1"></a>      )</span>
<span id="cb113-115"><a href="#cb113-115" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb113-116"><a href="#cb113-116" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Completely Randomized Design (CRD)&quot;</span>)</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb114"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" tabindex="-1"></a>mdsOrig</span></code></pre></div>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<div class="sourceCode" id="cb115"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a>mdsRCB</span></code></pre></div>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-52-2.png" width="672" /></p>
<div class="sourceCode" id="cb116"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" tabindex="-1"></a>mdsCRD</span></code></pre></div>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-52-3.png" width="672" /></p>
<ul>
<li><p>We observe that the leading fold change is according to
mouse</p></li>
<li><p>In the second dimension we see a separation according to
cell-type</p></li>
<li><p>With the Randomized Complete Block design (RCB) we can remove the
mouse effect from the analysis!</p></li>
<li><p>We can isolate the between block variability from the analysis
using linear model:</p>
<ul>
<li><p>Formula in R <span class="math display">\[
y \sim \text{celltype} + \text{mouse}
\]</span></p></li>
<li><p>Formula</p></li>
</ul></li>
</ul>
<p><span class="math display">\[
y_i = \beta_0 + \beta_\text{Treg} x_{i,\text{Treg}} + \beta_{m2}x_{i,m2}
+ \beta_{m3}x_{i,m3} + \beta_{m4}x_{i,m4}  + \epsilon_i
\]</span></p>
<p>with</p>
<ul>
<li><p><span class="math inline">\(x_{i,Treg}=\begin{cases}
1&amp; \text{Treg}\\
0&amp; \text{Tcon}
\end{cases}\)</span></p></li>
<li><p><span class="math inline">\(x_{i,m2}=\begin{cases}
1&amp; \text{m2}\\
0&amp; \text{otherwise}
\end{cases}\)</span></p></li>
<li><p><span class="math inline">\(x_{i,m3}=\begin{cases}
1&amp; \text{m3}\\
0&amp; \text{otherwise}
\end{cases}\)</span></p></li>
<li><p><span class="math inline">\(x_{i,m4}=\begin{cases}
1&amp; \text{m4}\\
0&amp; \text{otherwise}
\end{cases}\)</span></p></li>
<li><p>Possible in msqrob2 and MSstats but not possible with
Perseus!</p></li>
</ul>
</div>
<div id="modeling-and-inference" class="section level3" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Modeling and
inference</h3>
<div id="rcb-analysis" class="section level4" number="2.2.6.1">
<h4><span class="header-section-number">2.2.6.1</span> RCB analysis</h4>
<div class="sourceCode" id="cb117"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">msqrob</span>(</span>
<span id="cb117-2"><a href="#cb117-2" tabindex="-1"></a>  <span class="at">object =</span> pe,</span>
<span id="cb117-3"><a href="#cb117-3" tabindex="-1"></a>  <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>,</span>
<span id="cb117-4"><a href="#cb117-4" tabindex="-1"></a>  <span class="at">formula =</span> <span class="sc">~</span> celltype <span class="sc">+</span> mouse)</span></code></pre></div>
</div>
<div id="crd-analysis" class="section level4" number="2.2.6.2">
<h4><span class="header-section-number">2.2.6.2</span> CRD analysis</h4>
<div class="sourceCode" id="cb118"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">msqrob</span>(</span>
<span id="cb118-2"><a href="#cb118-2" tabindex="-1"></a>  <span class="at">object =</span> pe2,</span>
<span id="cb118-3"><a href="#cb118-3" tabindex="-1"></a>  <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>,</span>
<span id="cb118-4"><a href="#cb118-4" tabindex="-1"></a>  <span class="at">formula =</span> <span class="sc">~</span> celltype)</span></code></pre></div>
</div>
<div id="estimation-effect-size-and-inference" class="section level4"
number="2.2.6.3">
<h4><span class="header-section-number">2.2.6.3</span> Estimation,
effect size and inference</h4>
<p>Effect size in RCB</p>
<div class="sourceCode" id="cb119"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a><span class="fu">library</span>(ExploreModelMatrix)</span>
<span id="cb119-2"><a href="#cb119-2" tabindex="-1"></a><span class="fu">VisualizeDesign</span>(<span class="fu">colData</span>(pe),<span class="sc">~</span> celltype <span class="sc">+</span> mouse)<span class="sc">$</span>plotlist</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<p>Effect size in CRD</p>
<div class="sourceCode" id="cb121"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a><span class="fu">VisualizeDesign</span>(<span class="fu">colData</span>(pe2),<span class="sc">~</span> celltype)<span class="sc">$</span>plotlist</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<details>
<summary>
Click to see code for statistical inference
</summary>
<p>
<div class="sourceCode" id="cb123"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(<span class="st">&quot;celltypeTreg = 0&quot;</span>, <span class="at">parameterNames =</span> <span class="fu">c</span>(<span class="st">&quot;celltypeTreg&quot;</span>))</span>
<span id="cb123-2"><a href="#cb123-2" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(<span class="at">object =</span> pe, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="at">contrast =</span> L)</span>
<span id="cb123-3"><a href="#cb123-3" tabindex="-1"></a>pe2 <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(<span class="at">object =</span> pe2, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="at">contrast =</span> L)</span></code></pre></div>
</p>
</details>
</div>
</div>
<div id="comparison-of-results" class="section level3" number="2.2.7">
<h3><span class="header-section-number">2.2.7</span> Comparison of
results</h3>
<details>
<summary>
Click to see code
</summary>
<p>
</p>
</details>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-59-1.png" width="672" /><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-59-2.png" width="672" /></p>
</div>
<div id="comparison-of-standard-deviation" class="section level3"
number="2.2.8">
<h3><span class="header-section-number">2.2.8</span> Comparison of
standard deviation</h3>
<details>
<summary>
Click to see code
</summary>
<p>
<div class="sourceCode" id="cb124"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" tabindex="-1"></a>accessions <span class="ot">&lt;-</span> <span class="fu">rownames</span>(pe[[<span class="st">&quot;protein&quot;</span>]])[<span class="fu">rownames</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">%in%</span><span class="fu">rownames</span>(pe2[[<span class="st">&quot;protein&quot;</span>]])]</span>
<span id="cb124-2"><a href="#cb124-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb124-3"><a href="#cb124-3" tabindex="-1"></a><span class="at">sigmaRBC =</span> <span class="fu">sapply</span>(<span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>msqrobModels[accessions], getSigmaPosterior),</span>
<span id="cb124-4"><a href="#cb124-4" tabindex="-1"></a>sigmaCRD <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">rowData</span>(pe2[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>msqrobModels[accessions], getSigmaPosterior)</span>
<span id="cb124-5"><a href="#cb124-5" tabindex="-1"></a>)</span>
<span id="cb124-6"><a href="#cb124-6" tabindex="-1"></a></span>
<span id="cb124-7"><a href="#cb124-7" tabindex="-1"></a>plotRBCvsCRD <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(sigmaRBC, sigmaCRD)) <span class="sc">+</span></span>
<span id="cb124-8"><a href="#cb124-8" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">shape =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb124-9"><a href="#cb124-9" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb124-10"><a href="#cb124-10" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb124-11"><a href="#cb124-11" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>)</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb125"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" tabindex="-1"></a>  plotRBCvsCRD</span></code></pre></div>
<pre><code>## Warning: Removed 351 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<ul>
<li><p>We clearly observe that the standard deviation of the protein
expression in the RCB is smaller for the majority of the proteins than
that obtained with the CRD</p></li>
<li><p>Can you think of a reason why it would not be useful to block on
a particular factor?</p></li>
</ul>
</div>
</div>
<div id="pseudo-replication" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span>
Pseudo-replication</h2>
<ul>
<li>The Francisella tularensis that we used before was a subset of the
data of Ramond et al. </li>
<li>The authors have run the sample for each bio-rep in technical
triplicate on the mass-spectrometer.</li>
</ul>
<div id="data-1" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Data</h3>
<details>
<summary>
Click to see code to import data
</summary>
<p>
<ol style="list-style-type: decimal">
<li>We use a peptides.txt file from MS-data quantified with maxquant
that contains MS1 intensities summarized at the peptide level.</li>
</ol>
<div class="sourceCode" id="cb127"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" tabindex="-1"></a>peptidesTable <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;https://raw.githubusercontent.com/statOmics/MSqRobSumPaper/refs/heads/master/Francisella/data/maxquant/peptides.txt&quot;</span>)</span>
<span id="cb127-2"><a href="#cb127-2" tabindex="-1"></a>int64 <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(peptidesTable,class) <span class="sc">==</span> <span class="st">&quot;integer64&quot;</span>)</span>
<span id="cb127-3"><a href="#cb127-3" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> int64) peptidesTable[[j]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(peptidesTable[[j]])                      </span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Maxquant stores the intensity data for the different samples in
columnns that start with Intensity. We can retreive the column names
with the intensity data with the code below:</li>
</ol>
<div class="sourceCode" id="cb128"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" tabindex="-1"></a>quantCols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;Intensity &quot;</span>, <span class="fu">names</span>(peptidesTable))</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Read the data and store it in QFeatures object</li>
</ol>
<div class="sourceCode" id="cb129"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(</span>
<span id="cb129-2"><a href="#cb129-2" tabindex="-1"></a>  <span class="at">assayData =</span> peptidesTable,</span>
<span id="cb129-3"><a href="#cb129-3" tabindex="-1"></a>  <span class="at">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb129-4"><a href="#cb129-4" tabindex="-1"></a>  <span class="at">quantCols =</span>  quantCols,</span>
<span id="cb129-5"><a href="#cb129-5" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;peptideRaw&quot;</span>)</span></code></pre></div>
<pre><code>## Checking arguments.</code></pre>
<pre><code>## Loading data as a &#39;SummarizedExperiment&#39; object.</code></pre>
<pre><code>## Formatting sample annotations (colData).</code></pre>
<pre><code>## Formatting data as a &#39;QFeatures&#39; object.</code></pre>
<pre><code>## Setting assay rownames.</code></pre>
<div class="sourceCode" id="cb135"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" tabindex="-1"></a><span class="fu">rm</span>(peptidesTable)</span>
<span id="cb135-2"><a href="#cb135-2" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8796284 469.8   15504024 828.1         NA 15504024 828.1
## Vcells 34766774 265.3   81347764 620.7      16384 81347764 620.7</code></pre>
<div class="sourceCode" id="cb137"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##            used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
## Ncells  8796277 469.8   15504024 828.1         NA 15504024 828.1
## Vcells 34766799 265.3   81347764 620.7      16384 81347764 620.7</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Update data with information on design</li>
</ol>
<div class="sourceCode" id="cb139"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" tabindex="-1"></a><span class="fu">colData</span>(pe)<span class="sc">$</span>genotype <span class="ot">&lt;-</span> pe[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> </span>
<span id="cb139-2"><a href="#cb139-2" tabindex="-1"></a>  <span class="fu">colnames</span>() <span class="sc">|&gt;</span> </span>
<span id="cb139-3"><a href="#cb139-3" tabindex="-1"></a>  <span class="fu">substr</span>(<span class="dv">12</span>,<span class="dv">13</span>) <span class="sc">|&gt;</span></span>
<span id="cb139-4"><a href="#cb139-4" tabindex="-1"></a>  <span class="fu">as.factor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb139-5"><a href="#cb139-5" tabindex="-1"></a>  <span class="fu">relevel</span>(<span class="st">&quot;WT&quot;</span>)</span>
<span id="cb139-6"><a href="#cb139-6" tabindex="-1"></a></span>
<span id="cb139-7"><a href="#cb139-7" tabindex="-1"></a><span class="fu">colData</span>(pe)<span class="sc">$</span>biorep <span class="ot">&lt;-</span> pe[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> </span>
<span id="cb139-8"><a href="#cb139-8" tabindex="-1"></a>  <span class="fu">colnames</span>() <span class="sc">|&gt;</span> </span>
<span id="cb139-9"><a href="#cb139-9" tabindex="-1"></a>  <span class="fu">substr</span>(<span class="dv">22</span>,<span class="dv">22</span>)</span>
<span id="cb139-10"><a href="#cb139-10" tabindex="-1"></a></span>
<span id="cb139-11"><a href="#cb139-11" tabindex="-1"></a><span class="fu">colData</span>(pe)<span class="sc">$</span>biorep <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">colData</span>(pe)<span class="sc">$</span>genotype,<span class="fu">colData</span>(pe)<span class="sc">$</span>biorep,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb139-12"><a href="#cb139-12" tabindex="-1"></a>  </span>
<span id="cb139-13"><a href="#cb139-13" tabindex="-1"></a>pe <span class="sc">|&gt;</span> <span class="fu">colData</span>()</span></code></pre></div>
<pre><code>## DataFrame with 18 rows and 2 columns
##                          genotype      biorep
##                          &lt;factor&gt; &lt;character&gt;
## Intensity 1WT_20_2h_n3_1       WT        WT_3
## Intensity 1WT_20_2h_n3_2       WT        WT_3
## Intensity 1WT_20_2h_n3_3       WT        WT_3
## Intensity 1WT_20_2h_n4_1       WT        WT_4
## Intensity 1WT_20_2h_n4_2       WT        WT_4
## ...                           ...         ...
## Intensity 3D8_20_2h_n4_2       D8        D8_4
## Intensity 3D8_20_2h_n4_3       D8        D8_4
## Intensity 3D8_20_2h_n5_1       D8        D8_5
## Intensity 3D8_20_2h_n5_2       D8        D8_5
## Intensity 3D8_20_2h_n5_3       D8        D8_5</code></pre>
</p>
</details>
</div>
<div id="preprocessing-2" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Preprocessing</h3>
<details>
<summary>
Click to see code to log-transfrom the data
</summary>
<p>
<ol style="list-style-type: decimal">
<li>Log transform</li>
</ol>
<ul>
<li>Peptides with zero intensities are missing peptides and should be
represent with a <code>NA</code> value rather than <code>0</code>.</li>
</ul>
<div class="sourceCode" id="cb141"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">zeroIsNA</span>(pe, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span></code></pre></div>
<ul>
<li>Logtransform data with base 2</li>
</ul>
<div class="sourceCode" id="cb142"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">logTransform</span>(pe, <span class="at">base =</span> <span class="dv">2</span>, <span class="at">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="at">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Filtering</li>
</ol>
<ul>
<li>We remove PSMs that could not be mapped to a protein or that map to
multiple proteins (the protein identifier contains multiple identifiers
separated by a <code>;</code>).</li>
</ul>
<div class="sourceCode" id="cb143"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(</span>
<span id="cb143-2"><a href="#cb143-2" tabindex="-1"></a>    pe, <span class="sc">~</span> Proteins <span class="sc">!=</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> <span class="do">## Remove failed protein inference</span></span>
<span id="cb143-3"><a href="#cb143-3" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;;&quot;</span>, Proteins)) <span class="do">## Remove protein groups</span></span></code></pre></div>
<pre><code>## &#39;Proteins&#39; found in 2 out of 2 assay(s).</code></pre>
<ul>
<li>Remove reverse sequences (decoys) and contaminants. Note that this
is indicated by the column names Reverse and depending on the version of
maxQuant with Potential.contaminants or Contaminants.</li>
</ul>
<div class="sourceCode" id="cb145"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe,<span class="sc">~</span>Reverse <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Reverse&#39; found in 2 out of 2 assay(s).</code></pre>
<div class="sourceCode" id="cb147"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(pe,<span class="sc">~</span> Contaminant <span class="sc">!=</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;Contaminant&#39; found in 2 out of 2 assay(s).</code></pre>
<ul>
<li>Drop peptides that were identified in less than three sample. We
tolerate the following proportion of NAs: pNA = (n-3)/n. </li>
</ul>
<div class="sourceCode" id="cb149"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb149-2"><a href="#cb149-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span>
<span id="cb149-3"><a href="#cb149-3" tabindex="-1"></a>pNA <span class="ot">&lt;-</span> (n<span class="sc">-</span>nObs)<span class="sc">/</span>n</span>
<span id="cb149-4"><a href="#cb149-4" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(pe, <span class="at">pNA =</span> pNA, <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>)</span>
<span id="cb149-5"><a href="#cb149-5" tabindex="-1"></a><span class="fu">nrow</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 7244</code></pre>
<p>We keep 7244 peptides upon filtering.</p>
<ol start="3" style="list-style-type: decimal">
<li>Normalization by median centering</li>
</ol>
<div class="sourceCode" id="cb151"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">normalize</span>(pe, </span>
<span id="cb151-2"><a href="#cb151-2" tabindex="-1"></a>                <span class="at">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb151-3"><a href="#cb151-3" tabindex="-1"></a>                <span class="at">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb151-4"><a href="#cb151-4" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;center.median&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Summarization. We use the standard sumarisation in
aggregateFeatures, which is a robust summarisation method.</li>
</ol>
<div class="sourceCode" id="cb152"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">aggregateFeatures</span>(pe,</span>
<span id="cb152-2"><a href="#cb152-2" tabindex="-1"></a>    <span class="at">i =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb152-3"><a href="#cb152-3" tabindex="-1"></a>    <span class="at">fcol =</span> <span class="st">&quot;Proteins&quot;</span>, </span>
<span id="cb152-4"><a href="#cb152-4" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb152-5"><a href="#cb152-5" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
<pre><code>## Your quantitative and row data contain missing values. Please read the
## relevant section(s) in the aggregateFeatures manual page regarding the
## effects of missing values on data aggregation.</code></pre>
<pre><code>## Aggregated: 1/1</code></pre>
</p>
</details>
<div class="sourceCode" id="cb155"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" tabindex="-1"></a>msqrob2gui<span class="sc">:::</span><span class="fu">plotPCA</span>(pe, <span class="st">&quot;protein&quot;</span>, <span class="st">&quot;biorep&quot;</span>)</span></code></pre></div>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<ul>
<li>Response?</li>
<li>Experimental unit?</li>
<li>Observational unit?</li>
<li>Factors?</li>
</ul>
<div class="sourceCode" id="cb156"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" tabindex="-1"></a><span class="fu">VisualizeDesign</span>(<span class="fu">colData</span>(pe),<span class="sc">~</span> genotype <span class="sc">+</span> biorep)<span class="sc">$</span>plotlist</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p><span class="math inline">\(\rightarrow\)</span> Pseudo-replication,
randomisation to bio-repeat and each bio-repeat measured in technical
triplicate. <span class="math inline">\(\rightarrow\)</span> If we would
analyse the data using a linear model based on each measured intensity,
we would act as if we had sampled 18 bio-repeats. <span
class="math inline">\(\rightarrow\)</span> Effect of interest has to be
assessed between bio-repeats. So block analysis is not possible (if we
condition on bio-repeat, we condition on the genotype)!</p>
</div>
<div id="wrong-analysis" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Wrong analysis</h3>
<div class="sourceCode" id="cb158"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">msqrob</span>(<span class="at">object =</span> pe, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="at">formula =</span> <span class="sc">~</span>genotype, <span class="at">modelColumnName =</span> <span class="st">&quot;wrong&quot;</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-2"><a href="#cb158-2" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(<span class="st">&quot;genotypeD8 = 0&quot;</span>, <span class="at">parameterNames =</span> <span class="fu">c</span>(<span class="st">&quot;genotypeD8&quot;</span>))</span>
<span id="cb158-3"><a href="#cb158-3" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(<span class="at">object =</span> pe, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="at">contrast =</span> L, <span class="at">modelColumn =</span> <span class="st">&quot;wrong&quot;</span>,   <span class="at">resultsColumnNamePrefix =</span> <span class="st">&quot;wrong_&quot;</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-4"><a href="#cb158-4" tabindex="-1"></a></span>
<span id="cb158-5"><a href="#cb158-5" tabindex="-1"></a>volcanoWrong <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb158-6"><a href="#cb158-6" tabindex="-1"></a>    <span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>wrong_genotypeD8,</span>
<span id="cb158-7"><a href="#cb158-7" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(pval), <span class="at">color =</span> adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb158-8"><a href="#cb158-8" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb158-9"><a href="#cb158-9" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">cex =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb158-10"><a href="#cb158-10" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb158-11"><a href="#cb158-11" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb158-12"><a href="#cb158-12" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">&quot;wrong analysis: &quot;</span>,<span class="fu">sum</span>(<span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>wrong_genotypeD8<span class="sc">$</span>adjPval <span class="sc">&lt;</span><span class="fl">0.05</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),<span class="st">&quot; DA&quot;</span>))</span>
<span id="cb158-13"><a href="#cb158-13" tabindex="-1"></a></span>
<span id="cb158-14"><a href="#cb158-14" tabindex="-1"></a>volcanoWrong</span></code></pre></div>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Note, that the analysis where we ignore that we have multiple
technical repeats for each bio-repeat returns many significant DA
proteins because we act as if we have much more independent
observations.</p>
</div>
<div id="correct-analysis" class="section level3" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Correct
analysis</h3>
<ul>
<li><p>Mixed Models can model the correlation structure in the
data</p></li>
<li><p>They can acknowledge that protein expression values from runs
from the same biological repeat are more alike than protein expression
values from runs of different biological repeats.</p></li>
<li><p>Mixed models can also be used when inference between and within
blocks is needed.</p></li>
<li><p>For the francisella example the formula in msqrob2 becomes:
(formula: ~ genotype + (1|biorep)).</p></li>
</ul>
<p><span class="math display">\[ \left\{\begin{array}{rcl}
y_{ir} &amp;=&amp; \beta_0 + \beta_{wt}X_{wt,i} + b_i + \epsilon_{ir}\\
b_i &amp; \sim &amp; N(0,\sigma_b^2)\\
\epsilon_{ir} &amp;\sim&amp; N(0,\sigma_\epsilon^2)
\end{array}\right.\]</span></p>
<div class="sourceCode" id="cb159"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">msqrob</span>(<span class="at">object =</span> pe, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="at">formula =</span> <span class="sc">~</span>genotype <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>biorep), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning: &#39;experiments&#39; dropped; see &#39;drops()&#39;</code></pre>
<div class="sourceCode" id="cb161"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(<span class="st">&quot;genotypeD8 = 0&quot;</span>, <span class="at">parameterNames =</span> <span class="fu">c</span>(<span class="st">&quot;genotypeD8&quot;</span>))</span>
<span id="cb161-2"><a href="#cb161-2" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(<span class="at">object =</span> pe, <span class="at">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="at">contrast =</span> L, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb161-3"><a href="#cb161-3" tabindex="-1"></a></span>
<span id="cb161-4"><a href="#cb161-4" tabindex="-1"></a>volcanoMixed <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb161-5"><a href="#cb161-5" tabindex="-1"></a>    <span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>genotypeD8,</span>
<span id="cb161-6"><a href="#cb161-6" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(pval), <span class="at">color =</span> adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb161-7"><a href="#cb161-7" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb161-8"><a href="#cb161-8" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">cex =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb161-9"><a href="#cb161-9" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">alpha</span>(<span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb161-10"><a href="#cb161-10" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb161-11"><a href="#cb161-11" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">&quot;correct analysis: &quot;</span>,<span class="fu">sum</span>(<span class="fu">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="sc">$</span>genotypeD8<span class="sc">$</span>adjPval <span class="sc">&lt;</span><span class="fl">0.05</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),<span class="st">&quot; DA&quot;</span>))</span>
<span id="cb161-12"><a href="#cb161-12" tabindex="-1"></a>volcanoMixed</span></code></pre></div>
<pre><code>## Warning: Removed 46 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="pda_quantification_inference_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<ul>
<li><p>Note, that the statistical inference with mixed models is still a
bit too liberal because it:</p>
<ul>
<li>hypothesis tests are only valid asymptotically (large number of
biorepeats).</li>
<li>in small samples the between biorepeat variance is sometimes
estimated to be zero due to estimation uncertainty and for these
proteins the model still acts as if all 18 protein expression values are
independent.</li>
</ul></li>
<li><p>Mixed models are also very useful to analyse data from large
labeled experiments <span class="citation">(Vandenbulcke and Clement
2025)</span>.</p></li>
<li><p>But, they are beyond the scope of the lecture series.</p></li>
</ul>
<p>CONSULT BIOSTATISTICIAN IN CASE OF EXPERIMENTS WITH
PSEUDO-REPLICATES, TECHNICAL REPEATS, COMPLEX DESIGNS, …</p>
</div>
</div>
</div>
<div id="software-code" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Software &amp;
code</h1>
<ul>
<li><p>Our R/Bioconductor package <a
href="https://www.bioconductor.org/packages/release/bioc/html/msqrob2.html">msqrob2</a>
can be used in R markdown scripts or with GUI/shinyApps <a
href="https://github.com/statOmics/QFeaturesGUI">QFeaturesGUI</a> (+)
and <a href="https://github.com/statOmics/msqrob2gui">msqrob2gui</a> (+:
forked from the UCLouvain-CBIO lab).</p></li>
<li><p>GUIs are intended as a introduction to the key concepts of
proteomics data analysis for users who have no experience in R.</p></li>
<li><p>However, learning how to code data analyses in R markdown scripts
is key for open en reproducible science and for reporting your
proteomics data analyses and interpretation in a reproducible
way.</p></li>
<li><p>More information on our tools can be found in our papers <span
class="citation">(L. J. Goeminne, Gevaert, and Clement 2016)</span>,
<span class="citation">(L. J. E. Goeminne et al. 2020)</span>, <span
class="citation">(Sticker et al. 2020)</span> and <span
class="citation">(Vandenbulcke and Clement 2025)</span>. Please refer to
our work when using our tools.</p></li>
</ul>
<!--
- Clips on the code on importing the data and preprocessing can be found in [Part I Preprocessing](./pda_quantification_preprocessing.html)

- A clip on the code for modelling and statistical inference with msqrob2 is included below

<iframe width="560" height="315"
src="https://www.youtube.com/embed/eXxIdzGOPgY"
frameborder="0"
style="display: block; margin: auto;"
allow="autoplay; encrypted-media" allowfullscreen></iframe>
-->
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent"
entry-spacing="0">
<div id="ref-goeminne2020" class="csl-entry">
Goeminne, L. J. E., A. Sticker, L. Martens, K. Gevaert, and L. Clement.
2020. <span>“<span
class="nocase"><span>M</span><span>S</span>q<span>R</span>ob
<span>T</span>akes the <span>M</span>issing <span>H</span>urdle:
<span>U</span>niting <span>I</span>ntensity- and
<span>C</span>ount-<span>B</span>ased
<span>P</span>roteomics</span>.”</span> <em>Anal Chem</em> 92 (9):
6278–87.
</div>
<div id="ref-goeminne2016" class="csl-entry">
Goeminne, L. J., K. Gevaert, and L. Clement. 2016. <span>“<span
class="nocase"><span>P</span>eptide-level <span>R</span>obust
<span>R</span>idge <span>R</span>egression <span>I</span>mproves
<span>E</span>stimation, <span>S</span>ensitivity, and
<span>S</span>pecificity in <span>D</span>ata-dependent
<span>Q</span>uantitative <span>L</span>abel-free <span>S</span>hotgun
<span>P</span>roteomics</span>.”</span> <em>Mol Cell Proteomics</em> 15
(2): 657–68.
</div>
<div id="ref-sticker2020" class="csl-entry">
Sticker, A., L. Goeminne, L. Martens, and L. Clement. 2020. <span>“<span
class="nocase"><span>R</span>obust <span>S</span>ummarization and
<span>I</span>nference in <span>P</span>roteome-wide
<span>L</span>abel-free <span>Q</span>uantification</span>.”</span>
<em>Mol Cell Proteomics</em> 19 (7): 1209–19.
</div>
<div id="ref-vandenbulcke2025" class="csl-entry">
Vandenbulcke, C., S. Vanderaa, and L. Clement. 2025. <span>“msqrob2TMT:
Robust Linear Mixed Models for Inferring Differential Signals in Tandem
Mass Tag-Based Proteomics.”</span> <em>Molecular &amp; Cellular
Proteomics</em> 24 (3): e10101–1. <a
href="https://doi.org/10.1016/j.mcpro.2025.00101-X">https://doi.org/10.1016/j.mcpro.2025.00101-X</a>.
</div>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiU3RhdGlzdGljYWwgTWV0aG9kcyBmb3IgUXVhbnRpdGF0aXZlIE1TLWJhc2VkIFByb3Rlb21pY3M6IFBhcnQgSUkuIERpZmZlcmVudGlhbCBBYnVuZGFuY2UgQW5hbHlzaXMiCmF1dGhvcjogIkxpZXZlbiBDbGVtZW50IgpkYXRlOiAiW3N0YXRPbWljc10oaHR0cHM6Ly9zdGF0b21pY3MuZ2l0aHViLmlvKSwgR2hlbnQgVW5pdmVyc2l0eSIKb3V0cHV0OgogICAgaHRtbF9kb2N1bWVudDoKICAgICAgY29kZV9kb3dubG9hZDogdHJ1ZQogICAgICB0aGVtZTogZmxhdGx5CiAgICAgIHRvYzogdHJ1ZQogICAgICB0b2NfZmxvYXQ6IHRydWUKICAgICAgaGlnaGxpZ2h0OiB0YW5nbwogICAgICBudW1iZXJfc2VjdGlvbnM6IHRydWUKICAgIHBkZl9kb2N1bWVudDoKICAgICAgdG9jOiB0cnVlCiAgICAgIG51bWJlcl9zZWN0aW9uczogdHJ1ZQpsaW5rY29sb3I6IGJsdWUKdXJsY29sb3I6IGJsdWUKY2l0ZWNvbG9yOiBibHVlCgpiaWJsaW9ncmFwaHk6IG1zcXJvYjIuYmliCgotLS0KCjxhIHJlbD0ibGljZW5zZSIgaHJlZj0iaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMCI+PGltZyBhbHQ9IkNyZWF0aXZlIENvbW1vbnMgTGljZW5zZSIgc3R5bGU9ImJvcmRlci13aWR0aDowIiBzcmM9Imh0dHBzOi8vaS5jcmVhdGl2ZWNvbW1vbnMub3JnL2wvYnktbmMtc2EvNC4wLzg4eDMxLnBuZyIgLz48L2E+CgpUaGlzIGlzIHBhcnQgb2YgdGhlIG9ubGluZSBjb3Vyc2UgW1Byb3Rlb21pY3MgRGF0YSBBbmFseXNpcyAoUERBKV0oaHR0cHM6Ly9zdGF0b21pY3MuZ2l0aHViLmlvL1BEQS8pCgo8aWZyYW1lIHdpZHRoPSI1NjAiIGhlaWdodD0iMzE1IgpzcmM9Imh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLzFtaGczQkN1RW04IgpmcmFtZWJvcmRlcj0iMCIKc3R5bGU9ImRpc3BsYXk6IGJsb2NrOyBtYXJnaW46IGF1dG87IgphbGxvdz0iYXV0b3BsYXk7IGVuY3J5cHRlZC1tZWRpYSIgYWxsb3dmdWxsc2NyZWVuPjwvaWZyYW1lPgoKLSBbUGxheWxpc3QgUERBIFByZXByb2Nlc3NpbmddKGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9MW1oZzNCQ3VFbTgmbGlzdD1QTFpIMWhQOF9MYkpLcW5QU1M0aHhUa24tdFFvbFNDR2pQKQoKIyBPdXRsaW5lIHstfQoKLSBGcmFuY2lzZWxsYSB0dWxhcmVuc2lzIEV4YW1wbGUKLSBIeXBvdGhlc2lzIHRlc3RpbmcKLSBNdWx0aXBsZSB0ZXN0aW5nCi0gTW9kZXJhdGVkIHN0YXRpc3RpY3MKLSBFeHBlcmltZW50YWwgZGVzaWduCgoKTm90ZSwgdGhhdCB0aGUgUi1jb2RlIGlzIGluY2x1ZGVkIGZvciBsZWFybmVycyB3aG8gYXJlIGFpbWluZyB0byBkZXZlbG9wIFIvbWFya2Rvd24gc2NyaXB0cyB0byBhdXRvbWF0ZSB0aGVpciBxdWFudGl0YXRpdmUgcHJvdGVvbWljcyBkYXRhIGFuYWx5c2VzLgpBY2NvcmRpbmcgdG8gdGhlIHRhcmdldCBhdWRpZW5jZSBvZiB0aGUgY291cnNlIHdlIGVpdGhlciB3b3JrIHdpdGggYSBncmFwaGljYWwgdXNlciBpbnRlcmZhY2UgKEdVSSkgaW4gYSBSL3NoaW55IEFwcCBtc3Fyb2IyZ3VpIChlLmcuIFByb3Rlb21pY3MgQmlvaW5mb3JtYXRpY3MgY291cnNlIG9mIHRoZSBFQkkgYW5kIHRoZSBQcm90ZW9taWNzIERhdGEgQW5hbHlzaXMgY291cnNlIGF0IHRoZSBHdWxiZW5raWFuIGluc3RpdHV0ZSkgb3Igd2l0aCBSL21hcmtkb3ducyBzY3JpcHRzIChlLmcuIEJpb2luZm9ybWF0aWNzIFN1bW1lciBTY2hvb2wgYXQgVUNMb3V2YWluIG9yIHRoZSBTdGF0aXN0aWNhbCBHZW5vbWljcyBDb3Vyc2UgYXQgR2hlbnQgVW5pdmVyc2l0eSkuIAoKLS0tCgojIEZyYW5jaXNlbGxhIHR1bGFyZW5zaXMgZXhwZXJpbWVudAoKPGlmcmFtZSB3aWR0aD0iNTYwIiBoZWlnaHQ9IjMxNSIKc3JjPSJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9UVzVyazF5N2FPYyIKZnJhbWVib3JkZXI9IjAiCnN0eWxlPSJkaXNwbGF5OiBibG9jazsgbWFyZ2luOiBhdXRvOyIKYWxsb3c9ImF1dG9wbGF5OyBlbmNyeXB0ZWQtbWVkaWEiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4KCmBgYHtyIGVjaG89RkFMU0Usb3V0LndpZHRoPSI1MCUifQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiLi9maWd1cmVzL2ZyYW5jaXNlbGxhLmpwZyIpCmBgYAoKYGBge3IgZWNobz1GQUxTRX0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoIi4vZmlndXJlcy90dWxhcmVtaWFfbGVzaW9uLmpwZyIpCmBgYAoKLSBQYXRob2dlbjogY2F1c2VzIHR1bGFyZW1pYQotIE1ldGFib2xpYyBhZGFwdGF0aW9uIGtleSBmb3IgaW50cmFjZWxsdWxhciBsaWZlIGN5Y2xlIG9mIHBhdGhvZ2VuaWMgbWljcm9vcmdhbmlzbXMuIAotIFVwb24gZW50cnkgaW50byBob3N0IGNlbGxzIHF1aWNrIHBoYXNvbWFsIGVzY2FwZSBhbmQgYWN0aXZlIG11bHRpcGxpY2F0aW9uIGluIGN5dG9zb2xpYyBjb21wYXJ0bWVudC4KLSBGcmFuY2lzY2VsbGEgaXMgYXV4b3Ryb3BoIGZvciBzZXZlcmFsIGFtaW5vIGFjaWRzLCBpbmNsdWRpbmcgYXJnaW5pbmUuIAotIEluYWN0aXZhdGlvbiBvZiBhcmdpbmluZSB0cmFuc3BvcnRlciBkZWxheWVkIGJhY3RlcmlhbCBwaGFnb3NvbWFsIGVzY2FwZSBhbmQgaW50cmFjZWxsdWxhciBtdWx0aXBsaWNhdGlvbi4gCi0gRXhwZXJpbWVudCB0byBhc3Nlc3MgZGlmZmVyZW5jZSBpbiBwcm90ZW9tZSB1c2luZyAzIFdUIHZzIDMgQXJnUCBLTyBtdXRhbnRzCgoKIyMgSW1wb3J0IHRoZSBkYXRhIGluIFIgCgo8aWZyYW1lIHdpZHRoPSI1NjAiIGhlaWdodD0iMzE1IgpzcmM9Imh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLzJMamQ5NUlFX0FZIgpmcmFtZWJvcmRlcj0iMCIKc3R5bGU9ImRpc3BsYXk6IGJsb2NrOyBtYXJnaW46IGF1dG87IgphbGxvdz0iYXV0b3BsYXk7IGVuY3J5cHRlZC1tZWRpYSIgYWxsb3dmdWxsc2NyZWVuPjwvaWZyYW1lPgoKCjxkZXRhaWxzPjxzdW1tYXJ5PiBDbGljayB0byBzZWUgY29kZSA8L3N1bW1hcnk+PHA+CjEuIExvYWQgbGlicmFyaWVzIAoKYGBge3IsIHdhcm5pbmc9RkFMU0UsIG1lc3NhZ2U9RkFMU0V9CmxpYnJhcnkodGlkeXZlcnNlKQpsaWJyYXJ5KGxpbW1hKQpsaWJyYXJ5KFFGZWF0dXJlcykKbGlicmFyeShtc3Fyb2IyKQpsaWJyYXJ5KHBsb3RseSkKbGlicmFyeShnZ3Bsb3QyKQpsaWJyYXJ5KGRhdGEudGFibGUpCmBgYAoKMi4gV2UgdXNlIGEgcGVwdGlkZXMudHh0IGZpbGUgZnJvbSBNUy1kYXRhIHF1YW50aWZpZWQgd2l0aCBtYXhxdWFudCB0aGF0IApjb250YWlucyBNUzEgaW50ZW5zaXRpZXMgc3VtbWFyaXplZCBhdCB0aGUgcGVwdGlkZSBsZXZlbC4gCmBgYHtyfQpwZXB0aWRlc1RhYmxlIDwtIGZyZWFkKCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc3RhdE9taWNzL1BEQS9kYXRhL3F1YW50aWZpY2F0aW9uL2ZyYW5jaXNlbGxhL3BlcHRpZGVzLnR4dCIpCmludDY0IDwtIHdoaWNoKHNhcHBseShwZXB0aWRlc1RhYmxlLGNsYXNzKSA9PSAiaW50ZWdlcjY0IikKZm9yIChqIGluIGludDY0KSBwZXB0aWRlc1RhYmxlW1tqXV0gPC0gYXMubnVtZXJpYyhwZXB0aWRlc1RhYmxlW1tqXV0pICAgICAgICAgICAgICAgICAgICAgIApgYGAKCjMuIE1heHF1YW50IHN0b3JlcyB0aGUgaW50ZW5zaXR5IGRhdGEgZm9yIHRoZSBkaWZmZXJlbnQgc2FtcGxlcyBpbiBjb2x1bW5ucyB0aGF0IHN0YXJ0IHdpdGggSW50ZW5zaXR5LiBXZSBjYW4gcmV0cmVpdmUgdGhlIGNvbHVtbiBuYW1lcyB3aXRoIHRoZSBpbnRlbnNpdHkgZGF0YSB3aXRoIHRoZSBjb2RlIGJlbG93OiAKCmBgYHtyfQpxdWFudENvbHMgPC0gZ3JlcCgiSW50ZW5zaXR5ICIsIG5hbWVzKHBlcHRpZGVzVGFibGUpKQpgYGAKCjQuIFJlYWQgdGhlIGRhdGEgYW5kIHN0b3JlIGl0IGluICBRRmVhdHVyZXMgb2JqZWN0IAoKYGBge3J9CnBlIDwtIHJlYWRRRmVhdHVyZXMoCiAgYXNzYXlEYXRhID0gcGVwdGlkZXNUYWJsZSwKICBmbmFtZXMgPSAxLAogIHF1YW50Q29scyA9ICBxdWFudENvbHMsCiAgbmFtZSA9ICJwZXB0aWRlUmF3IikKcm0ocGVwdGlkZXNUYWJsZSkKZ2MoKQpnYygpCmBgYAoKNS4gVXBkYXRlIGRhdGEgd2l0aCBpbmZvcm1hdGlvbiBvbiBkZXNpZ24KCmBgYHtyfQpjb2xEYXRhKHBlKSRnZW5vdHlwZSA8LSBwZVtbMV1dIHw+IAogIGNvbG5hbWVzKCkgfD4gCiAgc3Vic3RyKDEyLDEzKSB8PgogIGFzLmZhY3RvcigpIHw+IAogIHJlbGV2ZWwoIldUIikKCnBlIHw+IGNvbERhdGEoKQpgYGAKCjwvcD48L2RldGFpbHM+CgojIyBQcmVwcm9jZXNzaW5nCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgdG8gbG9nLXRyYW5zZnJvbSB0aGUgZGF0YSA8L3N1bW1hcnk+PHA+CgoxLiBMb2cgdHJhbnNmb3JtCgogIC0gUGVwdGlkZXMgd2l0aCB6ZXJvIGludGVuc2l0aWVzIGFyZSBtaXNzaW5nIHBlcHRpZGVzIGFuZCBzaG91bGQgYmUgcmVwcmVzZW50CndpdGggYSBgTkFgIHZhbHVlIHJhdGhlciB0aGFuIGAwYC4KCmBgYHtyfQpwZSA8LSB6ZXJvSXNOQShwZSwgInBlcHRpZGVSYXciKSAjIGNvbnZlcnQgMCB0byBOQQpgYGAKCiAgLSBMb2d0cmFuc2Zvcm0gZGF0YSB3aXRoIGJhc2UgMgoKYGBge3J9CnBlIDwtIGxvZ1RyYW5zZm9ybShwZSwgYmFzZSA9IDIsIGkgPSAicGVwdGlkZVJhdyIsIG5hbWUgPSAicGVwdGlkZUxvZyIpCmBgYAoKMi4gRmlsdGVyaW5nCgogIC0gV2UgcmVtb3ZlIHBlcHRpZGVzIHRoYXQgY291bGQgbm90IGJlIG1hcHBlZCB0byBhIHByb3RlaW4gb3IgdGhhdCBtYXAgdG8gbXVsdGlwbGUgcHJvdGVpbnMgKHRoZSBwcm90ZWluIGlkZW50aWZpZXIgY29udGFpbnMgbXVsdGlwbGUgaWRlbnRpZmllcnMgc2VwYXJhdGVkIGJ5IGEgYDtgKS4KCmBgYHtyfQpwZSA8LSBmaWx0ZXJGZWF0dXJlcygKICAgIHBlLCB+IFByb3RlaW5zICE9ICIiICYgIyMgUmVtb3ZlIGZhaWxlZCBwcm90ZWluIGluZmVyZW5jZQogICAgICAgICFncmVwbCgiOyIsIFByb3RlaW5zKSkgIyMgUmVtb3ZlIHByb3RlaW4gZ3JvdXBzCmBgYAoKICAtIFJlbW92ZSByZXZlcnNlIHNlcXVlbmNlcyAoZGVjb3lzKSBhbmQgY29udGFtaW5hbnRzLiBOb3RlIHRoYXQgdGhpcyBpcyBpbmRpY2F0ZWQgYnkgdGhlIGNvbHVtbiBuYW1lcyBSZXZlcnNlIGFuZCBkZXBlbmRpbmcgb24gdGhlIHZlcnNpb24gb2YgbWF4UXVhbnQgd2l0aCBQb3RlbnRpYWwuY29udGFtaW5hbnRzIG9yIENvbnRhbWluYW50cy4KCgpgYGB7cn0KcGUgPC0gZmlsdGVyRmVhdHVyZXMocGUsflJldmVyc2UgIT0gIisiKQpwZSA8LSBmaWx0ZXJGZWF0dXJlcyhwZSx+IENvbnRhbWluYW50ICE9ICIrIikKYGBgCgogIC0gRHJvcCBwZXB0aWRlcyB0aGF0IHdlcmUgaWRlbnRpZmllZCBpbiBsZXNzIHRoYW4gdGhyZWUgc2FtcGxlLiBXZSB0b2xlcmF0ZSB0aGUgZm9sbG93aW5nIHByb3BvcnRpb24gb2YgTkFzOiBwTkEgPSAobi0zKS9uLiAKCmBgYHtyfQpuT2JzIDwtIDMKbiA8LSBuY29sKHBlW1sicGVwdGlkZUxvZyJdXSkKcE5BIDwtIChuLW5PYnMpL24KcGUgPC0gZmlsdGVyTkEocGUsIHBOQSA9IHBOQSwgaSA9ICJwZXB0aWRlTG9nIikKbnJvdyhwZVtbInBlcHRpZGVMb2ciXV0pCmBgYAoKV2Uga2VlcCBgciBucm93KHBlW1sicGVwdGlkZUxvZyJdXSlgIHBlcHRpZGVzIHVwb24gZmlsdGVyaW5nLgoKMy4gTm9ybWFsaXphdGlvbiBieSBtZWRpYW4gY2VudGVyaW5nCgpgYGB7cn0KcGUgPC0gbm9ybWFsaXplKHBlLCAKICAgICAgICAgICAgICAgIGkgPSAicGVwdGlkZUxvZyIsIAogICAgICAgICAgICAgICAgbmFtZSA9ICJwZXB0aWRlTm9ybSIsIAogICAgICAgICAgICAgICAgbWV0aG9kID0gImNlbnRlci5tZWRpYW4iKQpgYGAKCgo0LiBTdW1tYXJpemF0aW9uLiBXZSB1c2UgdGhlIHN0YW5kYXJkIHN1bWFyaXNhdGlvbiBpbiBhZ2dyZWdhdGVGZWF0dXJlcywgd2hpY2ggaXMgYQpyb2J1c3Qgc3VtbWFyaXNhdGlvbiBtZXRob2QuCgpgYGB7cix3YXJuaW5nPUZBTFNFfQpwZSA8LSBhZ2dyZWdhdGVGZWF0dXJlcyhwZSwKICAgIGkgPSAicGVwdGlkZU5vcm0iLCAKICAgIGZjb2wgPSAiUHJvdGVpbnMiLCAKICAgIG5hLnJtID0gVFJVRSwKICAgIG5hbWUgPSAicHJvdGVpbiIpCmBgYAoKNS4gRmlsdGVyIHByb3RlaW5zIHRoYXQgY29udGFpbiBtYW55IG1pc3NpbmcgdmFsdWVzIAoKV2Ugd2FudCB0byBoYXZlIGF0IGxlYXN0IDQgb2JzZXJ2ZWQgcHJvdGVpbnMgc28gdGhhdCBtb3N0IHByb3RlaW5zIGhhdmUgYXQgbGVhc3QgMiBvYnNlcnZhdGlvbnMgaW4gZWFjaCBncm91cC4gIApTbyB3ZSB0b2xlcmF0ZSBhIHByb3BvcnRpb24gb2YgKG4tNCkvbiBOQXMuIAoKCmBgYHtyfQpuT2JzIDwtIDQKbiA8LSBuY29sKHBlW1sicHJvdGVpbiJdXSkKcE5BIDwtIChuLW5PYnMpL24KcGUgPC0gZmlsdGVyTkEocGUsIHBOQSA9IHBOQSwgaSA9ICJwcm90ZWluIikKYGBgCgpQbG90IG9mIHByZXByb2Nlc3NlZCBkYXRhIAoKYGBge3J9CnBlW1sicGVwdGlkZU5vcm0iXV0gfD4gCiAgYXNzYXkoKSB8PgogIGFzLmRhdGEuZnJhbWUoKSB8PgogIGdhdGhlcihzYW1wbGUsIGludGVuc2l0eSkgfD4gCiAgbXV0YXRlKGdlbm90eXBlID0gY29sRGF0YShwZSlbc2FtcGxlLCJnZW5vdHlwZSJdKSB8PgogIGdncGxvdChhZXMoeCA9IGludGVuc2l0eSxncm91cCA9IHNhbXBsZSxjb2xvciA9IGdlbm90eXBlKSkgKyAKICAgIGdlb21fZGVuc2l0eSgpICsKICAgIGdndGl0bGUoIlBlcHRpZGUtbGV2ZWwiKQoKcGVbWyJwcm90ZWluIl1dIHw+IAogIGFzc2F5KCkgfD4KICBhcy5kYXRhLmZyYW1lKCkgfD4KICBnYXRoZXIoc2FtcGxlLCBpbnRlbnNpdHkpIHw+IAogIG11dGF0ZShnZW5vdHlwZSA9IGNvbERhdGEocGUpW3NhbXBsZSwiZ2Vub3R5cGUiXSkgfD4KICBnZ3Bsb3QoYWVzKHggPSBpbnRlbnNpdHksZ3JvdXAgPSBzYW1wbGUsY29sb3IgPSBnZW5vdHlwZSkpICsgCiAgICBnZW9tX2RlbnNpdHkoKSArCiAgICBnZ3RpdGxlKCJQcm90ZWluLWxldmVsIikKYGBgCjwvcD48L2RldGFpbHM+CgojIyBTdW1tYXJpemVkIGRhdGEgc3RydWN0dXJlCgojIyMgRGVzaWduCgpgYGB7cn0KcGUgfD4gCiAgY29sRGF0YSgpIHw+IAogIGtuaXRyOjprYWJsZSgpCmBgYAoKLSBXVCB2cyBLTyAKLSAzIHZzIDMgcmVwZWF0cyAKCiMjIyBTdW1tYXJpemVkIGludGVuc2l0eSBtYXRyaXgKCmBgYHtyfQpwZVtbInByb3RlaW4iXV0gfD4gCiAgYXNzYXkoKSB8PiAKICBoZWFkKCkgfD4gCiAga25pdHI6OmthYmxlKCkKYGBgCgotIGByIG5yb3cocGVbWyJwcm90ZWluIl1dKWAgcHJvdGVpbnMgCgojIyMgSHlwb3RoZXNpcyB0ZXN0aW5nOiBhIHNpbmdsZSBwcm90ZWluIAoKPGlmcmFtZSB3aWR0aD0iNTYwIiBoZWlnaHQ9IjMxNSIKc3JjPSJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9teVA2U1VsU3dzTSIKZnJhbWVib3JkZXI9IjAiCnN0eWxlPSJkaXNwbGF5OiBibG9jazsgbWFyZ2luOiBhdXRvOyIKYWxsb3c9ImF1dG9wbGF5OyBlbmNyeXB0ZWQtbWVkaWEiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4KCmBgYHtyIGVjaG89RkFMU0V9CmlmICgicGkiJWluJWxzKCkpIHJtKCJwaSIpCmtvcHZvZXRlcjwtZnVuY3Rpb24oeCx5LGFuZ2xlPTAsbD0uMixjZXguZG90PS41LHBjaD0xOSxjb2w9ImJsYWNrIikKewphbmdsZT1hbmdsZS8xODAqcGkKcG9pbnRzKHgseSxjZXg9Y2V4LmRvdCxwY2g9cGNoLGNvbD1jb2wpCmxpbmVzKGMoeCx4K2wqY29zKC1waS8yK2FuZ2xlKSksYyh5LHkrbCpzaW4oLXBpLzIrYW5nbGUpKSxjb2w9Y29sKQpsaW5lcyhjKHgrbC8yKmNvcygtcGkvMithbmdsZSkseCtsLzIqY29zKC1waS8yK2FuZ2xlKStsLzQqY29zKGFuZ2xlKSksYyh5K2wvMipzaW4oLXBpLzIrYW5nbGUpLHkrbC8yKnNpbigtcGkvMithbmdsZSkrbC80KnNpbihhbmdsZSkpLGNvbD1jb2wpCmxpbmVzKGMoeCtsLzIqY29zKC1waS8yK2FuZ2xlKSx4K2wvMipjb3MoLXBpLzIrYW5nbGUpK2wvNCpjb3MocGkrYW5nbGUpKSxjKHkrbC8yKnNpbigtcGkvMithbmdsZSkseStsLzIqc2luKC1waS8yK2FuZ2xlKStsLzQqc2luKHBpK2FuZ2xlKSksY29sPWNvbCkKbGluZXMoYyh4K2wqY29zKC1waS8yK2FuZ2xlKSx4K2wqY29zKC1waS8yK2FuZ2xlKStsLzIqY29zKC1waS8yK3BpLzQrYW5nbGUpKSxjKHkrbCpzaW4oLXBpLzIrYW5nbGUpLHkrbCpzaW4oLXBpLzIrYW5nbGUpK2wvMipzaW4oLXBpLzIrcGkvNCthbmdsZSkpLGNvbD1jb2wpCmxpbmVzKGMoeCtsKmNvcygtcGkvMithbmdsZSkseCtsKmNvcygtcGkvMithbmdsZSkrbC8yKmNvcygtcGkvMi1waS80K2FuZ2xlKSksYyh5K2wqc2luKC1waS8yK2FuZ2xlKSx5K2wqc2luKC1waS8yK2FuZ2xlKStsLzIqc2luKC1waS8yLXBpLzQrYW5nbGUpKSxjb2w9Y29sKQp9CgpwYXIobWFyPWMoMCwwLDAsMCksbWFpPWMoMCwwLDAsMCkpCnBsb3QoMCwwLHhsYWI9IiIseWxhYj0iIix4bGltPWMoMCwxMCkseWxpbT1jKDAsMTApLGNvbD0wLHhheHQ9Im5vbmUiLHlheHQ9Im5vbmUiLGF4ZXM9RkFMU0UpCnJlY3QoMCw2LDEwLDEwLGJvcmRlcj0icmVkIixsd2Q9MikKdGV4dCguNSw4LCJwb3B1bGF0aW9uIixzcnQ9OTAsY29sPSJyZWQiLGNleD0yKQpzeW1ib2xzICgzLCA4LCBjaXJjbGVzPTEuMiwgY29sPSJyZWQiLGFkZD1UUlVFLGZnPSJyZWQiLGluY2hlcz1GQUxTRSxsd2Q9MikKc2V0LnNlZWQoMzMwKQpncmlkPXNlcSgwLDEsLjAxKQoKZm9yIChpIGluIDE6NTApCnsKCWFuZ2xlMT1ydW5pZihuPTEsbWluPTAsbWF4PTM2MCkKCWFuZ2xlMj1ydW5pZihuPTEsbWluPTAsbWF4PTM2MCkKCXJhZGl1cz1zYW1wbGUoZ3JpZCxwcm9iPWdyaWReMipwaS9zdW0oZ3JpZF4yKnBpKSxzaXplPTEpCglrb3B2b2V0ZXIoMytyYWRpdXMqY29zKGFuZ2xlMS8xODAqcGkpLDgrcmFkaXVzKnNpbihhbmdsZTEvMTgwKnBpKSxhbmdsZT1hbmdsZTIpCn0KdGV4dCg3LjUsOCwiRWZmZWN0IG9mIGFyZ2luaW5lIGRlZi4gaW4gcG9wdWxhdGlvbiIsY29sPSJyZWQiLGNleD0xLjIpCgpyZWN0KDAsMCwxMCw0LGJvcmRlcj0iYmx1ZSIsbHdkPTIpCnRleHQoLjUsMiwic2FtcGxlIixzcnQ9OTAsY29sPSJibHVlIixjZXg9MikKc3ltYm9scyAoMywgMiwgY2lyY2xlcz0xLjIsIGNvbD0icmVkIixhZGQ9VFJVRSxmZz0iYmx1ZSIsaW5jaGVzPUZBTFNFLGx3ZD0yKQpmb3IgKGkgaW4gMDoxKQoJZm9yIChqIGluIDA6MikKewoKCWtvcHZvZXRlcigyLjUraiooMy45LTIuMSkvNCwxLjUraSkKfQp0ZXh0KDcuNSwyLCJFZmZlY3Qgb2YgYXJnaW5pbmUgZGVmLiBpbiBzYW1wbGUiLGNvbD0iYmx1ZSIsY2V4PTEuMikKCmFycm93cygzLDUuOSwzLDQuMSxjb2w9ImJsYWNrIixsd2Q9MykKYXJyb3dzKDcsNC4xLDcsNS45LGNvbD0iYmxhY2siLGx3ZD0zKQp0ZXh0KDEuNSw1LCJFeHAuIERlc2lnbiIsY29sPSJibGFjayIsY2V4PTEuMikKdGV4dCg4LjUsNSwiRXN0aW1hdGlvbiBcbiBJbmZlcmVuY2UgIixjb2w9ImJsYWNrIixjZXg9MS4yKQp0ZXh0KDcuNSwuNSwiRGF0YSBleHBsb3JhdGlvbiIsY29sPSJibGFjayIsY2V4PTEuMikKYGBgCgojIyMjIFQtdGVzdAoKPGlmcmFtZSB3aWR0aD0iNTYwIiBoZWlnaHQ9IjMxNSIKc3JjPSJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9jVnc1a2RTUlpDRSIKZnJhbWVib3JkZXI9IjAiCnN0eWxlPSJkaXNwbGF5OiBibG9jazsgbWFyZ2luOiBhdXRvOyIKYWxsb3c9ImF1dG9wbGF5OyBlbmNyeXB0ZWQtbWVkaWEiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4KCgokJAogXGxvZ18yIFx0ZXh0e0ZDfSA9IFxiYXJ7eX1fe3AxfS1cYmFye3l9X3twMn0KJCQKCiQkClRfZz1cZnJhY3tcbG9nXzIgXHRleHR7RkN9fXtcdGV4dHtzZX1fe1xsb2dfMiBcdGV4dHtGQ319fQokJAoKJCQKVF9nPVxmcmFje1x3aWRlaGF0e1x0ZXh0e3NpZ25hbH19fXtcd2lkZWhhdHtcdGV4dHtOb2lzZX19fQokJAoKSWYgd2UgY2FuIGFzc3VtZSBlcXVhbCB2YXJpYW5jZSBpbiBib3RoIHRyZWF0bWVudCBncm91cHM6CgokJApcdGV4dHtzZX1fe1xsb2dfMiBcdGV4dHtGQ319PVx0ZXh0e1NEfVxzcXJ0e1xmcmFjezF9e25fMX0rXGZyYWN7MX17bl8yfX0KJCQKCmBgYHtyfQpXUF8wMDMwMjMzOTIgPC0gZGF0YS5mcmFtZSgKICAgIGludGVuc2l0eSA9IGFzc2F5KHBlW1sicHJvdGVpbiJdXVsiV1BfMDAzMDIzMzkyIixdKSB8PiAKICAgICAgYygpLCAKICAgIGdlbm90eXBlID0gY29sRGF0YShwZSlbLDFdKSAKCldQXzAwMzAyMzM5MiB8PiAKICBnZ3Bsb3QoYWVzKHg9Z2Vub3R5cGUseT1pbnRlbnNpdHkpKSArIAogIGdlb21fcG9pbnQoKSArCiAgZ2d0aXRsZSgiUHJvdGVpbiBXUF8wMDMwMjMzOTIiKQpgYGAKCmBgYHtyIGVjaG89RkFMU0V9CmxtSGxwIDwtIGxtKGludGVuc2l0eSB+IGdlbm90eXBlLCBkYXRhID0gV1BfMDAzMDIzMzkyKQpgYGAKCiQkCnQ9XGZyYWN7XGxvZ18yXHdpZGVoYXR7XHRleHR7RkN9fX17XHRleHR7c2V9X3tcbG9nXzJcd2lkZWhhdHtcdGV4dHtGQ319fX09XGZyYWN7YHIgZm9ybWF0KHN1bW1hcnkobG1IbHApJGNvZWZbMiwxXSwgZGlnaXQgPSAzKWB9e2ByIGZvcm1hdChzdW1tYXJ5KGxtSGxwKSRjb2VmWzIsMl0sIGRpZ2l0ID0gMylgfT1gciBmb3JtYXQoc3VtbWFyeShsbUhscCkkY29lZlsyLDNdLCBkaWdpdCA9IDMpYAokJAoKLSBJcyB0ID0gYHIgZm9ybWF0KHN1bW1hcnkobG1IbHApJGNvZWZbMiwzXSwgZGlnaXQgPSAzKWAgaW5kaWNhdGluZyB0aGF0CnRoZXJlIGlzIGFuIGVmZmVjdD8KCi0gSG93IGxpa2VseSBpcyBpdCB0byBvYnNlcnZlCnQgPSBgciBmb3JtYXQoc3VtbWFyeShsbUhscCkkY29lZlsyLDNdLCBkaWdpdCA9IDMpYCB3aGVuIHRoZXJlIGlzIG5vIGVmZmVjdCBvZiB0aGUgYXJnUCBLTyBvbiB0aGUgcHJvdGVpbiBleHByZXNzaW9uPwoKIyMjIyBOdWxsIGh5cG90aGVzaXMgKCRIXzAkKSBhbmQgYWx0ZXJuYXRpdmUgaHlwb3RoZXNpcyAoJEhfMSQpCgotIFdpdGggZGF0YSB3ZSBjYW4gbmV2ZXIgcHJvdmUgYSBoeXBvdGhlc2lzIChmYWxzaWZpY2F0aW9uIHByaW5jaXBsZSBvZiBQb3BwZXIpCi0gV2l0aCBkYXRhIHdlIGNhbiBvbmx5IHJlamVjdCBhIGh5cG90aGVzaXMgCgotIEluIGdlbmVyYWwgd2Ugc3RhcnQgZnJvbSAqYWx0ZXJuYXRpdmUgaHlwb3RoZXNlKiAkSF8xJDogd2Ugd2FudCB0byBzaG93IGFuIGVmZmVjdCBvZiB0aGUgS08gb24gYSBwcm90ZWluCgo8Y2VudGVyPgokSF8xJDogT24gYXZlcmFnZSB0aGUgcHJvdGVpbiBhYnVuZGFuY2UgaW4gV1QgaXMgZGlmZmVyZW50IGZyb20gdGhhdCBpbiBLTwo8L2NlbnRlcj4KCi0gQnV0LCB3ZSB3aWxsIGFzc2VzcyB0aGlzIGJ5IGZhbHNpZnlpbmcgdGhlIG9wcG9zaXRlOiAKPGNlbnRlcj4KJEhfMCQ6IE9uIGF2ZXJhZ2UgdGhlIHByb3RlaW4gYWJ1bmRhbmNlIGluIFdUIGlzIGVxdWFsIHRvIHRoYXQgaW4gS088LQo8L2NlbnRlcj4KCgpgYGB7cn0KdC50ZXN0KGludGVuc2l0eSB+IGdlbm90eXBlLCBkYXRhID0gV1BfMDAzMDIzMzkyLCB2YXIuZXF1YWw9VFJVRSkKYGBgCgotIEhvdyBsaWtlbHkgaXMgaXQgdG8gb2JzZXJ2ZSBhbiBlcXVhbCBvciBtb3JlIGV4dHJlbWUgZWZmZWN0IHRoYW4gdGhlIG9uZSBvYnNlcnZlZCBpbiB0aGUgc2FtcGxlIHdoZW4gdGhlIG51bGwgaHlwb3RoZXNpcyBpcyB0cnVlPwotIFdoZW4gd2UgbWFrZSBhc3N1bXB0aW9ucyBhYm91dCB0aGUgZGlzdHJpYnV0aW9uIG9mIG91ciB0ZXN0IHN0YXRpc3RpYyB3ZSBjYW4gcXVhbnRpZnkgdGhpcyBwcm9iYWJpbGl0eTogKnAtdmFsdWUqLiAKVGhlIHAtdmFsdWUgd2lsbCBvbmx5IGJlIGNhbGN1bGF0ZWQgY29ycmVjdGx5IGlmIHRoZSB1bmRlcmx5aW5nIGFzc3VtcHRpb25zIGhvbGQhCi0gV2hlbiB3ZSByZXBlYXQgdGhlIGV4cGVyaW1lbnQsIHRoZSBwcm9iYWJpbGl0eSB0byBvYnNlcnZlIGEgZm9sZCBjaGFuZ2UgZm9yIHRoaXMgZ2VuZSB0aGF0IGlzIG1vcmUgZXh0cmVtZSB0aGFuIGEgYHIgZm9ybWF0KDJeYWJzKGxtSGxwJGNvZWZbMl0pLGRpZ2l0cz0zKWAgZm9sZCAoJFxsb2dfMiBGQz1gciBmb3JtYXQobG1IbHAkY29lZlsyXSxkaWdpdHM9MylgJCkgZG93biBvciB1cCByZWd1bGF0aW9uIGJ5IHJhbmRvbSBjaGFuZ2UgKGlmICRIXzAkIGlzIHRydWUpIGlzIGByIHJvdW5kKHN1bW1hcnkobG1IbHApJGNvZWZbMiw0XSoxZTYsMClgIG91dCBvZiAxIDAwMCAwMDAuICAKLSBJZiB0aGUgcC12YWx1ZSBpcyBiZWxvdyBhIHNpZ25pZmljYW5jZSB0aHJlc2hvbGQgJFxhbHBoYSQgd2UgcmVqZWN0IHRoZSBudWxsIGh5cG90aGVzaXMuICpXZSBjb250cm9sIHRoZSBwcm9iYWJpbGl0eSBvbiBhIGZhbHNlIHBvc2l0aXZlIHJlc3VsdCBhdCB0aGUgJFxhbHBoYSQtbGV2ZWwgKHR5cGUgSSBlcnJvcikqCgotIE5vdGUsIHRoYXQgdGhlIHAtdmFsdWVzIGFyZSB1bmlmb3JtIHVuZGVyIHRoZSBudWxsIGh5cG90aGVzaXMsIGkuZS4gd2hlbiAkSF8wJCBpcyB0cnVlIGFsbCBwLXZhbHVlcyBhcmUgZXF1YWxseSBsaWtlbHkuIAoKIyMgTXVsdGlwbGUgaHlwb3RoZXNpcyB0ZXN0aW5nCgo8aWZyYW1lIHdpZHRoPSI1NjAiIGhlaWdodD0iMzE1IgpzcmM9Imh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL2NMbi1DRnlBNnBzIgpmcmFtZWJvcmRlcj0iMCIKc3R5bGU9ImRpc3BsYXk6IGJsb2NrOyBtYXJnaW46IGF1dG87IgphbGxvdz0iYXV0b3BsYXk7IGVuY3J5cHRlZC1tZWRpYSIgYWxsb3dmdWxsc2NyZWVuPjwvaWZyYW1lPgoKLSBDb25zaWRlciB0ZXN0aW5nIERBIGZvciBhbGwgJG09MTA2NiQgcHJvdGVpbnMgc2ltdWx0YW5lb3VzbHkKLSBXaGF0IGlmIHdlIGFzc2VzcyBlYWNoIGluZGl2aWR1YWwgdGVzdCBhdCBsZXZlbCAkXGFscGhhJD8KJFxyaWdodGFycm93JCBQcm9iYWJpbGl0eSB0byBoYXZlIGEgZmFsc2UgcG9zaXRpdmUgKEZQKSBhbW9uZyBhbGwgbSBzaW11bHRhdGVub3VzCnRlc3QgJD4+PiAgXGFscGhhPSAwLjA1JAoKLSBJbmRlZWQgZm9yIGVhY2ggbm9uIERBIHByb3RlaW4gd2UgaGF2ZSBhIHByb2JhYmlsaXR5IG9mIDUlIHRvIHJldHVybiBhIEZQLgotIEluIGEgdHlwaWNhbCBleHBlcmltZW50IHRoZSBtYWpvcml0eSBvZiB0aGUgcHJvdGVpbnMgYXJlIG5vbiBEQS4gCi0gU28gYW4gdXBwZXJib3VuZCBvZiB0aGUgZXhwZWN0ZWQgRlAgaXMgJG0gXHRpbWVzIFxhbHBoYSQgb3IgJDEwNjYgXHRpbWVzIDAuMDU9YHIgcm91bmQoMTA2NiowLjA1LDApYCQuIAoKJFxyaWdodGFycm93JCBIZW5jZSwgd2UgYXJlIGJvdW5kIHRvIGNhbGwgbWFueSBmYWxzZSBwb3NpdGl2ZSBwcm90ZWlucyBlYWNoIHRpbWUgd2UgcnVuIHRoZSBleHBlcmltZW50LgoKIyMjIE11bHRpcGxlIHRlc3RpbmcKCiMjIyMgRmFtaWx5LXdpc2UgZXJyb3IgcmF0ZQoKPGlmcmFtZSB3aWR0aD0iNTYwIiBoZWlnaHQ9IjMxNSIKc3JjPSJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9JTF9lVVN5UkRSQSIKZnJhbWVib3JkZXI9IjAiCnN0eWxlPSJkaXNwbGF5OiBibG9jazsgbWFyZ2luOiBhdXRvOyIKYWxsb3c9ImF1dG9wbGF5OyBlbmNyeXB0ZWQtbWVkaWEiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4KClRoZSBmYW1pbHktd2lzZSBlcnJvciByYXRlIChGV0VSKSBhZGRyZXNzZXMgdGhlIG11bHRpcGxlIHRlc3RpbmcgaXNzdWUgYnkgbm8gbG9uZ2VyIGNvbnRyb2xsaW5nIHRoZSBpbmRpdmlkdWFsIHR5cGUgSSBlcnJvciBmb3IgZWFjaCBwcm90ZWluLCBpbnN0ZWFkIGl0IGNvbnRyb2xzOiAgCgpcWwogICBcdGV4dHtGV0VSfSA9IAogICBcdGV4dHtQfVxsZWZ0W0ZQIFxnZXEgMSBccmlnaHRdLgpcXQoKVGhlIEJvbmZlcnJvbmkgbWV0aG9kIGlzIHdpZGVseSB1c2VkIHRvIGNvbnRyb2wgdGhlIHR5cGUgSSBlcnJvcjogCgotIGFzc2VzcyBlYWNoIHRlc3QgYXQgClxbXGFscGhhX1x0ZXh0e2Fkan09XGZyYWN7XGFscGhhfXttfVxdCi0gb3IgdXNlIGFkanVzdGVkIHAtdmFsdWVzIGFuZCBjb21wYXJlIHRoZW0gdG8gJFxhbHBoYSQ6IApcW3BfXHRleHR7YWRqfT1cdGV4dHttaW59XGxlZnQocCBcdGltZXMgbSwxXHJpZ2h0KVxdCgpQcm9ibGVtLCB0aGUgbWV0aG9kIGlzIHZlcnkgY29uc2VydmF0aXZlISAKCiMjIyMgRmFsc2UgZGlzY292ZXJ5IHJhdGUKCjxpZnJhbWUgd2lkdGg9IjU2MCIgaGVpZ2h0PSIzMTUiCnNyYz0iaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvZW52RHF2RXdSY2MiCmZyYW1lYm9yZGVyPSIwIgpzdHlsZT0iZGlzcGxheTogYmxvY2s7IG1hcmdpbjogYXV0bzsiCmFsbG93PSJhdXRvcGxheTsgZW5jcnlwdGVkLW1lZGlhIiBhbGxvd2Z1bGxzY3JlZW4+PC9pZnJhbWU+CgotIEZEUjogRXhwZWN0ZWQgcHJvcG9ydGlvbiBvZiBmYWxzZSBwb3NpdGl2ZXMgb24gdGhlIHRvdGFsIG51bWJlciBvZiBwb3NpdGl2ZXMgeW91IHJldHVybi4KLSBBbiBGRFIgb2YgMSUgbWVhbnMgdGhhdCBvbiBhdmVyYWdlIHdlIGV4cGVjdCAxJSBmYWxzZSBwb3NpdGl2ZSBwcm90ZWlucyBpbiB0aGUgbGlzdCBvZiBwcm90ZWlucyB0aGF0IGFyZSBjYWxsZWQgc2lnbmlmaWNhbnQuCi0gRGVmaW5lZCBieSBCZW5qYW1pbmkgYW5kIEhvY2hiZXJnIGluIHRoZWlyIHNlbWluYWwgcGFwZXIgQmVuamFtaW5pLCBZLiBhbmQgSG9jaGJlcmcsIFkuICgxOTk1KS4gIkNvbnRyb2xsaW5nIHRoZSBmYWxzZSBkaXNjb3ZlcnkgcmF0ZTogYSBwcmFjdGljYWwgYW5kIHBvd2VyZnVsIGFwcHJvYWNoIHRvIG11bHRpcGxlIHRlc3RpbmciLiBKb3VybmFsIG9mIHRoZSBSb3lhbCBTdGF0aXN0aWNhbCBTb2NpZXR5IFNlcmllcyBCLCA1NyAoMSk6IDI4OeKAkzMwMC4gCgpUaGUgKipGYWxzZSBEaXNjb3ZlcnkgUHJvcG9ydGlvbiAoRkRQKSoqIGlzIHRoZSBmcmFjdGlvbiBvZiBmYWxzZSBwb3NpdGl2ZXMgdGhhdCBhcmUgcmV0dXJuZWQsIGkuZS4gCgpcWwpGRFAgPSBcZnJhY3tGUH17Un0KXF0KCi0gSG93ZXZlciwgdGhpcyBxdWFudGl0eSBjYW5ub3QgYmUgb2JzZXJ2ZWQgYmVjYXVzZSBpbiBwcmFjdGljZSB3ZSBvbmx5IGtub3cgdGhlIG51bWJlciBvZiBwcm90ZWlucyBmb3Igd2hpY2ggd2UgcmVqZWN0ZWQgJEhfMCQsICRSJC4gCi0gQnV0LCB3ZSBkbyBub3Qga25vdyB0aGUgbnVtYmVyIG9mIGZhbHNlIHBvc2l0aXZlcywgJEZQJC4KClRoZXJlZm9yZSwgQmVuamFtaW5pIGFuZCBIb2NoYmVyZywgMTk5NSwgZGVmaW5lZCBUaGUgKipGYWxzZSBEaXNjb3ZlcnkgUmF0ZSAoRkRSKSoqIGFzClxbCiAgIFx0ZXh0e0ZEUn0gPSBcdGV4dHtFfVxsZWZ0W1xmcmFje0ZQfXtSfVxyaWdodF0gPVx0ZXh0e0V9XGxlZnRbXHRleHR7RkRQfVxyaWdodF0KXF0KdGhlIGV4cGVjdGVkIEZEUC4gCgotIENvbnRyb2xsaW5nIHRoZSBGRFIgYWxsb3dzIGZvciBtb3JlIGRpc2NvdmVyaWVzIChpLmUuIGxvbmdlciBsaXN0cyB3aXRoIHNpZ25pZmljYW50IHJlc3VsdHMpLCB3aGlsZSB0aGUgZnJhY3Rpb24gb2YgZmFsc2UgZGlzY292ZXJpZXMgYW1vbmcgdGhlIHNpZ25pZmljYW50IHJlc3VsdHMgaW4gd2VsbCBjb250cm9sbGVkIG9uIGF2ZXJhZ2UuIEFzIGEgY29uc2VxdWVuY2UsIG1vcmUgb2YgdGhlIHRydWUgcG9zaXRpdmUgaHlwb3RoZXNlcyB3aWxsIGJlIGRldGVjdGVkLgoKCiMjIyMgSW50dWl0aW9uIG9mIEJILUZEUiBwcm9jZWR1cmUKCkNvbnNpZGVyICRtID0gMTAwMCQgdGVzdHMKCi0gU3VwcG9zZSB0aGF0IGEgcmVzZWFyY2hlciByZWplY3RzIGFsbCBudWxsIGh5cG90aGVzZXMgZm9yIHdoaWNoICRwIDwgMC4wMSQuIAoKLSBJZiB3ZSB1c2UgJHAgPCAwLjAxJCwgd2UgZXhwZWN0ICQwLjAxIFx0aW1lcyBtXzAkIHRlc3RzIHRvIHJldHVybiBmYWxzZSBwb3NpdGl2ZXMuIAotIEEgY29uc2VydmF0aXZlIGVzdGltYXRlIG9mIHRoZSBudW1iZXIgb2YgZmFsc2UgcG9zaXRpdmVzIHRoYXQgd2UgY2FuIGV4cGVjdCBjYW4gYmUgb2J0YWluZWQgYnkgY29uc2lkZXJpbmcgdGhhdCB0aGUgbnVsbCBoeXBvdGhlc2VzIGFyZSB0cnVlIGZvciBhbGwgZmVhdHVyZXMsICRtXzAgPSBtID0gIDEwMDAkLiAKLSBXZSB0aGVuIHdvdWxkIGV4cGVjdCAkMC4wMSBcdGltZXMgMTAwMCA9IDEwJCBmYWxzZSBwb3NpdGl2ZXMgKCRGUD0xMCQpLgoKLSBTdXBwb3NlIHRoYXQgdGhlIHJlc2VhcmNoZXIgZm91bmQgMjAwIGdlbmVzIHdpdGggJHA8MC4wMSQgKCRSPTIwMCQpLgoKLSBUaGUgcHJvcG9ydGlvbiBvZiBmYWxzZSBwb3NpdGl2ZSByZXN1bHRzIChGRFAgPSBmYWxzZSBwb3NpdGl2ZSBwcm9wb3J0aW9uKSBhbW9uZyB0aGUgbGlzdCBvZiAkUj0yMDAkIGdlbmVzIGNhbiB0aGVuIGJlIGVzdGltYXRlZCBhcwogXFsKICAgXHdpZGVoYXR7XHRleHR7RkRQfX09XGZyYWN7RlB9e1J9PVxmcmFjezEwfXsyMDB9PVxmcmFjezAuMDEgXHRpbWVzIDEwMDB9ezIwMH0gPSAwLjA1LgogXF0KCgojIyMjIEJlbmphbWluaSBhbmQgSG9jaGJlcmcgKDE5OTUpIHByb2NlZHVyZSBmb3IgY29udHJvbGxpbmcgdGhlIEZEUiBhdCAkXGFscGhhJAoKMS4gTGV0ICRwX3soMSl9XGxlcSBcbGRvdHMgXGxlcSBwX3sobSl9JCBkZW5vdGUgdGhlIG9yZGVyZWQgJHAkLXZhbHVlcy4KCjIuIEZpbmQgdGhlIGxhcmdlc3QgaW50ZWdlciAkayQgc28gdGhhdCAKJCQKXGZyYWN7cF97KGspfSBcdGltZXMgbX17a30gXGxlcSBcYWxwaGEKJCQKJCRcdGV4dHtvcn0kJAokJApwX3soayl9IFxsZXEgayBcdGltZXMgXGFscGhhL20KJCQKCjMuIElmIHN1Y2ggYSAkayQgZXhpc3RzLCByZWplY3QgdGhlICRrJCBudWxsIGh5cG90aGVzZXMgYXNzb2NpYXRlZCB3aXRoICRwX3soMSl9LCBcbGRvdHMsIHBfeyhrKX0kLgpPdGhlcndpc2Ugbm9uZSBvZiB0aGUgbnVsbCBoeXBvdGhlc2VzIGlzIHJlamVjdGVkLgoKVGhlIGFkanVzdGVkICRwJC12YWx1ZSAoYWxzbyBrbm93biBhcyB0aGUgJHEkLXZhbHVlIGluIEZEUiBsaXRlcmF0dXJlKToKICQkCiAgIHFfeyhpKX09XHRpbGRle3B9X3soaSl9ID0gXG1pblxsZWZ0W1xtaW5fe2o9aSxcbGRvdHMsIG19XGxlZnQobSBwX3soail9L2pccmlnaHQpLCAxIFxyaWdodF0uCiAkJAogSW4gdGhlIGh5cG90aGV0aWNhbCBleGFtcGxlIGFib3ZlOiAkaz0yMDAkLCAkcF97KGspfT0wLjAxJCwgJG09MTAwMCQgYW5kICRcYWxwaGE9MC4wNSQuCgojIyMjIEZyYW5jaXNlbGxhIEV4YW1wbGUKCjxpZnJhbWUgd2lkdGg9IjU2MCIgaGVpZ2h0PSIzMTUiCnNyYz0iaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvQjNCbW5PTGtZZzQiCmZyYW1lYm9yZGVyPSIwIgpzdHlsZT0iZGlzcGxheTogYmxvY2s7IG1hcmdpbjogYXV0bzsiCmFsbG93PSJhdXRvcGxheTsgZW5jcnlwdGVkLW1lZGlhIiBhbGxvd2Z1bGxzY3JlZW4+PC9pZnJhbWU+Cgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgPC9zdW1tYXJ5PjxwPgpgYGB7cn0KdHRlc3RNeCA8LSBmdW5jdGlvbih5LGdyb3VwKSB7CiAgICB0ZXN0IDwtIHRyeSh0LnRlc3QoeVtncm91cF0seVshZ3JvdXBdLHZhci5lcXVhbD1UUlVFKSxzaWxlbnQ9VFJVRSkKICAgIGlmKGlzKHRlc3QsInRyeS1lcnJvciIpKSB7CiAgICAgIHJldHVybihjKGxvZzJGQz1OQSxzZT1OQSx0c3RhdD1OQSxwPU5BKSkKICAgICAgfSBlbHNlIHsKICAgICAgcmV0dXJuKGMobG9nMkZDPSAodGVzdCRlc3RpbWF0ZSUqJWMoMSwtMSkpLHNlPXRlc3Qkc3RkZXJyLHRzdGF0PXRlc3Qkc3RhdGlzdGljLHB2YWw9dGVzdCRwLnZhbHVlKSkKICAgICAgfQogfQogCiByZXMgPC0gYXBwbHkoCiAgICBhc3NheShwZVtbInByb3RlaW4iXV0pLCAKICAgIDEsIAogICAgdHRlc3RNeCwKICAgIGdyb3VwID0gY29sRGF0YShwZSkkZ2Vub3R5cGU9PSJEOCIpIHw+IAogIHQoKSAKIAogY29sbmFtZXMocmVzKSA8LSBjKCJsb2dGQyIsInNlIiwidHN0YXQiLCJwdmFsIikKIAogcmVzIDwtIHJlcyB8PiAKICAgYXMuZGF0YS5mcmFtZSgpIHw+IAogICBuYS5leGNsdWRlKCkgfD4gCiAgIGFycmFuZ2UocHZhbCkKIAogcmVzJGFkalB2YWwgPC0gcC5hZGp1c3QocmVzJHB2YWwsICJmZHIiKQogCiBhbHBoYSA8LSAwLjA1CgogcmVzJGFkakFscGhhRm9ybSA8LSBwYXN0ZTAoMTpucm93KHJlcyksIiB4ICIsYWxwaGEsIi8iLG5yb3cocmVzKSkKCiByZXMkYWRqQWxwaGEgPC0gYWxwaGEgKiAoMTpucm93KHJlcykpL25yb3cocmVzKSAKCiByZXMkInB2YWwgPCBhZGpBbHBoYSIgPC0gcmVzJHB2YWwgPCByZXMkYWRqQWxwaGEgCgogcmVzJCJhZGpQdmFsIDwgYWxwaGEiIDwtIHJlcyRhZGpQdmFsIDwgYWxwaGEgCmBgYAo8L3A+PC9kZXRhaWxzPgoKRldFUjogQm9uZmVycm9uaSBtZXRob2Q6JFxhbHBoYV9cdGV4dHthZGp9ID0gXGFscGhhL20gPSAwLjA1IC8gYHIgbnJvdyhyZXMpYD0gYHIgcm91bmQoYWxwaGEvbnJvdyhyZXMpLDUpYCQKCmBgYHtyIGVjaG89RkFMU0V9IApoZWFkKHJlc1ssLWMoMjozKV0sc3VtKHJlcyRhZGpQdmFsIDwgYWxwaGEpKzIpIHw+IAogIGtuaXRyOjprYWJsZSgpCmBgYAp8IC4uLiB8IC4uLiB8IC4uLiB8IC4uLiB8IC4uLiB8IC4uLiB8IC4uLiB8IC4uLiB8CnxXUF8wMDMwNDA1NjIgfCAwLjAwMzk0ODB8IDAuOTk3NjQyOXwgMC45OTg1Nzk3fDEwNjUgeCAwLjA1LzEwNjYgfCAwLjA0OTk1MzF8RkFMU0UgICAgICAgICAgIHxGQUxTRSAgICAKfFdQXzAwMzA0MTEzMCB8IDAuMDAwMjk0MXwgMC45OTkyODEyfCAwLjk5OTI4MTJ8MTA2NiB4IDAuMDUvMTA2NiB8ICAgICAwLjA1fEZBTFNFICAgICAgICAgICB8RkFMU0UgICAgICAgICAgIHwKCgoKCiMjIyMgUmVzdWx0cwo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgPC9zdW1tYXJ5PjxwPgpgYGB7cn0Kdm9sY2Fub1QgPC0gcmVzIHw+IAogIGdncGxvdChhZXMoeCA9IGxvZ0ZDLCB5ID0gLWxvZzEwKHB2YWwpLCBjb2xvciA9IGFkalB2YWwgPCAwLjA1KSkgKwogICAgZ2VvbV9wb2ludChjZXggPSAyLjUpICsKICAgIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBhbHBoYShjKCJibGFjayIsICJyZWQiKSwgMC41KSkgKwogICAgdGhlbWVfbWluaW1hbCgpIApgYGAKPC9wPjwvZGV0YWlscz4KCgpgYGB7cn0Kdm9sY2Fub1QKYGBgCgojIyBNb2RlcmF0ZWQgU3RhdGlzdGljcwoKPGlmcmFtZSB3aWR0aD0iNTYwIiBoZWlnaHQ9IjMxNSIKc3JjPSJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9fUTExTFhEeTB4VSIKZnJhbWVib3JkZXI9IjAiCnN0eWxlPSJkaXNwbGF5OiBibG9jazsgbWFyZ2luOiBhdXRvOyIKYWxsb3c9ImF1dG9wbGF5OyBlbmNyeXB0ZWQtbWVkaWEiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4KClByb2JsZW1zIHdpdGggb3JkaW5hcnkgdC10ZXN0Cgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgPC9zdW1tYXJ5PjxwPgpgYGB7cn0KcHJvYmxlbVBsb3RzIDwtIGxpc3QoKSAKcHJvYmxlbVBsb3RzW1sxXV0gPC0gcmVzIHw+IAogIGdncGxvdChhZXMoeCA9IGxvZ0ZDLCB5ID0gc2UsIGNvbG9yID0gYWRqUHZhbCA8IDAuMDUpKSArCiAgICBnZW9tX3BvaW50KGNleCA9IDIuNSkgKwogICAgc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IGFscGhhKGMoImJsYWNrIiwgInJlZCIpLCAwLjUpKSArCiAgICB0aGVtZV9taW5pbWFsKCkgCgpmb3IgKGkgaW4gMjozKQp7CnByb2JsZW1QbG90c1tbaV1dIDwtIGNvbERhdGEocGUpIHw+IAogICAgYXMuZGF0YS5mcmFtZSgpIHw+IAogICAgbXV0YXRlKGludGVuc2l0eSA9IHBlW1sicHJvdGVpbiJdXVtyb3duYW1lcyhyZXMpW2ldLF0gfD4gCiAgICAgICAgICAgICBhc3NheSgpIHw+IAogICAgICAgICAgICAgYygpCiAgICAgICAgICAgKSB8PiAKICAgIGdncGxvdChhZXMoeD1nZW5vdHlwZSx5PWludGVuc2l0eSkpICsKICAgIGdlb21fcG9pbnQoKSArIAogICAgeWxpbSgtMywwKSArCiAgICBnZ3RpdGxlKHJvd25hbWVzKHJlcylbaV0pCn0KYGBgCjwvcD48L2RldGFpbHM+CgpgYGB7cn0KcHJvYmxlbVBsb3RzCmBgYAoKQSBnZW5lcmFsIGNsYXNzIG9mIG1vZGVyYXRlZCB0ZXN0IHN0YXRpc3RpY3MgaXMgZ2l2ZW4gYnkKIFxbCiAgIFRfZ157bW9kfSA9IFxmcmFje1xiYXJ7WX1fe2cxfSAtIFxiYXJ7WX1fe2cyfX17QyBccXVhZCBcdGlsZGV7U31fZ30gLAogXF0KIHdoZXJlICRcdGlsZGV7U31fZyQgaXMgYSBtb2RlcmF0ZWQgc3RhbmRhcmQgZGV2aWF0aW9uIGVzdGltYXRlLiAKCi0gJEMkIGlzIGEgY29uc3RhbnQgZGVwZW5kaW5nIG9uIHRoZSBkZXNpZ24gZS5nLiAkXHNxcnR7MS97bl8xfSsxL25fMn0kIGZvciBhIHQtdGVzdCBhbmQgb2YgYW5vdGhlciBmb3JtIGZvciBsaW5lYXIgbW9kZWxzLgotICRcdGlsZGV7U31fZz1TX2crU18wJDogYWRkIHNtYWxsIHBvc2l0aXZlIGNvbnN0YW50IHRvIGRlbm9taW5hdG9yIG9mIHQtc3RhdGlzdGljLiAKLSBUaGlzIGNhbiBiZSBhZG9wdGVkIGluIFBlcnNldXMuIAoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIDwvc3VtbWFyeT48cD4KYGBge3J9CnNpbUk8LXNhcHBseShyZXMkc2Uvc3FydCgxLzMrMS8zKSxmdW5jdGlvbihuLG1lYW4sc2QpIHJub3JtKG4sbWVhbixzZCksbj02LG1lYW49MCkgfD4gCiAgdCgpCgpyZXNTaW0gPC0gYXBwbHkoCiAgICBzaW1JLCAKICAgIDEsIAogICAgdHRlc3RNeCwKICAgIGdyb3VwID0gY29sRGF0YShwZSkkZ2Vub3R5cGU9PSJEOCIpIHw+IAogIHQoKSAKIGNvbG5hbWVzKHJlc1NpbSkgPC0gYygibG9nRkMiLCJzZSIsInRzdGF0IiwicHZhbCIpCiByZXNTaW0gPC0gYXMuZGF0YS5mcmFtZShyZXNTaW0pCiB0c3RhdFNpbVBsb3QgPC0gcmVzU2ltIHw+IAogICBnZ3Bsb3QoYWVzKHg9dHN0YXQpKSArCiAgICAgZ2VvbV9oaXN0b2dyYW0oYWVzKHk9Li5kZW5zaXR5Li4sIGZpbGw9Li5jb3VudC4uKSxiaW5zPTMwKSArCiAgICAgc3RhdF9mdW5jdGlvbihmdW49ZHQsCiAgICBjb2xvcj0icmVkIiwKICAgIGFyZ3M9bGlzdChkZj00KSkgKyAKICAgeWxpbSgwLC42KSArCiAgIGdndGl0bGUoInQtc3RhdGlzdGljIikKCiAKIHJlc1NpbSRDIDwtIHNxcnQoMS8zKzEvMykgCiByZXNTaW0kc2QgPC0gcmVzU2ltJHNlL3Jlc1NpbSRDIAogdHN0YXRTaW1QZXJzZXVzIDwtIHJlc1NpbSB8PiAKICAgZ2dwbG90KGFlcyh4PWxvZ0ZDLygoc2QrLjEpKkMpKSkgKwogICAgIGdlb21faGlzdG9ncmFtKGFlcyh5PS4uZGVuc2l0eS4uLCBmaWxsPS4uY291bnQuLiksYmlucz0zMCkgKwogICAgIHN0YXRfZnVuY3Rpb24oZnVuPWR0LAogICAgICAgICAgICAgICAgICAgY29sb3I9InJlZCIsCiAgICAgICAgICAgICAgICAgIGFyZ3M9bGlzdChkZj00KSkgKyAKICAgICB5bGltKDAsLjYpICsKICAgIGdndGl0bGUoIlBlcnNldXMiKQpgYGAKCjwvcD48L2RldGFpbHM+CgpgYGB7cn0KZ3JpZEV4dHJhOjpncmlkLmFycmFuZ2UodHN0YXRTaW1QbG90LHRzdGF0U2ltUGVyc2V1cyxucm93PTEpCmBgYAoKLSBUaGUgY2hvaWNlIG9mICRTXzAkIGluIFBlcnNldXMgaXMgYWQgaG9jIGFuZCB0aGUgdC1zdGF0aXN0aWMgaXMgbm8tbG9uZ2VyIHQtZGlzdHJpYnV0ZWQuIAotIFBlcm11dGF0aW9uIHRlc3QsIGJ1dCBpcyBkaWZmaWN1bHQgZm9yIG1vcmUgY29tcGxleCBkZXNpZ25zLgotIEFsbG93cyBmb3IgRGF0YSBEcmVkZ2luZyBiZWNhdXNlIHVzZXIgY2FuIGNob29zZSAkU18wJCAKCgojIyMgRW1waXJpY2FsIEJheWVzIAoKCmBgYHtyIGVjaG89RkFMU0UsIG91dC53aWR0aD0iNTAlIn0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoIi4vZmlndXJlcy9saW1tYVNocmlua2FnZS5wbmciKQpgYGAKCkZpZ3VyZSBjb3VydGVzeSB0byBSYWZhZWwgSXJpemFycnkKCiQkCiAgIFRfZ157bW9kfSA9IFxmcmFje1xiYXJ7WX1fe2cxfSAtIFxiYXJ7WX1fe2cyfX17QyBccXVhZCBcdGlsZGV7U31fZ30gLAogJCQKCi0gKiplbXBpcmljYWwgQmF5ZXMqKiB0aGVvcnkgcHJvdmlkZXMgZm9ybWFsIGZyYW1ld29yayBmb3IgYm9ycm93aW5nIHN0cmVuZ3RoIGFjcm9zcyBwcm90ZWlucywKLSBJbXBsZW1lbnRlZCBpbiBwb3B1bGFyIGJpb2NvbmR1Y3RvciBwYWNrYWdlICoqbGltbWEqKiBhbmQgKiptc3Fyb2IyKioKCiQkCiAgXHRpbGRle1N9X2c9XHNxcnR7XGZyYWN7ZF9nU19nXjIrZF8wU18wXjJ9e2RfZytkXzB9fSwKJCQKCi0gJFNfMF4yJDogY29tbW9uIHZhcmlhbmNlIChvdmVyIGFsbCBwcm90ZWlucykgCi0gTW9kZXJhdGVkIHQtc3RhdGlzdGljIGlzIHQtZGlzdHJpYnV0ZWQgd2l0aCAkZF8wK2RfZyQgZGVncmVlcyBvZiBmcmVlZG9tLiAKLSBOb3RlIHRoYXQgdGhlIGRlZ3JlZXMgb2YgZnJlZWRvbSBpbmNyZWFzZSBieSBib3Jyb3dpbmcgc3RyZW5ndGggYWNyb3NzIHByb3RlaW5zIQoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSB0aGUgY29kZSA8L3N1bW1hcnk+PHA+ICAgCgoxLiBXZSBtb2RlbCB0aGUgcHJvdGVpbiBsZXZlbCBleHByZXNzaW9uIHZhbHVlcyB1c2luZyB0aGUgYG1zcXJvYmAgZnVuY3Rpb24uCkJ5IGRlZmF1bHQgYG1zcXJvYjJgIGVzdGltYXRlcyB0aGUgbW9kZWwgcGFyYW1ldGVycyB1c2luZyByb2J1c3QgcmVncmVzc2lvbi4KCldlIHdpbGwgbW9kZWwgdGhlIGRhdGEgd2l0aCBhIGRpZmZlcmVudCBncm91cCBtZWFuIGZvciBldmVyeSBnZW5vdHlwZS4gClRoZSBncm91cCBpcyBpbmNvZGVkIGluIHRoZSB2YXJpYWJsZSBgZ2Vub3R5cGVgIG9mIHRoZSBjb2xEYXRhLiAKV2UgY2FuIHNwZWNpZnkgdGhpcyBtb2RlbCBieSB1c2luZyBhIGZvcm11bGEgd2l0aCB0aGUgZmFjdG9yIGBnZW5vdHlwZWAgYXMgaXRzIHByZWRpY3RvcjogCmBmb3JtdWxhID0gfmdlbm90eXBlYC4KCk5vdGUsIHRoYXQgYSBmb3JtdWxhIGFsd2F5cyBzdGFydHMgd2l0aCBhIHN5bWJvbCAnficuCmBgYHtyIHdhcm5pbmc9RkFMU0V9CnBlIDwtIG1zcXJvYihvYmplY3QgPSBwZSwgaSA9ICJwcm90ZWluIiwgZm9ybXVsYSA9IH5nZW5vdHlwZSkKYGBgCgoyLiBJbmZlcmVuY2UgCgpXZSBmaXJzdCBleHBsb3JlIHRoZSBkZXNpZ24gb2YgdGhlIG1vZGVsIHRoYXQgd2Ugc3BlY2lmaWVkIHVzaW5nIHRoZSB0aGUgcGFja2FnZSBgRXhwbG9yZU1vZGVsTWF0cml4YCAKCmBgYHtyfQpsaWJyYXJ5KEV4cGxvcmVNb2RlbE1hdHJpeCkKVmlzdWFsaXplRGVzaWduKGNvbERhdGEocGUpLH5nZW5vdHlwZSkkcGxvdGxpc3QKYGBgCgpXZSBoYXZlIHR3byBtb2RlbCBwYXJhbWV0ZXJzLCB0aGUgKEludGVyY2VwdCkgYW5kIGdlbm90eXBlRDguIApUaGlzIHJlc3VsdHMgaW4gYSBtb2RlbCB3aXRoIHR3byBncm91cCBtZWFuczogCgoxLiBGb3IgdGhlIHdpbGQgdHlwZSAoV1QpIHRoZSBleHBlY3RlZCB2YWx1ZSAobWVhbikgb2YgdGhlIGxvZzIgdHJhbnNmb3JtZWQgaW50ZW5zaXR5IHkgZm9yIGEgcHJvdGVpbiB3aWxsIGJlIG1vZGVsbGVkIHVzaW5nIAoKJCRcdGV4dHtFfVtZXHZlcnQgXHRleHR7Z2Vub3R5cGV9PVx0ZXh0e1dUfV0gPSBcdGV4dHsoSW50ZXJjZXB0KX0kJCAKCjIuIEZvciB0aGUga25vY2tvdXQgZ2Vub3R5cGUgRDggdGhlIGV4cGVjdGVkIHZhbHVlIChtZWFuKSBvZiB0aGUgbG9nMiB0cmFuc2Zvcm1lZCBpbnRlbnNpdHkgeSBmb3IgYSBwcm90ZWluIHdpbGwgYmUgbW9kZWxsZWQgdXNpbmcgCgokJFx0ZXh0e0V9W1lcdmVydCBcdGV4dHtnZW5vdHlwZX09XHRleHR7RDh9XSA9IFx0ZXh0eyhJbnRlcmNlcHQpfSArIFx0ZXh0e2dlbm90eXBlRDh9JCQgCgpUaGUgYXZlcmFnZSBsb2cyRkMgYmV0d2VlbiBEOCBhbmQgV1QgaXMgdGh1cwokJFxsb2dfMlx0ZXh0e0ZDfV97RDgtV1R9PSBcdGV4dHtFfVtZXHZlcnQgXHRleHR7Z2Vub3R5cGV9PVx0ZXh0e0Q4fV0gLSBcdGV4dHtFfVtZXHZlcnQgXHRleHR7Z2Vub3R5cGV9PVx0ZXh0e1dUfV0gPSBcdGV4dHtnZW5vdHlwZUQ4fQokJAoKSGVuY2UsIGFzc2Vzc2luZyB0aGUgbnVsbCBoeXBvdGhlc2lzIHRoYXQgdGhlcmUgaXMgbm8gZGlmZmVyZW50aWFsIGFidW5kYW5jZSBiZXR3ZWVuIEQ4IGFuZCBXVCBjYW4gYmUgcmVmb3JtdWxhdGVkIGFzCgokJEhfMDogIFx0ZXh0e2dlbm90eXBlRDh9PTAkJApXZSBjYW4gaW1wbGVtZW50IGEgaHlwb3RoZXNpcyB0ZXN0IGZvciBlYWNoIHByb3RlaW4gaW4gbXNxcm9iMiB1c2luZyB0aGUgY29kZSBiZWxvdzogCgpgYGB7cn0KTCA8LSBtYWtlQ29udHJhc3QoImdlbm90eXBlRDggPSAwIiwgcGFyYW1ldGVyTmFtZXMgPSBjKCJnZW5vdHlwZUQ4IikpCnBlIDwtIGh5cG90aGVzaXNUZXN0KG9iamVjdCA9IHBlLCBpID0gInByb3RlaW4iLCBjb250cmFzdCA9IEwpCmBgYAoKV2UgY2FuIHNob3cgdGhlIGxpc3Qgd2l0aCBhbGwgc2lnbmlmaWNhbnQgREUgcHJvdGVpbnMgYXQgdGhlIDUlIEZEUiB1c2luZyAKYGBge3J9CnJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSRnZW5vdHlwZUQ4IHw+IAogIGFycmFuZ2UocHZhbCkgfD4KICBmaWx0ZXIoYWRqUHZhbDwwLjA1KQpgYGAKCldlIGNhbiBhbHNvIHZpc3VhbGlzZSB0aGUgcmVzdWx0cyB1c2luZyBhIHZvbGNhbm9wbG90CgpgYGB7cn0Kdm9sY2FubyA8LSBnZ3Bsb3QoCiAgICByb3dEYXRhKHBlW1sicHJvdGVpbiJdXSkkZ2Vub3R5cGVEOCwKICAgIGFlcyh4ID0gbG9nRkMsIHkgPSAtbG9nMTAocHZhbCksIGNvbG9yID0gYWRqUHZhbCA8IDAuMDUpCikgKwogICAgZ2VvbV9wb2ludChjZXggPSAyLjUpICsKICAgIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBhbHBoYShjKCJibGFjayIsICJyZWQiKSwgMC41KSkgKwogICAgdGhlbWVfbWluaW1hbCgpICsKICAgIGdndGl0bGUoIm1zcXJvYjIiKQpgYGAKPC9wPjwvZGV0YWlscz4KCmBgYHtyfQpncmlkRXh0cmE6OmdyaWQuYXJyYW5nZSgKICB2b2xjYW5vVCArICAgIAogICAgeGxpbSgtMywzKSArCiAgZ2d0aXRsZSgib3JkaW5hcnkgdC10ZXN0IiksCiAgdm9sY2FubyArICAgICAKICAgIHhsaW0oLTMsMykKLG5yb3c9MikKYGBgCgotIFRoZSB2b2xjYW5vIHBsb3Qgb3BlbnMgdXAgd2hlbiB1c2luZyB0aGUgRUIgdmFyaWFuY2UgZXN0aW1hdG9yCgotICBCb3Jyb3dpbmcgc3RyZW5ndGggdG8gZXN0aW1hdGUgdGhlIHZhcmlhbmNlIHVzaW5nIGVtcGlyaWNhbCBCYXllcyBzb2x2ZXMgdGhlIGlzc3VlIG9mIHJldHVybmluZyBwcm90ZWlucyB3aXRoIGEgbG93IGZvbGQgY2hhbmdlIGFzIHNpZ25pZmljYW50IGR1ZSB0byBhIGxvdyB2YXJpYW5jZS4gCgoKIyMjIFNocmlua2FnZSBvZiB0aGUgIHZhcmlhbmNlIGFuZCBtb2RlcmF0ZWQgdC1zdGF0aXN0aWNzCgpgYGB7cn0KcXBsb3QoCiAgc2FwcGx5KHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSRtc3Fyb2JNb2RlbHMsZ2V0U2lnbWEpLAogIHNhcHBseShyb3dEYXRhKHBlW1sicHJvdGVpbiJdXSkkbXNxcm9iTW9kZWxzLGdldFNpZ21hUG9zdGVyaW9yKSkgKwogIHhsYWIoIlNEIikgKwogIHlsYWIoIm1vZGVyYXRlZCBTRCIpICsKICBnZW9tX2FibGluZShpbnRlcmNlcHQgPSAwLHNsb3BlID0gMSkgKwogIGdlb21faGxpbmUoeWludGVyY2VwdCA9ICkgCmBgYAoKLSBTbWFsbCB2YXJpYW5jZXMgYXJlIHNocnVua2VuIHRvd2FyZHMgdGhlIGNvbW1vbiB2YXJpYW5jZSByZXN1bHRpbmcgaW4gbGFyZ2UgRUIgdmFyaWFuY2UgZXN0aW1hdGVzCi0gTGFyZ2UgdmFyaWFuY2VzIGFyZSBzaHJ1bmtlbiB0b3dhcmRzIHRoZSBjb21tb24gdmFyaWFuY2UgcmVzdWx0aW5nIGluIHNtYWxsZXIgRUIgdmFyaWFuY2UgZXN0aW1hdGVzIAotIFBvb2xlZCBkZWdyZWVzIG9mIGZyZWVkb20gb2YgdGhlIEVCIHZhcmlhbmNlIGVzdGltYXRvciBhcmUgbGFyZ2VyIGJlY2F1c2UgaW5mb3JtYXRpb24gaXMgYm9ycm93ZWQgYWNyb3NzIHByb3RlaW5zIHRvIGVzdGltYXRlIHRoZSB2YXJpYW5jZQoKIyMgUGxvdHMgCgpgYGB7cn0Kc2lnTmFtZXMgPC0gcm93RGF0YShwZVtbInByb3RlaW4iXV0pJGdlbm90eXBlRDggfD4KICAgIHJvd25hbWVzX3RvX2NvbHVtbigicHJvdGVpbiIpIHw+CiAgICBmaWx0ZXIoYWRqUHZhbCA8IDAuMDUpIHw+CiAgICBwdWxsKHByb3RlaW4pCmhlYXRtYXAoYXNzYXkocGVbWyJwcm90ZWluIl1dKVtzaWdOYW1lcywgXSkKYGBgCgoKYGBge3IsIHdhcm5pbmc9RkFMU0UsIG1lc3NhZ2U9RkFMU0V9CmZvciAocHJvdE5hbWUgaW4gc2lnTmFtZXMpCiAgICB7CiAgICAgICAgcGVQbG90IDwtIHBlW3Byb3ROYW1lLCAsIGMoInBlcHRpZGVOb3JtIiwgInByb3RlaW4iKV0KICAgICAgICBwZVBsb3REZiA8LSBkYXRhLmZyYW1lKGxvbmdGb3JtKHBlUGxvdCkpCiAgICAgICAgcGVQbG90RGYkYXNzYXkgPC0gZmFjdG9yKHBlUGxvdERmJGFzc2F5LAogICAgICAgICAgICBsZXZlbHMgPSBjKCJwZXB0aWRlTm9ybSIsICJwcm90ZWluIikKICAgICAgICApCiAgICAgICAgcGVQbG90RGYkZ2Vub3R5cGUgPC0gYXMuZmFjdG9yKGNvbERhdGEocGVQbG90KVtwZVBsb3REZiRjb2xuYW1lLCAiZ2Vub3R5cGUiXSkKCiAgICAgICAgIyBwbG90dGluZwogICAgICAgIHAxIDwtIGdncGxvdCgKICAgICAgICAgICAgZGF0YSA9IHBlUGxvdERmLAogICAgICAgICAgICBhZXMoeCA9IGNvbG5hbWUsIHkgPSB2YWx1ZSwgZ3JvdXAgPSByb3duYW1lKQogICAgICAgICkgKwogICAgICAgICAgICBnZW9tX2xpbmUoKSArCiAgICAgICAgICAgIGdlb21fcG9pbnQoKSArCiAgICAgICAgICAgIGZhY2V0X2dyaWQofmFzc2F5KSArCiAgICAgICAgICAgIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gNzAsIGhqdXN0ID0gMSwgdmp1c3QgPSAwLjUpKSArCiAgICAgICAgICAgIGdndGl0bGUocHJvdE5hbWUpCiAgICAgICAgcHJpbnQocDEpCgogICAgICAgICMgcGxvdHRpbmcgMgogICAgICAgIHAyIDwtIGdncGxvdChwZVBsb3REZiwgYWVzKHggPSBjb2xuYW1lLCB5ID0gdmFsdWUsIGZpbGwgPSBnZW5vdHlwZSkpICsKICAgICAgICAgICAgZ2VvbV9ib3hwbG90KG91dGxpZXIuc2hhcGUgPSBOQSkgKwogICAgICAgICAgICBnZW9tX3BvaW50KAogICAgICAgICAgICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbl9qaXR0ZXIod2lkdGggPSAuMSksCiAgICAgICAgICAgICAgICBhZXMoc2hhcGUgPSByb3duYW1lKQogICAgICAgICAgICApICsKICAgICAgICAgICAgc2NhbGVfc2hhcGVfbWFudWFsKHZhbHVlcyA9IDE6bnJvdyhwZVBsb3REZikpICsKICAgICAgICAgICAgbGFicyh0aXRsZSA9IHByb3ROYW1lLCB4ID0gInNhbXBsZSIsIHkgPSAicGVwdGlkZSBpbnRlbnNpdHkgKGxvZzIpIikgKwogICAgICAgICAgICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDcwLCBoanVzdCA9IDEsIHZqdXN0ID0gMC41KSkgKwogICAgICAgICAgICBmYWNldF9ncmlkKH5hc3NheSkKICAgICAgICBwcmludChwMikKfQpgYGAKCiMgRXhwZXJpbWVudGFsIERlc2lnbgoKIyMgU2FtcGxlIHNpemUgCgo8aWZyYW1lIHdpZHRoPSI1NjAiIGhlaWdodD0iMzE1IgpzcmM9Imh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL3VFTGdrekRqVlJZIgpmcmFtZWJvcmRlcj0iMCIKc3R5bGU9ImRpc3BsYXk6IGJsb2NrOyBtYXJnaW46IGF1dG87IgphbGxvdz0iYXV0b3BsYXk7IGVuY3J5cHRlZC1tZWRpYSIgYWxsb3dmdWxsc2NyZWVuPjwvaWZyYW1lPgoKJCQKIFxsb2dfMiBcdGV4dHtGQ30gPSBcYmFye3l9X3twMX0tXGJhcnt5fV97cDJ9CiQkCgokJApUX2c9XGZyYWN7XGxvZ18yIFx0ZXh0e0ZDfX17XHRleHR7c2V9X3tcbG9nXzIgXHRleHR7RkN9fX0KJCQKCiQkClRfZz1cZnJhY3tcd2lkZWhhdHtcdGV4dHtzaWduYWx9fX17XHdpZGVoYXR7XHRleHR7Tm9pc2V9fX0KJCQKCklmIHdlIGNhbiBhc3N1bWUgZXF1YWwgdmFyaWFuY2UgaW4gYm90aCB0cmVhdG1lbnQgZ3JvdXBzOgoKJCQKXHRleHR7c2V9X3tcbG9nXzIgXHRleHR7RkN9fT1cdGV4dHtTRH1cc3FydHtcZnJhY3sxfXtuXzF9K1xmcmFjezF9e25fMn19CiQkCgokXHJpZ2h0YXJyb3ckIGlmIG51bWJlciBvZiBiaW8tcmVwZWF0cyBpbmNyZWFzZXMgd2UgaGF2ZSBhIGhpZ2hlciBwb3dlciEKCi0gY2ZyLiBTdHVkeSBvZiB0YW1veGlmZW4gdHJlYXRlZCBFc3Ryb2dlbiBSZWNlcHRlciAoRVIpIHBvc2l0aXZlIGJyZWFzdCBjYW5jZXIgcGF0aWVudHMKCiMjIFJhbmRvbWl6ZWQgY29tcGxldGUgYmxvY2sgZGVzaWducwoKPGlmcmFtZSB3aWR0aD0iNTYwIiBoZWlnaHQ9IjMxNSIKc3JjPSJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9IRTRLV2ZJT1ZwMCIKZnJhbWVib3JkZXI9IjAiCnN0eWxlPSJkaXNwbGF5OiBibG9jazsgbWFyZ2luOiBhdXRvOyIKYWxsb3c9ImF1dG9wbGF5OyBlbmNyeXB0ZWQtbWVkaWEiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4KCgpcW1xzaWdtYV4yPSBcc2lnbWFeMl97YmlvfStcc2lnbWFeMl9cdGV4dHtsYWJ9ICtcc2lnbWFeMl9cdGV4dHtleHRyYWN0aW9ufSArIFxzaWdtYV4yX1x0ZXh0e3J1bn0gKyBcbGRvdHNcXQoKLSBCaW9sb2dpY2FsOiBmbHVjdHVhdGlvbnMgaW4gcHJvdGVpbiBsZXZlbCBiZXR3ZWVuIG1pY2UsIGZsdWN0YXRpb25zIGluIHByb3RlaW4gbGV2ZWwgYmV0d2VlbiBjZWxscywgLi4uCi0gVGVjaG5pY2FsOiBjYWdlIGVmZmVjdCwgbGFiIGVmZmVjdCwgd2VlayBlZmZlY3QsIHBsYXNtYSBleHRyYWN0aW9uLCBNUy1ydW4sIC4uLgoKIyMjIE5hdHVyZSBtZXRob2RzOiBQb2ludHMgb2Ygc2lnbmlmaWNhbmNlIC0gQmxvY2tpbmcgCgpbaHR0cHM6Ly93d3cubmF0dXJlLmNvbS9hcnRpY2xlcy9ubWV0aC4zMDA1LnBkZl0oaHR0cHM6Ly93d3cubmF0dXJlLmNvbS9hcnRpY2xlcy9ubWV0aC4zMDA1LnBkZikKCgojIyMgTW91c2UgZXhhbXBsZSAKCgpgYGB7ciBlY2hvPUZBTFNFLCBvdXQud2lkdGg9IjUwJSJ9CmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKCIuL2ZpZ3VyZXMvbW91c2VUY2VsbF9SQ0JfZGVzaWduLnBuZyIpCmBgYAoKRHVndWV0IGV0IGFsLiAoMjAxNykgTUNQIDE2KDgpOjE0MTYtMTQzMi4gZG9pOiAxMC4xMDc0L21jcC5tMTE2LjA2Mjc0NQoKLSBBbGwgdHJlYXRtZW50cyBvZiBpbnRlcmVzdCBhcmUgcHJlc2VudCB3aXRoaW4gYmxvY2shCi0gV2UgY2FuIGVzdGltYXRlIHRoZSBlZmZlY3Qgb2YgdGhlIHRyZWF0bWVudCB3aXRoaW4gYmxvY2shCgpUbyBpbGx1c3RyYXRlIHRoZSBwb3dlciBvZiBibG9ja2luZyB3ZSBoYXZlIHN1YnNldHRlZCB0aGUgZGF0YSBvZiBEdWd1ZXQgZXQgYWwuIGluIGEgCgotIGNvbXBsZXRlbHkgcmFuZG9taXplZCBkZXNpZ24gd2l0aCAKICAgIC0gZm91ciBtaWNlIGZvciB3aGljaCB3ZSBvbmx5IGhhdmUgbWVhc3VyZW1lbnRzIG9uIHRoZSBvcmRpbmFyeSBULWNlbGxzIAogICAgLSBmb3VyIG1pY2UgZm9yIHdoaWNoIHdlIG9ubHkgaGF2ZSBtZWFzdXJlbWVudHMgb24gdGhlIHJlZ3VsYXRvcnkgVC1jZWxscyAKICAgIAotIHJhbmRvbWl6ZWQgY29tcGxldGUgYmxvY2sgZGVzaWduIHdpdGggZm91ciBtaWNlIGZvciB3aGljaCB3ZSBib3RoIGhhdmUKICAgIAogICAgLSBtZWFzdXJlbWVudHMgb24gb3JkaW5hcnkgVC1jZWxscyBhcyB3ZWxsIGFzCiAgICAtIG1lYXN1cmVtZW50cyBvbiByZWd1bGF0b3J5IFQtY2VsbHMKCgoKCiMjIyBEYXRhIAo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgIDwvc3VtbWFyeT48cD4KYGBge3IsIHdhcm5pbmc9RkFMU0UsIG1lc3NhZ2U9RkFMU0V9CnBlcHRpZGVzVGFibGUgPC0gZnJlYWQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9zdGF0T21pY3MvUERBMjEvZGF0YS9xdWFudGlmaWNhdGlvbi9tb3VzZVRjZWxsL3BlcHRpZGVzUkNCLnR4dCIpCmludDY0IDwtIHdoaWNoKHNhcHBseShwZXB0aWRlc1RhYmxlLGNsYXNzKSA9PSAiaW50ZWdlcjY0IikKZm9yIChqIGluIGludDY0KSBwZXB0aWRlc1RhYmxlW1tqXV0gPC0gYXMubnVtZXJpYyhwZXB0aWRlc1RhYmxlW1tqXV0pIAoKcGVwdGlkZXNUYWJsZTIgPC0gZnJlYWQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9zdGF0T21pY3MvUERBMjEvZGF0YS9xdWFudGlmaWNhdGlvbi9tb3VzZVRjZWxsL3BlcHRpZGVzQ1JELnR4dCIpCmludDY0IDwtIHdoaWNoKHNhcHBseShwZXB0aWRlc1RhYmxlMixjbGFzcykgPT0gImludGVnZXI2NCIpCmZvciAoaiBpbiBpbnQ2NCkgcGVwdGlkZXNUYWJsZTJbW2pdXSA8LSBhcy5udW1lcmljKHBlcHRpZGVzVGFibGUyW1tqXV0pIAoKcGVwdGlkZXNUYWJsZTMgPC0gZnJlYWQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9zdGF0T21pY3MvUERBMjEvZGF0YS9xdWFudGlmaWNhdGlvbi9tb3VzZVRjZWxsL3BlcHRpZGVzLnR4dCIpCmludDY0IDwtIHdoaWNoKHNhcHBseShwZXB0aWRlc1RhYmxlMyxjbGFzcykgPT0gImludGVnZXI2NCIpCmZvciAoaiBpbiBpbnQ2NCkgcGVwdGlkZXNUYWJsZTNbW2pdXSA8LSBhcy5udW1lcmljKHBlcHRpZGVzVGFibGUzW1tqXV0pIAoKcXVhbnRDb2xzIDwtIGdyZXAoIkludGVuc2l0eSAiLCBuYW1lcyhwZXB0aWRlc1RhYmxlKSkKcGUgPC0gcmVhZFFGZWF0dXJlcygKICBhc3NheURhdGEgPSBwZXB0aWRlc1RhYmxlLAogIGZuYW1lcyA9IDEsCiAgcXVhbnRDb2xzID0gIHF1YW50Q29scywKICBuYW1lID0gInBlcHRpZGVSYXciKQpybShwZXB0aWRlc1RhYmxlKQpnYygpCmdjKCkKCgpxdWFudENvbHMyIDwtIGdyZXAoIkludGVuc2l0eSAiLCBuYW1lcyhwZXB0aWRlc1RhYmxlMikpCnBlMiA8LSByZWFkUUZlYXR1cmVzKAogIGFzc2F5RGF0YSA9IHBlcHRpZGVzVGFibGUyLAogIGZuYW1lcyA9IDEsCiAgcXVhbnRDb2xzID0gIHF1YW50Q29sczIsCiAgbmFtZSA9ICJwZXB0aWRlUmF3IikKcm0ocGVwdGlkZXNUYWJsZTIpCmdjKCkKZ2MoKQoKcXVhbnRDb2xzMyA8LSBncmVwKCJJbnRlbnNpdHkgIiwgbmFtZXMocGVwdGlkZXNUYWJsZTMpKQpwZTMgPC0gcmVhZFFGZWF0dXJlcygKICBhc3NheURhdGEgPSBwZXB0aWRlc1RhYmxlMywKICBmbmFtZXMgPSAxLAogIHF1YW50Q29scyA9ICBxdWFudENvbHMzLAogIG5hbWUgPSAicGVwdGlkZVJhdyIpCnJtKHBlcHRpZGVzVGFibGUzKQpnYygpCmdjKCkKCiMjIyBEZXNpZ24KY29sRGF0YShwZSkkY2VsbHR5cGUgPC0gc3Vic3RyKAogIGNvbG5hbWVzKHBlW1sicGVwdGlkZVJhdyJdXSksCiAgMTEsCiAgMTQpIHw+CiAgdW5saXN0KCkgfD4gIAogIGFzLmZhY3RvcigpCgpjb2xEYXRhKHBlKSRtb3VzZSA8LSBwZVtbMV1dIHw+CiAgY29sbmFtZXMoKSB8PgogIHN0cnNwbGl0KHNwbGl0PSJbIF0iKSAgfD4KICBzYXBwbHkoZnVuY3Rpb24oeCkgeFszXSkgfD4KICBhcy5mYWN0b3IoKQoKY29sRGF0YShwZTIpJGNlbGx0eXBlIDwtIHN1YnN0cigKICBjb2xuYW1lcyhwZTJbWyJwZXB0aWRlUmF3Il1dKSwKICAxMSwKICAxNCkgfD4KICB1bmxpc3QoKSB8PiAgCiAgYXMuZmFjdG9yKCkKCmNvbERhdGEocGUyKSRtb3VzZSA8LSBwZTJbWzFdXSB8PgogIGNvbG5hbWVzKCkgfD4KICBzdHJzcGxpdChzcGxpdD0iWyBdIikgIHw+CiAgc2FwcGx5KGZ1bmN0aW9uKHgpIHhbM10pIHw+CiAgYXMuZmFjdG9yKCkKCmNvbERhdGEocGUzKSRjZWxsdHlwZSA8LSBzdWJzdHIoCiAgY29sbmFtZXMocGUzW1sicGVwdGlkZVJhdyJdXSksCiAgMTEsCiAgMTQpIHw+CiAgdW5saXN0KCkgfD4gIAogIGFzLmZhY3RvcigpCgpjb2xEYXRhKHBlMykkbW91c2UgPC0gcGUzW1sxXV0gfD4KICBjb2xuYW1lcygpIHw+CiAgc3Ryc3BsaXQoc3BsaXQ9IlsgXSIpICB8PgogIHNhcHBseShmdW5jdGlvbih4KSB4WzNdKSB8PgogIGFzLmZhY3RvcigpCmBgYAo8L3A+PC9kZXNpZ24+CgojIyMgUHJlcHJvY2Vzc2luZyAKCgojIyMjIExvZy10cmFuc2Zvcm0KCjxkZXRhaWxzPjxzdW1tYXJ5PiBDbGljayB0byBzZWUgY29kZSB0byBsb2ctdHJhbnNmcm9tIHRoZSBkYXRhIDwvc3VtbWFyeT48cD4KCi0gUGVwdGlkZXMgd2l0aCB6ZXJvIGludGVuc2l0aWVzIGFyZSBtaXNzaW5nIHBlcHRpZGVzIGFuZCBzaG91bGQgYmUgcmVwcmVzZW50CndpdGggYSBgTkFgIHZhbHVlIHJhdGhlciB0aGFuIGAwYC4KCmBgYHtyfQpwZSA8LSB6ZXJvSXNOQShwZSwgInBlcHRpZGVSYXciKSAjIGNvbnZlcnQgMCB0byBOQQoKcGUyIDwtIHplcm9Jc05BKHBlMiwgInBlcHRpZGVSYXciKSAjIGNvbnZlcnQgMCB0byBOQQoKcGUzIDwtIHplcm9Jc05BKHBlMywgInBlcHRpZGVSYXciKSAjIGNvbnZlcnQgMCB0byBOQQpgYGAKCi0gTG9ndHJhbnNmb3JtIGRhdGEgd2l0aCBiYXNlIDIKCmBgYHtyfQpwZSA8LSBsb2dUcmFuc2Zvcm0ocGUsIGJhc2UgPSAyLCBpID0gInBlcHRpZGVSYXciLCBuYW1lID0gInBlcHRpZGVMb2ciKQoKcGUyIDwtIGxvZ1RyYW5zZm9ybShwZTIsIGJhc2UgPSAyLCBpID0gInBlcHRpZGVSYXciLCBuYW1lID0gInBlcHRpZGVMb2ciKQoKcGUzIDwtIGxvZ1RyYW5zZm9ybShwZTMsIGJhc2UgPSAyLCBpID0gInBlcHRpZGVSYXciLCBuYW1lID0gInBlcHRpZGVMb2ciKQpgYGAKPC9wPjwvZGV0YWlscz4KCgojIyMjIEZpbHRlcmluZwo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGRldGFpbHMgb24gZmlsdGVyaW5nIDwvc3VtbWFyeT48cD4KCjEuIFJlbW92ZSBwZXB0aWRlcyB0aGF0IG1hcCB0byBtdWx0aXBsZSBwcm90ZWlucwoKV2UgcmVtb3ZlIFBTTXMgdGhhdCBjb3VsZCBub3QgYmUgbWFwcGVkIHRvIGEgcHJvdGVpbiBvciB0aGF0IG1hcAp0byBtdWx0aXBsZSBwcm90ZWlucyAodGhlIHByb3RlaW4gaWRlbnRpZmllciBjb250YWlucyBtdWx0aXBsZQppZGVudGlmaWVycyBzZXBhcmF0ZWQgYnkgYSBgO2ApLgoKYGBge3J9CnBlIDwtIGZpbHRlckZlYXR1cmVzKAogICAgcGUsIH4gUHJvdGVpbnMgIT0gIiIgJiAjIyBSZW1vdmUgZmFpbGVkIHByb3RlaW4gaW5mZXJlbmNlCiAgICAgICAgIWdyZXBsKCI7IiwgUHJvdGVpbnMpKSAjIyBSZW1vdmUgcHJvdGVpbiBncm91cHMKCnBlMiA8LSBmaWx0ZXJGZWF0dXJlcygKICAgIHBlMiwgfiBQcm90ZWlucyAhPSAiIiAmICMjIFJlbW92ZSBmYWlsZWQgcHJvdGVpbiBpbmZlcmVuY2UKICAgICAgICAhZ3JlcGwoIjsiLCBQcm90ZWlucykpICMjIFJlbW92ZSBwcm90ZWluIGdyb3VwcwoKcGUzIDwtIGZpbHRlckZlYXR1cmVzKAogICAgcGUzLCB+IFByb3RlaW5zICE9ICIiICYgIyMgUmVtb3ZlIGZhaWxlZCBwcm90ZWluIGluZmVyZW5jZQogICAgICAgICFncmVwbCgiOyIsIFByb3RlaW5zKSkgIyMgUmVtb3ZlIHByb3RlaW4gZ3JvdXBzCmBgYAoyLiBSZW1vdmUgcmV2ZXJzZSBzZXF1ZW5jZXMgKGRlY295cykgYW5kIGNvbnRhbWluYW50cwoKV2Ugbm93IHJlbW92ZSB0aGUgY29udGFtaW5hbnRzLCBwZXB0aWRlcyB0aGF0IG1hcCB0byBkZWNveSBzZXF1ZW5jZXMsIGFuZCBwcm90ZWlucwp3aGljaCB3ZXJlIG9ubHkgaWRlbnRpZmllZCBieSBwZXB0aWRlcyB3aXRoIG1vZGlmaWNhdGlvbnMuCgpgYGB7cn0KcGUgPC0gZmlsdGVyRmVhdHVyZXMocGUsflJldmVyc2UgIT0gIisiKQpwZSA8LSBmaWx0ZXJGZWF0dXJlcyhwZSx+IFBvdGVudGlhbC5jb250YW1pbmFudCAhPSAiKyIpCgpwZTIgPC0gZmlsdGVyRmVhdHVyZXMocGUyLH5SZXZlcnNlICE9ICIrIikKcGUyIDwtIGZpbHRlckZlYXR1cmVzKHBlMix+IFBvdGVudGlhbC5jb250YW1pbmFudCAhPSAiKyIpCgpwZTMgPC0gZmlsdGVyRmVhdHVyZXMocGUzLH5SZXZlcnNlICE9ICIrIikKcGUzIDwtIGZpbHRlckZlYXR1cmVzKHBlMyx+IFBvdGVudGlhbC5jb250YW1pbmFudCAhPSAiKyIpCmBgYAoKCjMuIERyb3AgcGVwdGlkZXMgdGhhdCB3ZXJlIGlkZW50aWZpZWQgaW4gbGVzcyB0aGFuIHRocmVlIHNhbXBsZQoKV2Uga2VlcCBwZXB0aWRlcyB0aGF0IHdlcmUgb2JzZXJ2ZWQgYXQgbGVhc3QgdGhyZWUgdGltZXMuCgpgYGB7cn0Kbk9icyA8LSAzCm4gPC0gbmNvbChwZVtbInBlcHRpZGVMb2ciXV0pCnBOQSA8LSAobi1uT2JzKS9uCnBlIDwtIGZpbHRlck5BKHBlLCBwTkEgPSBwTkEsIGkgPSAicGVwdGlkZUxvZyIpCm5yb3cocGVbWyJwZXB0aWRlTG9nIl1dKQoKbiA8LSBuY29sKHBlMltbInBlcHRpZGVMb2ciXV0pCnBOQSA8LSAobi1uT2JzKS9uCnBlMiA8LSBmaWx0ZXJOQShwZTIsIHBOQSA9IHBOQSwgaSA9ICJwZXB0aWRlTG9nIikKbnJvdyhwZTJbWyJwZXB0aWRlTG9nIl1dKQoKbiA8LSBuY29sKHBlM1tbInBlcHRpZGVMb2ciXV0pCnBOQSA8LSAobi1uT2JzKS9uCnBlMyA8LSBmaWx0ZXJOQShwZTMsIHBOQSA9IHBOQSwgaSA9ICJwZXB0aWRlTG9nIikKbnJvdyhwZTNbWyJwZXB0aWRlTG9nIl1dKQpgYGAKCjwvcD48L2RldGFpbHM+CgojIyMjIE5vcm1hbGl6YXRpb24gCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgdG8gbm9ybWFsaXplIHRoZSBkYXRhIDwvc3VtbWFyeT48cD4KYGBge3J9CnBlIDwtIG5vcm1hbGl6ZShwZSwgCiAgICAgICAgICAgICAgICBpID0gInBlcHRpZGVMb2ciLCAKICAgICAgICAgICAgICAgIG5hbWUgPSAicGVwdGlkZU5vcm0iLCAKICAgICAgICAgICAgICAgIG1ldGhvZCA9ICJjZW50ZXIubWVkaWFuIikKCnBlMiA8LSBub3JtYWxpemUocGUyLCAKICAgICAgICAgICAgICAgIGkgPSAicGVwdGlkZUxvZyIsIAogICAgICAgICAgICAgICAgbmFtZSA9ICJwZXB0aWRlTm9ybSIsIAogICAgICAgICAgICAgICAgbWV0aG9kID0gImNlbnRlci5tZWRpYW4iKQoKCnBlMyA8LSBub3JtYWxpemUocGUzLCAKICAgICAgICAgICAgICAgIGkgPSAicGVwdGlkZUxvZyIsIAogICAgICAgICAgICAgICAgbmFtZSA9ICJwZXB0aWRlTm9ybSIsIAogICAgICAgICAgICAgICAgbWV0aG9kID0gImNlbnRlci5tZWRpYW4iKQpgYGAKCjwvcD48L2RldGFpbHM+CgojIyMjIFN1bW1hcml6YXRpb24KCjxkZXRhaWxzPjxzdW1tYXJ5PiBDbGljayB0byBzZWUgY29kZSB0byBzdW1tYXJpemUgdGhlIGRhdGEgPC9zdW1tYXJ5PjxwPgoKYGBge3Isd2FybmluZz1GQUxTRX0KcGUgPC0gYWdncmVnYXRlRmVhdHVyZXMocGUsCiBpID0gInBlcHRpZGVOb3JtIiwKIGZjb2wgPSAiUHJvdGVpbnMiLAogbmEucm0gPSBUUlVFLAogbmFtZSA9ICJwcm90ZWluIikKCgpwZTIgPC0gYWdncmVnYXRlRmVhdHVyZXMocGUyLAogaSA9ICJwZXB0aWRlTm9ybSIsCiBmY29sID0gIlByb3RlaW5zIiwKIG5hLnJtID0gVFJVRSwKIG5hbWUgPSAicHJvdGVpbiIpCgpwZTMgPC0gYWdncmVnYXRlRmVhdHVyZXMocGUzLAogaSA9ICJwZXB0aWRlTm9ybSIsCiBmY29sID0gIlByb3RlaW5zIiwKIG5hLnJtID0gVFJVRSwKIG5hbWUgPSAicHJvdGVpbiIpCmBgYAoKIyMjIyBGaWx0ZXJpbmcgcHJvdGVpbnMgd2l0aCB0b28gbWFueSBtaXNzaW5nIHZhbHVlcyAKCldlIHdhbnQgdG8gaGF2ZSBhdCBsZWFzdCB0d28gb2JzZXJ2ZWQgcHJvdGVpbiBpbnRlbnNpdGllcyBmb3IgZWFjaCBncm91cCBzbyB3ZSBzZXQgdGhlIG1pbmltdW0gbnVtYmVyIG9mIG9ic2VydmVkIHZhbHVlcyBhdCA0LiAKV2Ugc3RpbGwgaGF2ZSB0byBjaGVjayBmb3IgdGhlIG9ic2VydmVkIHByb3RlaW5zIGlmIHRoYXQgaXMgdGhlIGNhc2UuIAoKRm9yIGJsb2NrIGRlc2lnbiBtb3JlIGNsZXZlciBmaWx0ZXJpbmcgY2FuIGJlIHVzZWQuIEUuZy4gd2UgY291bGQgaW1wbHkgdGhhdCB3ZSBoYXZlIGJvdGggY2VsbCB0eXBlcyBpbiBhdCBsZWFzdCB0d28gYW5pbWFscy4uLiAKCgpgYGB7cn0Kbk9icyA8LSA0Cm4gPC0gbmNvbChwZVtbInByb3RlaW4iXV0pCnBOQSA8LSAobi1uT2JzKS9uCnBlPC0gZmlsdGVyTkEocGUsIHBOQSA9IHBOQSwgaSA9ICJwcm90ZWluIikKCm4gPC0gbmNvbChwZTJbWyJwcm90ZWluIl1dKQpwTkEgPC0gKG4tbk9icykvbgpwZTIgPC0gZmlsdGVyTkEocGUyLCBwTkEgPSBwTkEsIGkgPSAicHJvdGVpbiIpCgpuIDwtIG5jb2wocGUzW1sicHJvdGVpbiJdXSkKcE5BIDwtIChuLW5PYnMpL24KcGUzIDwtIGZpbHRlck5BKHBlMywgcE5BID0gcE5BLCBpID0gInByb3RlaW4iKQpgYGAKCjwvcD48L2RldGFpbHM+CgojIyMgRGF0YSBFeHBsb3JhdGlvbjogd2hhdCBpcyBpbXBhY3Qgb2YgYmxvY2tpbmc/IAoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIDwvc3VtbWFyeT48cD4KYGBge3J9CmxldmVscyhjb2xEYXRhKHBlMykkbW91c2UpIDwtIHBhc3RlMCgibSIsMTo3KQptZHNPYmozIDwtIHBsb3RNRFMoYXNzYXkocGUzW1sicHJvdGVpbiJdXSksIHBsb3QgPSBGQUxTRSkKbWRzT3JpZyA8LSBjb2xEYXRhKHBlMykgfD4KICBhcy5kYXRhLmZyYW1lKCkgfD4KICBtdXRhdGUobWRzMSA9IG1kc09iajMkeCwKICAgICAgICAgbWRzMiA9IG1kc09iajMkeSwKICAgICAgICAgbGFiID0gcGFzdGUobW91c2UsY2VsbHR5cGUsc2VwPSJfIikpIHw+CiAgZ2dwbG90KGFlcyh4ID0gbWRzMSwgeSA9IG1kczIsIGxhYmVsID0gbGFiLCBjb2xvciA9IGNlbGx0eXBlLCBncm91cCA9IG1vdXNlKSkgKwogIGdlb21fdGV4dChzaG93LmxlZ2VuZCA9IEZBTFNFKSArCiAgZ2VvbV9wb2ludChzaGFwZSA9IDIxKSArCiAgZ2VvbV9saW5lKGNvbG9yID0gImJsYWNrIiwgbGluZXR5cGUgPSAiZGFzaGVkIikgKwogIHhsYWIoCiAgICBwYXN0ZTAoCiAgICAgIG1kc09iajMkYXhpc2xhYmVsLAogICAgICAiICIsCiAgICAgIDEsIAogICAgICAiICgiLAogICAgICBwYXN0ZTAoCiAgICAgICAgcm91bmQobWRzT2JqMyR2YXIuZXhwbGFpbmVkWzFdICoxMDAsMCksCiAgICAgICAgIiUiCiAgICAgICAgKSwKICAgICAgIikiCiAgICAgICkKICAgICkgKwogIHlsYWIoCiAgICBwYXN0ZTAoCiAgICAgIG1kc09iajMkYXhpc2xhYmVsLAogICAgICAiICIsCiAgICAgIDIsIAogICAgICAiICgiLAogICAgICBwYXN0ZTAoCiAgICAgICAgcm91bmQobWRzT2JqMyR2YXIuZXhwbGFpbmVkWzJdICoxMDAsMCksCiAgICAgICAgIiUiCiAgICAgICAgKSwKICAgICAgIikiCiAgICAgICkKICAgICkgKwogIGdndGl0bGUoIk9yaWdpbmFsIChSQ0IpIikKCmxldmVscyhjb2xEYXRhKHBlKSRtb3VzZSkgPC0gcGFzdGUwKCJtIiwxOjQpCm1kc09iaiA8LSBwbG90TURTKGFzc2F5KHBlW1sicHJvdGVpbiJdXSksIHBsb3QgPSBGQUxTRSkKbWRzUkNCIDwtIGNvbERhdGEocGUpIHw+CiAgYXMuZGF0YS5mcmFtZSgpIHw+CiAgbXV0YXRlKG1kczEgPSBtZHNPYmokeCwKICAgICAgICAgbWRzMiA9IG1kc09iaiR5LAogICAgICAgICBsYWIgPSBwYXN0ZShtb3VzZSxjZWxsdHlwZSxzZXA9Il8iKSkgfD4KICBnZ3Bsb3QoYWVzKHggPSBtZHMxLCB5ID0gbWRzMiwgbGFiZWwgPSBsYWIsIGNvbG9yID0gY2VsbHR5cGUsIGdyb3VwID0gbW91c2UpKSArCiAgZ2VvbV90ZXh0KHNob3cubGVnZW5kID0gRkFMU0UpICsKICBnZW9tX3BvaW50KHNoYXBlID0gMjEpICsKICBnZW9tX2xpbmUoY29sb3IgPSAiYmxhY2siLCBsaW5ldHlwZSA9ICJkYXNoZWQiKSArCiAgeGxhYigKICAgIHBhc3RlMCgKICAgICAgbWRzT2JqJGF4aXNsYWJlbCwKICAgICAgIiAiLAogICAgICAxLCAKICAgICAgIiAoIiwKICAgICAgcGFzdGUwKAogICAgICAgIHJvdW5kKG1kc09iaiR2YXIuZXhwbGFpbmVkWzFdICoxMDAsMCksCiAgICAgICAgIiUiCiAgICAgICAgKSwKICAgICAgIikiCiAgICAgICkKICAgICkgKwogIHlsYWIoCiAgICBwYXN0ZTAoCiAgICAgIG1kc09iaiRheGlzbGFiZWwsCiAgICAgICIgIiwKICAgICAgMiwgCiAgICAgICIgKCIsCiAgICAgIHBhc3RlMCgKICAgICAgICByb3VuZChtZHNPYmokdmFyLmV4cGxhaW5lZFsyXSAqMTAwLDApLAogICAgICAgICIlIgogICAgICAgICksCiAgICAgICIpIgogICAgICApCiAgICApICsKICBnZ3RpdGxlKCJSYW5kb21pemVkIENvbXBsZXRlIEJsb2NrIChSQ0IpIikKCgpsZXZlbHMoY29sRGF0YShwZTIpJG1vdXNlKSA8LSBwYXN0ZTAoIm0iLDE6OCkKbWRzT2JqMiA8LSBwbG90TURTKGFzc2F5KHBlMltbInByb3RlaW4iXV0pLCBwbG90ID0gRkFMU0UpCm1kc0NSRCA8LSBjb2xEYXRhKHBlMikgfD4KICBhcy5kYXRhLmZyYW1lKCkgfD4KICBtdXRhdGUobWRzMSA9IG1kc09iajIkeCwKICAgICAgICAgbWRzMiA9IG1kc09iajIkeSwKICAgICAgICAgbGFiID0gcGFzdGUobW91c2UsY2VsbHR5cGUsc2VwPSJfIikpIHw+CiAgZ2dwbG90KGFlcyh4ID0gbWRzMSwgeSA9IG1kczIsIGxhYmVsID0gbGFiLCBjb2xvciA9IGNlbGx0eXBlLCBncm91cCA9IG1vdXNlKSkgKwogIGdlb21fdGV4dChzaG93LmxlZ2VuZCA9IEZBTFNFKSArCiAgZ2VvbV9wb2ludChzaGFwZSA9IDIxKSArCiAgeGxhYigKICAgIHBhc3RlMCgKICAgICAgbWRzT2JqJGF4aXNsYWJlbCwKICAgICAgIiAiLAogICAgICAxLCAKICAgICAgIiAoIiwKICAgICAgcGFzdGUwKAogICAgICAgIHJvdW5kKG1kc09iajIkdmFyLmV4cGxhaW5lZFsxXSAqMTAwLDApLAogICAgICAgICIlIgogICAgICAgICksCiAgICAgICIpIgogICAgICApCiAgICApICsKICB5bGFiKAogICAgcGFzdGUwKAogICAgICBtZHNPYmokYXhpc2xhYmVsLAogICAgICAiICIsCiAgICAgIDIsIAogICAgICAiICgiLAogICAgICBwYXN0ZTAoCiAgICAgICAgcm91bmQobWRzT2JqMiR2YXIuZXhwbGFpbmVkWzJdICoxMDAsMCksCiAgICAgICAgIiUiCiAgICAgICAgKSwKICAgICAgIikiCiAgICAgICkKICAgICkgKwogIGdndGl0bGUoIkNvbXBsZXRlbHkgUmFuZG9taXplZCBEZXNpZ24gKENSRCkiKQpgYGAKPC9wPjwvZGV0YWlscz4KYGBge3J9Cm1kc09yaWcKbWRzUkNCCm1kc0NSRApgYGAKCi0gV2Ugb2JzZXJ2ZSB0aGF0IHRoZSBsZWFkaW5nIGZvbGQgY2hhbmdlIGlzIGFjY29yZGluZyB0byBtb3VzZQotIEluIHRoZSBzZWNvbmQgZGltZW5zaW9uIHdlIHNlZSBhIHNlcGFyYXRpb24gYWNjb3JkaW5nIHRvIGNlbGwtdHlwZSAKLSBXaXRoIHRoZSBSYW5kb21pemVkIENvbXBsZXRlIEJsb2NrIGRlc2lnbiAoUkNCKSB3ZSBjYW4gcmVtb3ZlIHRoZSBtb3VzZSBlZmZlY3QgZnJvbSB0aGUgYW5hbHlzaXMhCgoKCgotIFdlIGNhbiBpc29sYXRlIHRoZSBiZXR3ZWVuIGJsb2NrIHZhcmlhYmlsaXR5IGZyb20gdGhlIGFuYWx5c2lzIHVzaW5nIGxpbmVhciBtb2RlbDoKICAKICAtIEZvcm11bGEgaW4gUgokJCAKeSBcc2ltIFx0ZXh0e2NlbGx0eXBlfSArIFx0ZXh0e21vdXNlfQokJAogIAogIC0gRm9ybXVsYSAKCiQkCnlfaSA9IFxiZXRhXzAgKyBcYmV0YV9cdGV4dHtUcmVnfSB4X3tpLFx0ZXh0e1RyZWd9fSArIFxiZXRhX3ttMn14X3tpLG0yfSArIFxiZXRhX3ttM314X3tpLG0zfSArIFxiZXRhX3ttNH14X3tpLG00fSAgKyBcZXBzaWxvbl9pCiQkCgp3aXRoCgotICR4X3tpLFRyZWd9PVxiZWdpbntjYXNlc30KMSYgXHRleHR7VHJlZ31cXAowJiBcdGV4dHtUY29ufQpcZW5ke2Nhc2VzfSQKCi0gJHhfe2ksbTJ9PVxiZWdpbntjYXNlc30KMSYgXHRleHR7bTJ9XFwKMCYgXHRleHR7b3RoZXJ3aXNlfQpcZW5ke2Nhc2VzfSQKCi0gJHhfe2ksbTN9PVxiZWdpbntjYXNlc30KMSYgXHRleHR7bTN9XFwKMCYgXHRleHR7b3RoZXJ3aXNlfQpcZW5ke2Nhc2VzfSQKLSAkeF97aSxtNH09XGJlZ2lue2Nhc2VzfQoxJiBcdGV4dHttNH1cXAowJiBcdGV4dHtvdGhlcndpc2V9ClxlbmR7Y2FzZXN9JAotIFBvc3NpYmxlIGluIG1zcXJvYjIgYW5kIE1Tc3RhdHMgYnV0IG5vdCBwb3NzaWJsZSB3aXRoIFBlcnNldXMhCgoKCiMjIyBNb2RlbGluZyBhbmQgaW5mZXJlbmNlCgojIyMjIFJDQiBhbmFseXNpcwpgYGB7ciB3YXJuaW5nPUZBTFNFfQpwZSA8LSBtc3Fyb2IoCiAgb2JqZWN0ID0gcGUsCiAgaSA9ICJwcm90ZWluIiwKICBmb3JtdWxhID0gfiBjZWxsdHlwZSArIG1vdXNlKQpgYGAKCgojIyMjIENSRCBhbmFseXNpcyAKYGBge3Igd2FybmluZyA9IEZBTFNFfQpwZTIgPC0gbXNxcm9iKAogIG9iamVjdCA9IHBlMiwKICBpID0gInByb3RlaW4iLAogIGZvcm11bGEgPSB+IGNlbGx0eXBlKQpgYGAKCiMjIyMgRXN0aW1hdGlvbiwgZWZmZWN0IHNpemUgYW5kIGluZmVyZW5jZQoKRWZmZWN0IHNpemUgaW4gUkNCCmBgYHtyfQpsaWJyYXJ5KEV4cGxvcmVNb2RlbE1hdHJpeCkKVmlzdWFsaXplRGVzaWduKGNvbERhdGEocGUpLH4gY2VsbHR5cGUgKyBtb3VzZSkkcGxvdGxpc3QKYGBgCgpFZmZlY3Qgc2l6ZSBpbiBDUkQKYGBge3J9ClZpc3VhbGl6ZURlc2lnbihjb2xEYXRhKHBlMiksfiBjZWxsdHlwZSkkcGxvdGxpc3QKYGBgCgoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIGZvciBzdGF0aXN0aWNhbCBpbmZlcmVuY2UgPC9zdW1tYXJ5PjxwPgpgYGB7cn0KTCA8LSBtYWtlQ29udHJhc3QoImNlbGx0eXBlVHJlZyA9IDAiLCBwYXJhbWV0ZXJOYW1lcyA9IGMoImNlbGx0eXBlVHJlZyIpKQpwZSA8LSBoeXBvdGhlc2lzVGVzdChvYmplY3QgPSBwZSwgaSA9ICJwcm90ZWluIiwgY29udHJhc3QgPSBMKQpwZTIgPC0gaHlwb3RoZXNpc1Rlc3Qob2JqZWN0ID0gcGUyLCBpID0gInByb3RlaW4iLCBjb250cmFzdCA9IEwpCmBgYAo8L3A+PC9kZXRhaWxzPgoKIyMjIENvbXBhcmlzb24gb2YgcmVzdWx0cwoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIDwvc3VtbWFyeT48cD4KYGBge3Igd2FybmluZz1GQUxTRSxlY2hvPUZBTFNFfQp2b2xjYW5vUkNCIDwtIGdncGxvdCgKICAgIHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSRjZWxsdHlwZVRyZWcsCiAgICBhZXMoeCA9IGxvZ0ZDLCB5ID0gLWxvZzEwKHB2YWwpLCBjb2xvciA9IGFkalB2YWwgPCAwLjA1KQopICsKICAgIGdlb21fcG9pbnQoY2V4ID0gMi41KSArCiAgICBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gYWxwaGEoYygiYmxhY2siLCAicmVkIiksIDAuNSkpICsKICAgIHRoZW1lX21pbmltYWwoKSArCiAgICBnZ3RpdGxlKHBhc3RlMCgiUkNCOiBcbiIsIAogICAgICAgICAgICAgICAgc3VtKHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSRjZWxsdHlwZVRyZWckYWRqUHZhbDwwLjA1LG5hLnJtPVRSVUUpLAogICAgICAgICAgICAiIHNpZ25pZmljYW50IikpCgp2b2xjYW5vQ1JEIDwtIGdncGxvdCgKICAgIHJvd0RhdGEocGUyW1sicHJvdGVpbiJdXSkkY2VsbHR5cGVUcmVnLAogICAgYWVzKHggPSBsb2dGQywgeSA9IC1sb2cxMChwdmFsKSwgY29sb3IgPSBhZGpQdmFsIDwgMC4wNSkKKSArCiAgICBnZW9tX3BvaW50KGNleCA9IDIuNSkgKwogICAgc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IGFscGhhKGMoImJsYWNrIiwgInJlZCIpLCAwLjUpKSArCiAgICB0aGVtZV9taW5pbWFsKCkgKwogICAgZ2d0aXRsZShwYXN0ZTAoIkNSRDogXG4iLCAKICAgICAgICAgICAgICAgIHN1bShyb3dEYXRhKHBlMltbInByb3RlaW4iXV0pJGNlbGx0eXBlVHJlZyRhZGpQdmFsPDAuMDUsbmEucm09VFJVRSksCiAgICAgICAgICAgICIgc2lnbmlmaWNhbnQiKSkKCnhsaW1zIDwtICgKICByYW5nZSgKICAgIHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSRjZWxsdHlwZVRyZWckbG9nRkMsCiAgICByb3dEYXRhKHBlMltbInByb3RlaW4iXV0pJGNlbGx0eXBlVHJlZyRsb2dGQywKICAgICAgICAgICAgICBuYS5ybT1UUlVFKSB8PiAKICAgIGFicygpIHw+IAogICAgbWF4KCkKICApICogYygtMSwxKQoKeWxpbXMgPC0gcmFuZ2UoLWxvZzEwKHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSRjZWxsdHlwZVRyZWckcHZhbCksIAogICAgICAgICAgICAgIC1sb2cxMChyb3dEYXRhKHBlMltbInByb3RlaW4iXV0pJGNlbGx0eXBlVHJlZyRsb2dGQyksIAogICAgICAgICAgICAgIG5hLnJtPVRSVUUpCmBgYAo8L3A+PC9kZXRhaWxzPgogIApgYGB7ciB3YXJuaW5nPUZBTFNFLGVjaG89RkFMU0V9CnZvbGNhbm9SQ0IgKyAKICB4bGltKHhsaW1zKSArIAogIHlsaW0oeWxpbXMpIAp2b2xjYW5vQ1JEICsgCiAgeGxpbSh4bGltcykgKyAKICB5bGltKHlsaW1zKQpgYGAKCiMjIyBDb21wYXJpc29uIG9mIHN0YW5kYXJkIGRldmlhdGlvbiAKCjxkZXRhaWxzPjxzdW1tYXJ5PiBDbGljayB0byBzZWUgY29kZSA8L3N1bW1hcnk+PHA+CmBgYHtyfQphY2Nlc3Npb25zIDwtIHJvd25hbWVzKHBlW1sicHJvdGVpbiJdXSlbcm93bmFtZXMocGVbWyJwcm90ZWluIl1dKSVpbiVyb3duYW1lcyhwZTJbWyJwcm90ZWluIl1dKV0KZGF0IDwtIGRhdGEuZnJhbWUoCnNpZ21hUkJDID0gc2FwcGx5KHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSRtc3Fyb2JNb2RlbHNbYWNjZXNzaW9uc10sIGdldFNpZ21hUG9zdGVyaW9yKSwKc2lnbWFDUkQgPC0gc2FwcGx5KHJvd0RhdGEocGUyW1sicHJvdGVpbiJdXSkkbXNxcm9iTW9kZWxzW2FjY2Vzc2lvbnNdLCBnZXRTaWdtYVBvc3RlcmlvcikKKQoKcGxvdFJCQ3ZzQ1JEIDwtIGdncGxvdChkYXRhID0gZGF0LCBhZXMoc2lnbWFSQkMsIHNpZ21hQ1JEKSkgKwogICAgZ2VvbV9wb2ludChhbHBoYSA9IDAuMSwgc2hhcGUgPSAyMCkgKwogICAgc2NhbGVfeF9sb2cxMCgpICsKICAgIHNjYWxlX3lfbG9nMTAoKSArCiAgICBnZW9tX2FibGluZShpbnRlcmNlcHQ9MCxzbG9wZT0xKQpgYGAKPC9wPjwvZGV0YWlscz4KCmBgYHtyfQogIHBsb3RSQkN2c0NSRApgYGAKCgotIFdlIGNsZWFybHkgb2JzZXJ2ZSB0aGF0IHRoZSBzdGFuZGFyZCBkZXZpYXRpb24gb2YgdGhlIHByb3RlaW4gZXhwcmVzc2lvbiBpbiB0aGUgUkNCIGlzIHNtYWxsZXIgZm9yIHRoZSBtYWpvcml0eSBvZiB0aGUgcHJvdGVpbnMgdGhhbiB0aGF0IG9idGFpbmVkIHdpdGggdGhlIENSRAoKLSBDYW4geW91IHRoaW5rIG9mIGEgcmVhc29uIHdoeSBpdCB3b3VsZCBub3QgYmUgdXNlZnVsIHRvIGJsb2NrIG9uIGEgcGFydGljdWxhciBmYWN0b3I/IAoKIyMgUHNldWRvLXJlcGxpY2F0aW9uCgotIFRoZSBGcmFuY2lzZWxsYSB0dWxhcmVuc2lzIHRoYXQgd2UgdXNlZCBiZWZvcmUgd2FzIGEgc3Vic2V0IG9mIHRoZSBkYXRhIG9mIFJhbW9uZCBldCBhbC4gCi0gVGhlIGF1dGhvcnMgaGF2ZSBydW4gdGhlIHNhbXBsZSBmb3IgZWFjaCBiaW8tcmVwIGluIHRlY2huaWNhbCB0cmlwbGljYXRlIG9uIHRoZSBtYXNzLXNwZWN0cm9tZXRlci4KCiMjIyBEYXRhCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgdG8gaW1wb3J0IGRhdGEgPC9zdW1tYXJ5PjxwPgoKMS4gV2UgdXNlIGEgcGVwdGlkZXMudHh0IGZpbGUgZnJvbSBNUy1kYXRhIHF1YW50aWZpZWQgd2l0aCBtYXhxdWFudCB0aGF0IApjb250YWlucyBNUzEgaW50ZW5zaXRpZXMgc3VtbWFyaXplZCBhdCB0aGUgcGVwdGlkZSBsZXZlbC4gCmBgYHtyfQpwZXB0aWRlc1RhYmxlIDwtIGZyZWFkKCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc3RhdE9taWNzL01TcVJvYlN1bVBhcGVyL3JlZnMvaGVhZHMvbWFzdGVyL0ZyYW5jaXNlbGxhL2RhdGEvbWF4cXVhbnQvcGVwdGlkZXMudHh0IikKaW50NjQgPC0gd2hpY2goc2FwcGx5KHBlcHRpZGVzVGFibGUsY2xhc3MpID09ICJpbnRlZ2VyNjQiKQpmb3IgKGogaW4gaW50NjQpIHBlcHRpZGVzVGFibGVbW2pdXSA8LSBhcy5udW1lcmljKHBlcHRpZGVzVGFibGVbW2pdXSkgICAgICAgICAgICAgICAgICAgICAgCmBgYAoKMi4gTWF4cXVhbnQgc3RvcmVzIHRoZSBpbnRlbnNpdHkgZGF0YSBmb3IgdGhlIGRpZmZlcmVudCBzYW1wbGVzIGluIGNvbHVtbm5zIHRoYXQgc3RhcnQgd2l0aCBJbnRlbnNpdHkuIFdlIGNhbiByZXRyZWl2ZSB0aGUgY29sdW1uIG5hbWVzIHdpdGggdGhlIGludGVuc2l0eSBkYXRhIHdpdGggdGhlIGNvZGUgYmVsb3c6IAoKYGBge3J9CnF1YW50Q29scyA8LSBncmVwKCJJbnRlbnNpdHkgIiwgbmFtZXMocGVwdGlkZXNUYWJsZSkpCmBgYAoKNC4gUmVhZCB0aGUgZGF0YSBhbmQgc3RvcmUgaXQgaW4gIFFGZWF0dXJlcyBvYmplY3QgCgpgYGB7cn0KcGUgPC0gcmVhZFFGZWF0dXJlcygKICBhc3NheURhdGEgPSBwZXB0aWRlc1RhYmxlLAogIGZuYW1lcyA9IDEsCiAgcXVhbnRDb2xzID0gIHF1YW50Q29scywKICBuYW1lID0gInBlcHRpZGVSYXciKQpybShwZXB0aWRlc1RhYmxlKQpnYygpCmdjKCkKYGBgCgo1LiBVcGRhdGUgZGF0YSB3aXRoIGluZm9ybWF0aW9uIG9uIGRlc2lnbgoKYGBge3J9CmNvbERhdGEocGUpJGdlbm90eXBlIDwtIHBlW1sxXV0gfD4gCiAgY29sbmFtZXMoKSB8PiAKICBzdWJzdHIoMTIsMTMpIHw+CiAgYXMuZmFjdG9yKCkgfD4gCiAgcmVsZXZlbCgiV1QiKQoKY29sRGF0YShwZSkkYmlvcmVwIDwtIHBlW1sxXV0gfD4gCiAgY29sbmFtZXMoKSB8PiAKICBzdWJzdHIoMjIsMjIpCgpjb2xEYXRhKHBlKSRiaW9yZXAgPC0gcGFzdGUoY29sRGF0YShwZSkkZ2Vub3R5cGUsY29sRGF0YShwZSkkYmlvcmVwLHNlcD0iXyIpCiAgCnBlIHw+IGNvbERhdGEoKQpgYGAKCjwvcD48L2RldGFpbHM+CgojIyMgUHJlcHJvY2Vzc2luZwoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIHRvIGxvZy10cmFuc2Zyb20gdGhlIGRhdGEgPC9zdW1tYXJ5PjxwPgoKMS4gTG9nIHRyYW5zZm9ybQoKICAtIFBlcHRpZGVzIHdpdGggemVybyBpbnRlbnNpdGllcyBhcmUgbWlzc2luZyBwZXB0aWRlcyBhbmQgc2hvdWxkIGJlIHJlcHJlc2VudAp3aXRoIGEgYE5BYCB2YWx1ZSByYXRoZXIgdGhhbiBgMGAuCgpgYGB7cn0KcGUgPC0gemVyb0lzTkEocGUsICJwZXB0aWRlUmF3IikgIyBjb252ZXJ0IDAgdG8gTkEKYGBgCgogIC0gTG9ndHJhbnNmb3JtIGRhdGEgd2l0aCBiYXNlIDIKCmBgYHtyfQpwZSA8LSBsb2dUcmFuc2Zvcm0ocGUsIGJhc2UgPSAyLCBpID0gInBlcHRpZGVSYXciLCBuYW1lID0gInBlcHRpZGVMb2ciKQpgYGAKCjIuIEZpbHRlcmluZwoKICAtIFdlIHJlbW92ZSBQU01zIHRoYXQgY291bGQgbm90IGJlIG1hcHBlZCB0byBhIHByb3RlaW4gb3IgdGhhdCBtYXAgdG8gbXVsdGlwbGUgcHJvdGVpbnMgKHRoZSBwcm90ZWluIGlkZW50aWZpZXIgY29udGFpbnMgbXVsdGlwbGUgaWRlbnRpZmllcnMgc2VwYXJhdGVkIGJ5IGEgYDtgKS4KCmBgYHtyfQpwZSA8LSBmaWx0ZXJGZWF0dXJlcygKICAgIHBlLCB+IFByb3RlaW5zICE9ICIiICYgIyMgUmVtb3ZlIGZhaWxlZCBwcm90ZWluIGluZmVyZW5jZQogICAgICAgICFncmVwbCgiOyIsIFByb3RlaW5zKSkgIyMgUmVtb3ZlIHByb3RlaW4gZ3JvdXBzCmBgYAoKICAtIFJlbW92ZSByZXZlcnNlIHNlcXVlbmNlcyAoZGVjb3lzKSBhbmQgY29udGFtaW5hbnRzLiBOb3RlIHRoYXQgdGhpcyBpcyBpbmRpY2F0ZWQgYnkgdGhlIGNvbHVtbiBuYW1lcyBSZXZlcnNlIGFuZCBkZXBlbmRpbmcgb24gdGhlIHZlcnNpb24gb2YgbWF4UXVhbnQgd2l0aCBQb3RlbnRpYWwuY29udGFtaW5hbnRzIG9yIENvbnRhbWluYW50cy4KCgpgYGB7cn0KcGUgPC0gZmlsdGVyRmVhdHVyZXMocGUsflJldmVyc2UgIT0gIisiKQpwZSA8LSBmaWx0ZXJGZWF0dXJlcyhwZSx+IENvbnRhbWluYW50ICE9ICIrIikKYGBgCgogIC0gRHJvcCBwZXB0aWRlcyB0aGF0IHdlcmUgaWRlbnRpZmllZCBpbiBsZXNzIHRoYW4gdGhyZWUgc2FtcGxlLiBXZSB0b2xlcmF0ZSB0aGUgZm9sbG93aW5nIHByb3BvcnRpb24gb2YgTkFzOiBwTkEgPSAobi0zKS9uLiAKCmBgYHtyfQpuT2JzIDwtIDMKbiA8LSBuY29sKHBlW1sicGVwdGlkZUxvZyJdXSkKcE5BIDwtIChuLW5PYnMpL24KcGUgPC0gZmlsdGVyTkEocGUsIHBOQSA9IHBOQSwgaSA9ICJwZXB0aWRlTG9nIikKbnJvdyhwZVtbInBlcHRpZGVMb2ciXV0pCmBgYAoKV2Uga2VlcCBgciBucm93KHBlW1sicGVwdGlkZUxvZyJdXSlgIHBlcHRpZGVzIHVwb24gZmlsdGVyaW5nLgoKMy4gTm9ybWFsaXphdGlvbiBieSBtZWRpYW4gY2VudGVyaW5nCgpgYGB7cn0KcGUgPC0gbm9ybWFsaXplKHBlLCAKICAgICAgICAgICAgICAgIGkgPSAicGVwdGlkZUxvZyIsIAogICAgICAgICAgICAgICAgbmFtZSA9ICJwZXB0aWRlTm9ybSIsIAogICAgICAgICAgICAgICAgbWV0aG9kID0gImNlbnRlci5tZWRpYW4iKQpgYGAKCgo0LiBTdW1tYXJpemF0aW9uLiBXZSB1c2UgdGhlIHN0YW5kYXJkIHN1bWFyaXNhdGlvbiBpbiBhZ2dyZWdhdGVGZWF0dXJlcywgd2hpY2ggaXMgYQpyb2J1c3Qgc3VtbWFyaXNhdGlvbiBtZXRob2QuCgpgYGB7cix3YXJuaW5nPUZBTFNFfQpwZSA8LSBhZ2dyZWdhdGVGZWF0dXJlcyhwZSwKICAgIGkgPSAicGVwdGlkZU5vcm0iLCAKICAgIGZjb2wgPSAiUHJvdGVpbnMiLCAKICAgIG5hLnJtID0gVFJVRSwKICAgIG5hbWUgPSAicHJvdGVpbiIpCmBgYAoKPC9wPjwvZGV0YWlscz4KCmBgYHtyfQptc3Fyb2IyZ3VpOjo6cGxvdFBDQShwZSwgInByb3RlaW4iLCAiYmlvcmVwIikKYGBgCgoKLSBSZXNwb25zZT8KLSBFeHBlcmltZW50YWwgdW5pdD8KLSBPYnNlcnZhdGlvbmFsIHVuaXQ/Ci0gRmFjdG9ycz8KCmBgYHtyfQpWaXN1YWxpemVEZXNpZ24oY29sRGF0YShwZSksfiBnZW5vdHlwZSArIGJpb3JlcCkkcGxvdGxpc3QKYGBgCgokXHJpZ2h0YXJyb3ckIFBzZXVkby1yZXBsaWNhdGlvbiwgcmFuZG9taXNhdGlvbiB0byBiaW8tcmVwZWF0IGFuZCBlYWNoIGJpby1yZXBlYXQgbWVhc3VyZWQgaW4gdGVjaG5pY2FsIHRyaXBsaWNhdGUuCiRccmlnaHRhcnJvdyQgSWYgd2Ugd291bGQgYW5hbHlzZSB0aGUgZGF0YSB1c2luZyBhIGxpbmVhciBtb2RlbCBiYXNlZCBvbiBlYWNoIG1lYXN1cmVkIGludGVuc2l0eSwgd2Ugd291bGQgYWN0IGFzIGlmIHdlIGhhZCBzYW1wbGVkIDE4IGJpby1yZXBlYXRzLgokXHJpZ2h0YXJyb3ckIEVmZmVjdCBvZiBpbnRlcmVzdCBoYXMgdG8gYmUgYXNzZXNzZWQgYmV0d2VlbiBiaW8tcmVwZWF0cy4gU28gYmxvY2sgYW5hbHlzaXMgaXMgbm90IHBvc3NpYmxlIChpZiB3ZSBjb25kaXRpb24gb24gYmlvLXJlcGVhdCwgd2UgY29uZGl0aW9uIG9uIHRoZSBnZW5vdHlwZSkhCgoKIyMjIFdyb25nIGFuYWx5c2lzCgoKYGBge3Igd2FybmluZz1GQUxTRX0KcGUgPC0gbXNxcm9iKG9iamVjdCA9IHBlLCBpID0gInByb3RlaW4iLCBmb3JtdWxhID0gfmdlbm90eXBlLCBtb2RlbENvbHVtbk5hbWUgPSAid3JvbmciLCBvdmVyd3JpdGUgPSBUUlVFKQpMIDwtIG1ha2VDb250cmFzdCgiZ2Vub3R5cGVEOCA9IDAiLCBwYXJhbWV0ZXJOYW1lcyA9IGMoImdlbm90eXBlRDgiKSkKcGUgPC0gaHlwb3RoZXNpc1Rlc3Qob2JqZWN0ID0gcGUsIGkgPSAicHJvdGVpbiIsIGNvbnRyYXN0ID0gTCwgbW9kZWxDb2x1bW4gPSAid3JvbmciLCAgIHJlc3VsdHNDb2x1bW5OYW1lUHJlZml4ID0gIndyb25nXyIsIG92ZXJ3cml0ZSA9IFRSVUUpCgp2b2xjYW5vV3JvbmcgPC0gZ2dwbG90KAogICAgcm93RGF0YShwZVtbInByb3RlaW4iXV0pJHdyb25nX2dlbm90eXBlRDgsCiAgICBhZXMoeCA9IGxvZ0ZDLCB5ID0gLWxvZzEwKHB2YWwpLCBjb2xvciA9IGFkalB2YWwgPCAwLjA1KQopICsKICAgIGdlb21fcG9pbnQoY2V4ID0gMi41KSArCiAgICBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gYWxwaGEoYygiYmxhY2siLCAicmVkIiksIDAuNSkpICsKICAgIHRoZW1lX21pbmltYWwoKSArCiAgICBnZ3RpdGxlKHBhc3RlMCgid3JvbmcgYW5hbHlzaXM6ICIsc3VtKHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSR3cm9uZ19nZW5vdHlwZUQ4JGFkalB2YWwgPDAuMDUsIG5hLnJtPVRSVUUpLCIgREEiKSkKCnZvbGNhbm9Xcm9uZwpgYGAKCgpOb3RlLCB0aGF0IHRoZSBhbmFseXNpcyB3aGVyZSB3ZSBpZ25vcmUgdGhhdCB3ZSBoYXZlIG11bHRpcGxlIHRlY2huaWNhbCByZXBlYXRzIGZvciBlYWNoIGJpby1yZXBlYXQgcmV0dXJucyBtYW55IHNpZ25pZmljYW50IERBIHByb3RlaW5zIGJlY2F1c2Ugd2UgYWN0IGFzIGlmIHdlIGhhdmUgbXVjaCBtb3JlIGluZGVwZW5kZW50IG9ic2VydmF0aW9ucy4KCiMjIyBDb3JyZWN0IGFuYWx5c2lzCgotIE1peGVkIE1vZGVscyBjYW4gbW9kZWwgdGhlIGNvcnJlbGF0aW9uIHN0cnVjdHVyZSBpbiB0aGUgZGF0YQoKLSBUaGV5IGNhbiBhY2tub3dsZWRnZSB0aGF0IHByb3RlaW4gZXhwcmVzc2lvbiB2YWx1ZXMgZnJvbSBydW5zIGZyb20gdGhlIHNhbWUgYmlvbG9naWNhbCByZXBlYXQgYXJlIG1vcmUgYWxpa2UgdGhhbiBwcm90ZWluIGV4cHJlc3Npb24gdmFsdWVzIGZyb20gcnVucyBvZiBkaWZmZXJlbnQgYmlvbG9naWNhbCByZXBlYXRzLiAKCi0gTWl4ZWQgbW9kZWxzIGNhbiBhbHNvIGJlIHVzZWQgd2hlbiBpbmZlcmVuY2UgYmV0d2VlbiBhbmQgd2l0aGluIGJsb2NrcyBpcyBuZWVkZWQuIAoKLSBGb3IgdGhlIGZyYW5jaXNlbGxhIGV4YW1wbGUgdGhlIGZvcm11bGEgaW4gbXNxcm9iMiBiZWNvbWVzOiAoZm9ybXVsYTogfiBnZW5vdHlwZSArICgxfGJpb3JlcCkpLiAKCiQkIFxsZWZ0XHtcYmVnaW57YXJyYXl9e3JjbH0KeV97aXJ9ICY9JiBcYmV0YV8wICsgXGJldGFfe3d0fVhfe3d0LGl9ICsgYl9pICsgXGVwc2lsb25fe2lyfVxcCmJfaSAmIFxzaW0gJiBOKDAsXHNpZ21hX2JeMilcXApcZXBzaWxvbl97aXJ9ICZcc2ltJiBOKDAsXHNpZ21hX1xlcHNpbG9uXjIpClxlbmR7YXJyYXl9XHJpZ2h0LiQkCgoKCmBgYHtyfQpwZSA8LSBtc3Fyb2Iob2JqZWN0ID0gcGUsIGkgPSAicHJvdGVpbiIsIGZvcm11bGEgPSB+Z2Vub3R5cGUgKyAoMXxiaW9yZXApLCBvdmVyd3JpdGUgPSBUUlVFKQpMIDwtIG1ha2VDb250cmFzdCgiZ2Vub3R5cGVEOCA9IDAiLCBwYXJhbWV0ZXJOYW1lcyA9IGMoImdlbm90eXBlRDgiKSkKcGUgPC0gaHlwb3RoZXNpc1Rlc3Qob2JqZWN0ID0gcGUsIGkgPSAicHJvdGVpbiIsIGNvbnRyYXN0ID0gTCwgb3ZlcndyaXRlID0gVFJVRSkKCnZvbGNhbm9NaXhlZCA8LSBnZ3Bsb3QoCiAgICByb3dEYXRhKHBlW1sicHJvdGVpbiJdXSkkZ2Vub3R5cGVEOCwKICAgIGFlcyh4ID0gbG9nRkMsIHkgPSAtbG9nMTAocHZhbCksIGNvbG9yID0gYWRqUHZhbCA8IDAuMDUpCikgKwogICAgZ2VvbV9wb2ludChjZXggPSAyLjUpICsKICAgIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBhbHBoYShjKCJibGFjayIsICJyZWQiKSwgMC41KSkgKwogICAgdGhlbWVfbWluaW1hbCgpICsKICAgIGdndGl0bGUocGFzdGUwKCJjb3JyZWN0IGFuYWx5c2lzOiAiLHN1bShyb3dEYXRhKHBlW1sicHJvdGVpbiJdXSkkZ2Vub3R5cGVEOCRhZGpQdmFsIDwwLjA1LCBuYS5ybT1UUlVFKSwiIERBIikpCnZvbGNhbm9NaXhlZApgYGAKCi0gTm90ZSwgdGhhdCB0aGUgc3RhdGlzdGljYWwgaW5mZXJlbmNlIHdpdGggbWl4ZWQgbW9kZWxzIGlzIHN0aWxsIGEgYml0IHRvbyBsaWJlcmFsIGJlY2F1c2UgaXQ6IAogICAgLSBoeXBvdGhlc2lzIHRlc3RzIGFyZSBvbmx5IHZhbGlkIGFzeW1wdG90aWNhbGx5IChsYXJnZSBudW1iZXIgb2YgYmlvcmVwZWF0cykuCiAgICAtIGluIHNtYWxsIHNhbXBsZXMgdGhlIGJldHdlZW4gYmlvcmVwZWF0IHZhcmlhbmNlIGlzIHNvbWV0aW1lcyBlc3RpbWF0ZWQgdG8gYmUgemVybyBkdWUgdG8gZXN0aW1hdGlvbiB1bmNlcnRhaW50eSBhbmQgZm9yIHRoZXNlIHByb3RlaW5zIHRoZSBtb2RlbCBzdGlsbCBhY3RzIGFzIGlmIGFsbCAxOCBwcm90ZWluIGV4cHJlc3Npb24gdmFsdWVzIGFyZSBpbmRlcGVuZGVudC4gCiAgICAKLSBNaXhlZCBtb2RlbHMgYXJlIGFsc28gdmVyeSB1c2VmdWwgdG8gYW5hbHlzZSBkYXRhIGZyb20gbGFyZ2UgbGFiZWxlZCBleHBlcmltZW50cyBbQHZhbmRlbmJ1bGNrZTIwMjVdLiAKCi0gQnV0LCB0aGV5IGFyZSBiZXlvbmQgdGhlIHNjb3BlIG9mIHRoZSBsZWN0dXJlIHNlcmllcy4gCgpDT05TVUxUIEJJT1NUQVRJU1RJQ0lBTiBJTiBDQVNFIE9GIEVYUEVSSU1FTlRTIFdJVEggUFNFVURPLVJFUExJQ0FURVMsIFRFQ0hOSUNBTCBSRVBFQVRTLCBDT01QTEVYIERFU0lHTlMsIC4uLgoKIyBTb2Z0d2FyZSAmIGNvZGUKCi0gT3VyIFIvQmlvY29uZHVjdG9yIHBhY2thZ2UgW21zcXJvYjJdKGh0dHBzOi8vd3d3LmJpb2NvbmR1Y3Rvci5vcmcvcGFja2FnZXMvcmVsZWFzZS9iaW9jL2h0bWwvbXNxcm9iMi5odG1sKSBjYW4gYmUgdXNlZCBpbiBSIG1hcmtkb3duIHNjcmlwdHMgb3Igd2l0aCBHVUkvc2hpbnlBcHBzIFtRRmVhdHVyZXNHVUldKGh0dHBzOi8vZ2l0aHViLmNvbS9zdGF0T21pY3MvUUZlYXR1cmVzR1VJKSAoKykgYW5kIFttc3Fyb2IyZ3VpXShodHRwczovL2dpdGh1Yi5jb20vc3RhdE9taWNzL21zcXJvYjJndWkpICgrOiBmb3JrZWQgZnJvbSB0aGUgVUNMb3V2YWluLUNCSU8gbGFiKS4KCi0gR1VJcyBhcmUgaW50ZW5kZWQgYXMgYSBpbnRyb2R1Y3Rpb24gdG8gdGhlIGtleSBjb25jZXB0cyBvZiBwcm90ZW9taWNzIGRhdGEgYW5hbHlzaXMgZm9yIHVzZXJzIHdobyBoYXZlIG5vIGV4cGVyaWVuY2UgaW4gUi4gCgotIEhvd2V2ZXIsIGxlYXJuaW5nIGhvdyB0byBjb2RlIGRhdGEgYW5hbHlzZXMgaW4gUiBtYXJrZG93biBzY3JpcHRzIGlzIGtleSBmb3Igb3BlbiBlbiByZXByb2R1Y2libGUgc2NpZW5jZSBhbmQgZm9yIHJlcG9ydGluZyB5b3VyIHByb3Rlb21pY3MgZGF0YSBhbmFseXNlcyBhbmQgaW50ZXJwcmV0YXRpb24gaW4gYSByZXByb2R1Y2libGUgd2F5LiAKCgotIE1vcmUgaW5mb3JtYXRpb24gb24gb3VyIHRvb2xzIGNhbiBiZSBmb3VuZCBpbiBvdXIgcGFwZXJzIFtAZ29lbWlubmUyMDE2XSwgW0Bnb2VtaW5uZTIwMjBdLCBbQHN0aWNrZXIyMDIwXSBhbmQgW0B2YW5kZW5idWxja2UyMDI1XS4gUGxlYXNlIHJlZmVyIHRvIG91ciB3b3JrIHdoZW4gdXNpbmcgb3VyIHRvb2xzLiAKCjwhLS0KLSBDbGlwcyBvbiB0aGUgY29kZSBvbiBpbXBvcnRpbmcgdGhlIGRhdGEgYW5kIHByZXByb2Nlc3NpbmcgY2FuIGJlIGZvdW5kIGluIFtQYXJ0IEkgUHJlcHJvY2Vzc2luZ10oLi9wZGFfcXVhbnRpZmljYXRpb25fcHJlcHJvY2Vzc2luZy5odG1sKQoKLSBBIGNsaXAgb24gdGhlIGNvZGUgZm9yIG1vZGVsbGluZyBhbmQgc3RhdGlzdGljYWwgaW5mZXJlbmNlIHdpdGggbXNxcm9iMiBpcyBpbmNsdWRlZCBiZWxvdwoKPGlmcmFtZSB3aWR0aD0iNTYwIiBoZWlnaHQ9IjMxNSIKc3JjPSJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9lWHhJZHpHT1BnWSIKZnJhbWVib3JkZXI9IjAiCnN0eWxlPSJkaXNwbGF5OiBibG9jazsgbWFyZ2luOiBhdXRvOyIKYWxsb3c9ImF1dG9wbGF5OyBlbmNyeXB0ZWQtbWVkaWEiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4KLS0+IAoKIyBSZWZlcmVuY2VzCg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("pda_quantification_inference.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
